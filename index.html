<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Recast — Compact Click-Through (Intune-first Ready)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"></noscript>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://unpkg.com">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .focus-ring:focus-visible{outline:2px solid #facc15;outline-offset:2px}
    html,body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .section-card{border-radius:1rem;border:1px solid rgba(255,255,255,.08);background:#0c142b}
    .sub-card{border-radius:.75rem;border:1px solid rgba(255,255,255,.08);background:#0a1124}
    .collapse{overflow:hidden;transition:max-height 280ms cubic-bezier(.2,.8,.2,1),opacity 200ms ease,padding 200ms ease}

    /* Flow primitives */
    .tile{width:.45rem;height:.45rem;border-radius:.25rem;background:#334155;opacity:.9}
    .run .tile{animation:tilePulse 1s ease-in-out var(--d,0s) 1 forwards}
    @keyframes tilePulse{0%{transform:scale(.7);background:#334155;opacity:.4}60%{transform:scale(1);background:#38bdf8;opacity:1}100%{background:#334155;opacity:.9}}
    .flow-bar{height:.22rem;border-radius:.25rem;transform-origin:left center;transform:scaleX(0)}
    .run .flow-bar{animation:barGrow .9s ease forwards var(--d,0s)}
    @keyframes barGrow{to{transform:scaleX(1)}}
    .bolt-line{width:.22rem;border-radius:.25rem;transform-origin:top center;transform:scaleY(0)}
    .run .bolt-line{animation:boltDrop .9s ease forwards var(--d,0s)}
    @keyframes boltDrop{to{transform:scaleY(1)}}

    /* Catalog logos */
    .logo-ring{width:2.1rem;height:2.1rem;border-radius:9999px;display:grid;place-items:center;background:#0a1226;box-shadow:inset 0 0 0 1px rgba(255,255,255,.15)}
    .logo-wrap{display:flex;align-items:center;gap:.4rem}
    .logo-name{font-size:.7rem;color:#cbd5e1;white-space:nowrap}
    .run .logo-ring{animation:appPop .85s cubic-bezier(.2,.8,.2,1) var(--d,0s) 1 forwards}
    @keyframes appPop{0%{transform:scale(.85);filter:saturate(.4);opacity:.65}60%{transform:scale(1.05);filter:saturate(1);opacity:1}100%{transform:scale(1)}}

    /* End user */
    .user-beam{height:.38rem;border-radius:.38rem;transform-origin:left center;transform:scaleX(0)}
    .run .user-beam{animation:barGrow 1s ease forwards var(--d,0s)}
    .badge{width:1.15rem;height:1.15rem;border-radius:.3rem;opacity:0;transform:translateY(-6px) scale(.9)}
    .run .badge{animation:badgeDrop .8s ease-out var(--d,0s) forwards}
    @keyframes badgeDrop{to{opacity:1;transform:translateY(0) scale(1)}}

    /* Catalog rows */
    .cat-row{display:grid;grid-template-columns:15ch 1fr;gap:.5rem;align-items:center}
    .cat-title{font-size:.7rem;letter-spacing:.08em}
  </style>
</head>
<body class="min-h-screen bg-[#0b1020] text-slate-100 antialiased">
  <div id="app" class="min-h-screen"></div>

  <script>
    /* ---------- STATE ---------- */
    const STATE = {
      activeTab: 'brief', // start on overview
      impact: { minutes: 9, pkgHours: 6, riskHrs: 0 },
      defaults: { impact: { minutes: 9, pkgHours: 6, riskHrs: 0 } },
      ctx: { device: 'Windows', network: 'Corporate', compliant: true },
      packHrs: 8, configHrs: 2, currentHrs: 24,
      roiInputs: { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18, loadedCostPerHour: 85, recastAnnualCost: 120000 },
      copied: false,
      showLabels: false,
      showSolutionCards: true,
      openWhy: null,
      brief: { expanded: true, text: '', lastSaved: null, saving: false }
    };

    /* ---------- Intune Mode Switch ---------- */
    const INTUNE_MODE = new URLSearchParams(location.search).get('msft') === '1';
    if (INTUNE_MODE) {
      STATE.ctx = { device: 'Windows', network: 'Corporate', compliant: true };
      STATE.impact = { minutes: 12, pkgHours: 10, riskHrs: 2 }; // stronger Intune story
      STATE.defaults.impact = { ...STATE.impact };
    }

    /* ---------- Tabs (MSFT narrative labels) ---------- */
    const TABS = [
      { id: 'brief',    label: INTUNE_MODE ? 'Intune Co-Sell Brief' : 'Company Brief', icon: 'sticky-note' },
      { id: 'problems', label: INTUNE_MODE ? 'Why Intune + Recast'  : 'Current State', icon: 'alert-triangle' },
      { id: 'solution', label: INTUNE_MODE ? 'Intune Delivery Flow' : 'Recast Approach', icon: 'workflow' },
      { id: 'roi',      label: 'Impact & ROI', icon: 'bar-chart-3' }
    ];

    /* ---------- Utils ---------- */
    function cx(...a){ return a.filter(Boolean).join(' '); }
    function round(n){ return Math.round(n*100)/100; }
    function num(n){ return new Intl.NumberFormat().format(Math.round(n)); }
    function routeRecommendation(ctx){
      if(!ctx.compliant) return 'Web';
      if(ctx.device==='Windows' && ctx.network!=='Home') return 'Local';
      return 'VDI';
    }
    function cleanNum(v){ v = Number(String(v).replace(/[^0-9.\-]/g,'')); return isFinite(v) ? v : 0; }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function debounce(fn,ms){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args),ms); }; }

    /* Restore brief notes if present */
    try {
      const saved = localStorage.getItem('recast-brief-notes');
      if (saved !== null) STATE.brief.text = saved;
      const ts = localStorage.getItem('recast-brief-notes-ts');
      if (ts) STATE.brief.lastSaved = new Date(parseInt(ts,10)).toISOString();
    } catch {}

    /* ---------- Root render ---------- */
    function render(){
      const root=document.getElementById('app');
      root.innerHTML = `
        <header class="relative overflow-hidden">
          <div aria-hidden="true" class="absolute inset-0">
            <div class="absolute -top-40 -left-28 h-[420px] w-[420px] blur-[110px] rounded-full bg-gradient-to-br from-sky-500/25 via-indigo-500/20 to-fuchsia-500/30"></div>
            <div class="absolute -top-16 right-0 h-[280px] w-[280px] blur-[110px] rounded-full bg-gradient-to-br from-fuchsia-400/25 via-purple-500/20 to-sky-500/25"></div>
          </div>
          <div class="relative mx-auto max-w-6xl px-4 pt-8 pb-6">
            <h1 class="text-[32px] font-extrabold leading-tight text-white">Recast Software</h1>
            <div class="mt-2 flex flex-wrap gap-2 text-[11px]">
              <span class="rounded-full bg-white/10 px-2 py-1 ring-1 ring-white/10">Built for Intune</span>
              <span class="rounded-full bg-white/10 px-2 py-1 ring-1 ring-white/10">Graph API</span>
              <span class="rounded-full bg-white/10 px-2 py-1 ring-1 ring-white/10">WinGet</span>
              <span class="rounded-full bg-white/10 px-2 py-1 ring-1 ring-white/10">Autopatch-aware</span>
            </div>
            <p class="mt-3 max-w-3xl text-[16px] leading-[1.5] text-slate-300">
              ${
                STATE.activeTab==='brief'
                  ? (INTUNE_MODE
                      ? 'Personalize this demo for Intune co-sell: customer notes, objectives, blockers.'
                      : 'Personalize this demo with customer-specific notes. Collapsible editor + clean presenter view.')
                  : STATE.activeTab==='problems'
                    ? (INTUNE_MODE
                        ? 'Intune is the strategy. App velocity is the blocker. Recast clears the path.'
                        : 'Application deployment isn’t the problem. Doing it fast, consistently, and securely across the business is. — Microsoft MVP')
                    : (INTUNE_MODE
                        ? 'Recast supercharges Intune—EAC, WinGet, rings, and Autopatch—so app delivery is instant and adoption sticks.'
                        : 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more—making the tools you already use faster, smarter, and easier to manage')
              }
            </p>
          </div>
          <div class="relative mx-auto max-w-6xl px-4">
            <div role="tablist" aria-label="Demo sections" class="flex w-full flex-wrap gap-2 rounded-full bg-[#0b152f] p-1 ring-1 ring-white/10">
              ${TABS.map(t=>`
                <button type="button" class="${cx('inline-flex items-center gap-2 rounded-full px-3.5 py-1.5 text-sm focus-ring transition', STATE.activeTab===t.id ? 'bg-yellow-400 text-slate-900' : 'text-slate-200 hover:bg-white/5')}" data-action="switch-tab" data-tab="${t.id}" aria-controls="panel-${t.id}" aria-selected="${STATE.activeTab===t.id}">
                  <i data-lucide="${t.icon}" class="w-4 h-4"></i><span>${t.label}</span>
                </button>
              `).join('')}
            </div>
          </div>
        </header>

        <main class="mx-auto max-w-6xl px-4 pb-16">
          ${(STATE.activeTab==='solution' || STATE.activeTab==='roi') ? `
          <div class="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-3">
            ${chip('Minutes saved (per user/per month)', String(STATE.impact.minutes), 'emerald')}
            ${chip('Packaging hours avoided', String(STATE.impact.pkgHours), 'sky')}
            ${chip('Zero-day window reduced (hrs)', String(round(STATE.impact.riskHrs)), 'yellow')}
          </div>` : ''}

          <section class="mt-5">${renderActivePanel()}</section>
        </main>
      `;
      if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
      attachEvents();
      if (STATE.activeTab === 'solution') { buildFlow(); }
      if (STATE.activeTab === 'roi') { updateROIOutputs(); }

      // Live bind brief preview/read without re-render on each keystroke
      const prev=document.getElementById('brief-preview');
      const read=document.getElementById('brief-read');
      if(prev){ prev.textContent = STATE.brief.text || 'Add your customer-specific notes on the left.'; }
      if(read){ read.textContent = STATE.brief.text || 'Nothing here yet. Paste notes above.'; }
    }

    function chip(label,value,tone){
      const tones={emerald:'from-emerald-400/80 to-teal-400/80',sky:'from-sky-400/80 to-indigo-400/80',yellow:'from-yellow-300/90 to-amber-400/90'};
      return `
        <div class="section-card p-3">
          <div class="text-[11px] text-slate-300">${label}</div>
          <div class="mt-1 inline-flex items-center gap-2 rounded-full bg-gradient-to-r px-2 py-0.5 text-slate-900 ${tones[tone]}">
            <i data-lucide="badge-check" class="w-4 h-4"></i><span class="text-sm font-semibold tabular-nums">${value}</span>
          </div>
        </div>
      `;
    }

    function renderActivePanel(){
      if (STATE.activeTab==='brief') return renderBrief();
      if (STATE.activeTab==='problems') return renderProblems();
      if (STATE.activeTab==='solution') return renderSolution();
      if (STATE.activeTab==='roi') return renderROI();
      return '';
    }

    /* ---------- OVERVIEW TAB: Company Brief ---------- */
    function renderBrief(){
      const expanded = STATE.brief.expanded;
      const contentId = 'brief-content';
      const length = STATE.brief.text.length;
      const wordCount = (STATE.brief.text.trim().match(/\b[\w'-]+\b/g)||[]).length;
      return `
        <section id="panel-brief" class="space-y-4">
          <div class="rounded-2xl overflow-hidden shadow-sm ring-1 ring-white/10">
            <div class="w-full flex items-center justify-between px-5 bg-sky-900">
              <div class="flex items-center gap-2">
                <i data-lucide="sticky-note" class="w-5 h-5 text-white/95"></i>
                <h2 class="py-4 text-[22px] font-extrabold tracking-tight text-white">${INTUNE_MODE?'Intune Co-Sell Brief':'Company Brief'}</h2>
              </div>
              <div class="flex items-center gap-2">
                <span class="hidden sm:inline text-xs text-white/80 tabular-nums">${wordCount} words • ${length} chars</span>
                <span class="text-xs px-2 py-1 rounded-full ${STATE.brief.saving ? 'bg-white/20 text-white' : 'bg-white text-slate-900'}" aria-live="polite">
                  ${STATE.brief.saving ? 'Saving…' : (STATE.brief.lastSaved ? 'Saved' : 'Not saved')}
                </span>
                <button type="button" class="rounded-full bg-white/10 text-white text-xs px-3 py-1 hover:bg-white/20 focus-ring" data-action="copy-brief">Copy</button>
                <button type="button" class="rounded-full bg-white text-slate-900 text-xs px-3 py-1 font-semibold hover:brightness-95 focus-ring" data-action="toggle-brief" aria-expanded="${expanded}" aria-controls="${contentId}">
                  ${expanded ? 'Collapse' : 'Expand'}
                </button>
              </div>
            </div>

            <div id="${contentId}" class="bg-white text-slate-900 collapse ${expanded?'':'pointer-events-none'}" style="${expanded?'max-height:1200px;opacity:1;padding:20px;':'max-height:0;opacity:0;padding:0 20px;'}">
              <div class="grid gap-4 lg:grid-cols-2">
                <!-- Editor -->
                <div class="sub-card p-3 bg-[#0b1328] text-slate-200">
                  <div class="flex items-center justify-between">
                    <div class="text-sm font-semibold mb-2 flex items-center gap-2">
                      <i data-lucide="edit-3" class="w-4 h-4"></i> Notes (paste/type)
                    </div>
                    <div class="flex items-center gap-2">
                      <button type="button" class="rounded bg-white/10 px-2 py-1 text-xs hover:bg-white/20 focus-ring" data-action="brief-clear">Clear</button>
                      <button type="button" class="rounded bg-white/10 px-2 py-1 text-xs hover:bg-white/20 focus-ring" data-action="brief-insert-template">Template</button>
                    </div>
                  </div>
                  <textarea
                    class="w-full h-52 rounded-lg border border-white/10 bg-[#0b1328] px-3 py-2 text-sm leading-[1.5] focus-ring"
                    placeholder="${INTUNE_MODE?'Audience, Intune goals, EAC/WinGet usage, Autopatch, CA…':'Audience, goals, key apps, pain points, success criteria…'}"
                    data-action="set-brief-text"
                    aria-label="Company brief notes"
                  >${STATE.brief.text}</textarea>
                  <div class="mt-2 text-[11px] text-slate-400">Line breaks are preserved. Content is escaped (no HTML execution).</div>
                </div>

                <!-- Presenter preview -->
                <div class="section-card p-4">
                  <div class="flex items-center gap-2">
                    <i data-lucide="presentation" class="w-5 h-5 text-sky-300"></i>
                    <h3 class="text-base font-semibold">Presenter View</h3>
                  </div>
                  <div id="brief-preview" class="mt-2 text-sm text-slate-300 whitespace-pre-wrap">${escapeHtml(STATE.brief.text || 'Add your customer-specific notes on the left.')}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Read -->
          <article class="section-card p-4">
            <div class="flex items-center gap-2">
              <i data-lucide="bookmark" class="w-5 h-5 text-sky-300"></i>
              <h3 class="text-base font-semibold">Quick Read</h3>
            </div>
            <p id="brief-read" class="mt-2 text-sm text-slate-300 whitespace-pre-wrap">${escapeHtml(STATE.brief.text || 'Nothing here yet. Paste notes above.')}</p>
          </article>
        </section>
      `;
    }

    /* ---------- CURRENT STATE (Why* dropdowns; MSFT phrasing when on) ---------- */
    function renderProblems(){
      const items=[
        {t:'Fragmented delivery',s:'Windows / Mac / VDI / Web — users guess the right way.',i:'layers'},
        {t:'Packaging backlog',s: INTUNE_MODE ? 'Win32 packaging toil persists without EAC/WinGet.' : 'Rebuild per version; updates stall.',i:'boxes'},
        {t:'Zero-day exposure',s: INTUNE_MODE ? 'Autopatch cadence helps, but apps lag.' : 'Patching takes days, not minutes.',i:'shield'},
        {t:'Slow upgrades',s: INTUNE_MODE ? 'Windows readines stalls on app velocity.' : 'Stuck to old images; change is slow.',i:'layout-grid'}
      ];

      // Bullets per card (swap to MSFT language when INTUNE_MODE)
      const bulletsChange = INTUNE_MODE ? [
        'Move apps to Intune Enterprise App Catalog to cut packaging lead time; keep titles updated via Microsoft-hosted packages.',
        'Standardize on WinGet for consistent install/upgrade/uninstall and drift control.',
        'Use Graph automation to stamp policies, assignments, and rings at scale.'
      ] : [
        'App management is the #1 bottleneck. New devices, platforms, and projects stall until apps are packaged, patched, and proven.',
        'Too many apps, too many updates. Thousands of apps, constant versions — IT can’t keep up, slowing adoption and raising risk.',
        'Innovation waits on apps. Every transformation — cloud, security, AI — gets delayed if app delivery isn’t solved first.'
      ];

      const bulletsNow = INTUNE_MODE ? [
        'Zero-days + compliance drive 1–2 hr patch expectations; align with Autopatch cadence.',
        'New EAC coverage shortens app onboarding; stop rebuilding Win32 packages.',
        'Shrinking teams—automation via Graph and WinGet is mandatory.'
      ] : [
        'Faster change cycles. OS updates, AI tools, and SaaS shifts are constant — apps must keep pace.',
        'Rising risk. Zero-days and compliance rules make delayed patching unacceptable',
        'Shrinking teams. IT capacity isn’t growing, but demands are. Fix app management first, or nothing else moves.'
      ];

      const bulletsRecast = INTUNE_MODE ? [
        'Package once, deploy via Intune rings; Recast maps assignments and updates so admins don’t.',
        '7,000+ curated apps + EAC/WinGet pipelines reduce manual packaging backlog.',
        'Smart Icons + Entra ID context ensure the right route (Local/VDI/Web) with Conditional Access alignment.'
      ] : [
        'One platform for every app. Package, patch, and deliver from a single place across all devices and management tools.',
        'Proven scale. 7,000+ curated apps, automated updates, and instant delivery slash manual effort.',
        'Fuel for innovation. By removing app friction, Recast lets enterprises adopt new tech faster, safer, and with less risk.'
      ];

      return `
        <section id="panel-problems" class="space-y-4">
          <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
            ${items.map(p=>`
              <article class="section-card p-4">
                <div class="flex items-center gap-2"><i data-lucide="${p.i}" class="w-5 h-5 text-sky-300"></i><h3 class="text-base font-semibold">${p.t}</h3></div>
                <p class="mt-1 text-sm text-slate-300">${p.s}</p>
              </article>
            `).join('')}
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-16 items-stretch">
            ${calloutDropdown('change','alert-triangle', INTUNE_MODE?'Why Intune':'Why Change', bulletsChange, 'bg-teal-900')}
            ${calloutDropdown('now','clock-4','Why Now', bulletsNow, 'bg-purple-900')}
            ${calloutDropdown('recast','sparkles', INTUNE_MODE?'Why Recast for Intune':'Why Recast', bulletsRecast, 'bg-fuchsia-900', true)}
          </div>
        </section>
      `;
    }

    function calloutDropdown(id, icon, label, bullets, headerTone, cta=false){
      const expanded = STATE.openWhy === id;
      const contentId = `why-content-${id}`;
      return `
        <div class="h-full flex flex-col rounded-2xl overflow-hidden shadow-sm ring-1 ring-white/10">
          <button
            type="button"
            class="w-full flex items-center justify-between px-5 ${headerTone} hover:brightness-110 transition focus-ring"
            data-action="toggle-why"
            data-why="${id}"
            aria-expanded="${expanded}"
            aria-controls="${contentId}"
          >
            <div class="flex items-center gap-2">
              <i data-lucide="${icon}" class="w-5 h-5 text-white/95" aria-hidden="true"></i>
              <span class="py-4 text-[22px] font-extrabold tracking-tight text-white">${label}</span>
            </div>
            <i data-lucide="${expanded?'chevron-up':'chevron-down'}" class="w-5 h-5 text-white/90 transition-transform duration-300 ${expanded?'rotate-180':''}" aria-hidden="true"></i>
          </button>

          <div id="${contentId}" class="bg-white text-slate-900 collapse" style="${expanded?'max-height:1200px;opacity:1;padding:20px;':'max-height:0;opacity:0;padding:0 20px;'}">
            <ul class="list-disc pl-6 text-[18px] leading-[1.45] space-y-3 text-slate-800 text-left">
              ${bullets.map(b=>`<li>${b}</li>`).join('')}
            </ul>
            ${cta?`
              <div class="mt-6 flex justify-end">
                <button type="button" data-action="advance" data-next="solution" class="inline-flex rounded-full bg-[#0b1020] text-white text-[14px] font-semibold px-4 py-2 items-center gap-2 hover:brightness-110 focus-ring">
                  <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  ${INTUNE_MODE ? 'How Recast accelerates Intune' : 'How Recast solves it'}
                </button>
              </div>
            `:''}
          </div>
        </div>
      `;
    }

    /* ---------- RECAST APPROACH (Intune-first cards) ---------- */
    function renderSolution(){
      const saved=Math.max(0, Number(STATE.packHrs)-Number(STATE.configHrs));
      const reduced=Math.max(0, Number(STATE.currentHrs)-1.5);
      const route=routeRecommendation(STATE.ctx);
      return `
        <section id="panel-solution" class="space-y-3">
          <div class="grid grid-cols-1 gap-3 lg:grid-cols-2">
            ${renderFlow()}
            <div class="flex flex-col gap-3">
              ${STATE.showSolutionCards ? `
                ${cardUpdateOnce(saved)}
                ${cardZeroDay(reduced)}
                ${cardOneIcon(route)}
              ` : `
                <div class="section-card p-4 flex items-center justify-center">
                  <button type="button" data-action="show-solution-cards" class="rounded-full bg-white px-4 py-2 text-sm font-semibold text-slate-900 focus-ring">Show</button>
                </div>
              `}
            </div>
          </div>
        </section>
      `;
    }

    function pill(label,active,action,value){
      return `<button type="button" class="${cx('rounded-full px-3 py-1 border text-xs transition hover:bg-white/10',active?'bg-yellow-400 text-slate-900 border-transparent':'bg-[#0a1124] text-slate-200 border-white/10')}" data-action="${action}" data-value="${String(value)}">${label}</button>`;
    }

    function cardOneIcon(route){
      return `
        <div class="section-card p-4">
          <div class="flex items-center gap-2"><span>🖥️</span><h3 class="text-base font-semibold">Always the Right App, No Matter Where You Work.</h3></div>
          <p class="mt-1 text-sm text-slate-300">Smart Icons open apps the best way for each user—on Windows, macOS, Web, VPN, or VDI.</p>
          <div class="mt-2 grid grid-cols-3 gap-2 text-xs">
            ${['Windows','Mac'].map(d=>pill(d,STATE.ctx.device===d,'set-device',d)).join('')}
            ${['Corporate','VPN'].map(n=>pill(n,STATE.ctx.network===n,'set-network',n)).join('')}
            ${pill(STATE.ctx.compliant?'Compliant':'Non-compliant',STATE.ctx.compliant,'toggle-compliance','')}
          </div>
          <div class="mt-2 text-sm text-slate-300">Recommended route:</div>
          <div class="inline-flex items-center gap-2 rounded-full bg-yellow-400 px-3 py-1 text-slate-900 text-sm"><i data-lucide="check-circle-2" class="w-4 h-4"></i>${route}</div>
          <div class="mt-1 text-[11px] text-slate-400">Entra ID + Conditional Access ensure compliant users get local apps; non-compliant route to VDI/Web.</div>
          <div class="mt-3"><button type="button" class="rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs hover:bg-white/20" data-action="add-impact" data-kind="minutes" data-value="2">Add to impact (+2 min saved per user)</button></div>
        </div>
      `;
    }

    function cardUpdateOnce(saved){
      const title = INTUNE_MODE ? 'Package Once, Deploy via Intune Rings' : 'Update Once, Deploy Everywhere';
      const copy = INTUNE_MODE
        ? 'Use Enterprise App Catalog + WinGet; assign by ring (Pilot → Broad) with Graph automation.'
        : 'Package one time; push to cloud, on-prem, or hybrid with rings.';
      return `
        <div class="section-card p-4">
          <div class="flex items-center gap-2"><span>⚙️</span><h3 class="text-base font-semibold">${title}</h3></div>
          <p class="mt-1 text-sm text-slate-300">${copy}</p>
          <div class="sub-card p-3 text-sm">
            <div class="flex items-center gap-2 font-medium"><i data-lucide="wand-2" class="w-4 h-4"></i> Critical app updates</div>
            <label class="mt-2 flex items-center gap-2 text-xs">
              <span class="text-slate-400">Hours/package</span>
              <input class="w-16 rounded bg-slate-950 px-2 py-1" value="${STATE.packHrs}" inputmode="decimal" data-action="set-pack-hrs" aria-label="Hours per package">
              <span>→</span>
              <input class="w-16 rounded bg-slate-950 px-2 py-1" value="${STATE.configHrs}" inputmode="decimal" data-action="set-config-hrs" aria-label="Hours to configure">
            </label>
            <div class="mt-2 flex items-center justify-between rounded bg-black/20 px-3 py-2"><span class="tabular-nums">${STATE.packHrs} → ${STATE.configHrs} hrs</span><strong class="tabular-nums">${saved} hrs saved</strong></div>
            <div class="mt-2 text-[12px] text-slate-300 flex flex-wrap gap-2">
              ${INTUNE_MODE ? `
                <span class="rounded-full bg-black/30 px-2 py-1">📦 Enterprise App Catalog</span>
                <span class="rounded-full bg-black/30 px-2 py-1">🧰 WinGet (install/upgrade)</span>
                <span class="rounded-full bg-black/30 px-2 py-1">🧭 Graph automation</span>
              ` : `
                <span class="rounded-full bg-black/30 px-2 py-1">☁️ Cloud</span>
                <span class="rounded-full bg-black/30 px-2 py-1">🖥️ On-Prem</span>
                <span class="rounded-full bg-black/30 px-2 py-1">🔀 Hybrid</span>
              `}
            </div>
            <button type="button" class="mt-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-900 hover:brightness-95" data-action="add-impact" data-kind="pkgHours" data-value="${saved}">Add to impact</button>
          </div>
        </div>
      `;
    }

    function cardZeroDay(reduced){
      return `
        <div class="section-card p-4">
          <div class="flex items-center gap-2"><span>🛡️</span><h3 class="text-base font-semibold">${INTUNE_MODE?'Zero-Day Apps in Hours (Autopatch-aligned)':'Zero-Day Patches in Hours'}</h3></div>
          <p class="mt-1 text-sm text-slate-300">${INTUNE_MODE?'Align app fixes with Windows and M365 Autopatch cadence; reduce exposure windows.':'Security fixes deploy in 1–2 hours instead of a full day (~90% faster).'}</p>
          <div class="sub-card p-3 text-sm">
            <div class="flex items-center gap-2 font-medium"><i data-lucide="shield-check" class="w-4 h-4"></i> Zero-day rollout</div>
            <label class="mt-2 flex items-center gap-2 text-xs">
              <span class="text-slate-400">Current hrs</span>
              <input class="w-20 rounded bg-slate-950 px-2 py-1" value="${STATE.currentHrs}" inputmode="decimal" data-action="set-current-hrs" aria-label="Current time to deploy (hours)">
            </label>
            <div class="mt-2 flex items-center justify-between rounded bg-black/20 px-3 py-2"><span class="tabular-nums">${STATE.currentHrs} → 1.5 hrs</span><strong class="tabular-nums">${round(reduced)} hrs reduced</strong></div>
            <button type="button" class="mt-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-900 hover:brightness-95" data-action="add-impact" data-kind="riskHrs" data-value="${reduced}">Add to impact</button>
          </div>
        </div>
      `;
    }

    /* ---------- Animated Flow (left) ---------- */
    function renderFlow(){
      return `
        <div class="section-card p-4">
          <div class="flex items-center justify-between gap-3">
            <div class="flex items-center gap-2">
              <div class="h-6 w-6 rounded-lg bg-gradient-to-br from-sky-500 via-indigo-500 to-fuchsia-500 grid place-items-center"><i data-lucide="boxes" class="h-3.5 w-3.5 text-white"></i></div>
              <div>
                <h3 class="text-base font-semibold">Application Workspace</h3>
                <div class="text-[12px] text-slate-400">Curated & secured catalog</div>
              </div>
            </div>
            <div class="flex items-center gap-2 text-[12px] text-slate-300">
              <button type="button" class="rounded-full border border-white/15 bg-white/10 px-2.5 py-1 hover:bg-white/20" data-action="toggle-labels">${STATE.showLabels?'Hide':'Show'} labels</button>
              <button type="button" data-action="start-flow" class="rounded-full bg-white px-2.5 py-1.5 text-[12px] font-semibold text-slate-900 hover:brightness-95">Start</button>
              <button type="button" data-action="reset-flow" class="rounded-full border border-white/20 bg-white/10 px-2.5 py-1.5 hover:bg-white/20">Reset</button>
            </div>
          </div>

          <div id="flowCard" class="mt-3 sub-card p-3" role="region" aria-label="Animated flow">
            <div class="space-y-2">
              ${CATALOG.map(s=>`
                <div class="cat-row">
                  <div class="cat-title text-slate-400 uppercase">${s.title}</div>
                  <div id="${s.id}" class="flex flex-wrap gap-2"></div>
                </div>
              `).join('')}
            </div>

            <div id="flowHubFlash" class="mt-2 hidden text-amber-300 text-[12px] inline-flex items-center gap-1"><i data-lucide="bolt" class="h-4 w-4"></i><span>Update published</span></div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['A','B','C'].map((k,i)=>`
                <div class="sub-card p-2">
                  <div class="text-[12px] text-slate-300">${['Existing Platforms','Staged Rings','Access & Policy'][i]}</div>
                  <div id="flowConn${k}" class="mt-1 grid grid-cols-10 gap-1.5"></div>
                  <div class="mt-1 flow-bar w-full bg-gradient-to-r from-sky-400 via-indigo-400 to-fuchsia-400" style="--d:${.55 + .12*i}s"></div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['A','B','C'].map((k,i)=>`
                <div class="sub-card p-2">
                  <div class="text-[12px] text-slate-300">${['Business Unit','Subsidiary','Region'][i]}</div>
                  <div id="flowGrp${k}" class="mt-1 grid grid-cols-8 gap-1.5"></div>
                  <div class="mx-auto mt-1 bolt-line h-16 w-1 bg-gradient-to-b from-amber-300 via-white to-amber-300" style="--d:${1 + .15*i}s"></div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['A','B','C'].map((k,i)=>`
                <div class="sub-card p-2 text-center">
                  <i data-lucide="${['monitor-smartphone','laptop','smartphone'][i]}" class="h-5 w-5 text-slate-300"></i>
                  <div id="flowDev${k}" class="mt-1 grid grid-cols-6 gap-1.5"></div>
                  <div class="mt-1 text-[11px] text-slate-400">${['Windows & macOS','VDI / Web','Mobile'][i]}</div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3">
              <div id="endUserCard" class="sub-card p-3">
                <div class="flex items-center gap-3">
                  <div id="endUserAvatar" class="h-9 w-9 rounded-full bg-rose-600/90 grid place-items-center font-semibold">U</div>
                  <div class="text-sm">
                    <div class="font-medium text-slate-200">End user</div>
                    <div class="text-slate-400">Apps on demand — no waiting, no tickets.</div>
                  </div>
                </div>
                <div class="mt-3 user-beam bg-gradient-to-r from-sky-400 via-indigo-400 to-fuchsia-400" style="--d:2.1s"></div>
                <div class="relative mt-2 rounded-lg border border-white/10 bg-[#0b1328] p-4">
                  <i data-lucide="laptop" class="h-5 w-5 opacity-80"></i>
                  <div id="endUserBadge" class="absolute right-2 top-2 badge bg-rose-500 text-black grid place-items-center font-bold" style="--d:2.4s">!</div>
                  <div class="mt-1 text-[11px] text-slate-400">Workspace launches the correct app instantly</div>
                </div>
              </div>
              <div id="flowSuccess" class="mt-2 hidden text-emerald-300 text-[13px] inline-flex items-center gap-1"><i data-lucide="sparkles" class="h-4 w-4"></i><span>Configured once → delivered everywhere.</span></div>
            </div>
          </div>
        </div>
      `;
    }

    /* ---------- ROI (MSFT-aligned copy) ---------- */
    function renderROI(){
      const r = calcROI();
      return `
        <section id="panel-roi" class="space-y-3">
          <div class="section-card p-3"><div class="text-sm font-medium">Standardize app delivery on Intune + Recast to reduce tickets, shrink exposure windows, and accelerate Windows & M365 update readiness.</div></div>

          <div class="grid grid-cols-1 gap-3 sm:grid-cols-4">
            ${kpiId('timer','Hours saved / mo', r.totalHoursSavedMonth, 'EAC updates + WinGet + Autopatch cadence.', 'kpi-hours')}
            ${kpiId('line-chart','$ saved / yr', '$'+num(r.dollarSavedYear), 'Illustrative only', 'kpi-year')}
            ${kpiId('percent','ROI', r.roiPct+'%', 'Net of subscription', 'kpi-roi')}
            ${kpiId('inbox','Tickets / mo', num(r.ticketsMonth), 'Self-service via Smart Icons + correct route (Local/VDI/Web).', 'kpi-tickets')}
          </div>

          <div class="grid grid-cols-1 gap-3 lg:grid-cols-3">
            <div class="section-card p-4 lg:col-span-2">
              <h3 class="text-base font-semibold">Assumptions (edit)</h3>
              <div class="mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2">
                ${numInput('# users','users', r.i.users)}
                ${numInput('Tickets per user / mo','ticketsPerUserPerMonth', r.i.ticketsPerUserPerMonth)}
                ${numInput('Avg handle (mins)','avgHandleMins', r.i.avgHandleMins)}
                ${numInput('Loaded cost ($/hr)','loadedCostPerHour', r.i.loadedCostPerHour)}
                ${numInput('Recast annual cost ($)','recastAnnualCost', r.i.recastAnnualCost)}
              </div>
              <div class="mt-3 text-[11px] text-slate-400">All values are examples. Replace with your data for accurate estimates.</div>
            </div>

            <div class="section-card p-4">
              <h3 class="text-base font-semibold">Results</h3>
              <div class="mt-3 space-y-2 text-sm">
                ${kvId('Hours saved / month', r.totalHoursSavedMonth, 'res-hours')}
                ${kvId('$ saved / month', '$'+num(r.dollarSavedMonth), 'res-month')}
                ${kvId('$ saved / year', '$'+num(r.dollarSavedYear), 'res-year')}
                ${kvId('Net benefit / year', '$'+num(r.netBenefitYear), 'res-net')}
                ${kvId('ROI', r.roiPct+'%', 'res-roi')}
                ${kvId('Equivalent IT FTEs freed', r.fteEquivalent, 'res-fte')}
              </div>
              <div class="mt-2 text-[11px] text-slate-400 italic">Add a short customer proof-point here (e.g., “Cut packaging time by 80% in first 30 days”).</div>
              <div class="mt-4 flex flex-wrap gap-2">
                <button type="button" data-action="reset-calculator" class="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/20 focus-ring">Reset</button>
                <button type="button" data-action="copy-onepager" class="inline-flex items-center gap-2 rounded-full bg-yellow-400 px-4 py-2 text-sm font-semibold text-slate-900 hover:brightness-95 focus-ring">
                  <i data-lucide="clipboard" class="w-4 h-4"></i> ${STATE.copied ? 'Copied!' : 'Copy executive one-pager'}
                </button>
              </div>
            </div>
          </div>

          <p class="text-[11px] text-slate-400">Recast AW complements Microsoft Intune (Windows/macOS focus). Metrics are illustrative.</p>
        </section>
      `;
    }

    /* ---------- ROI helpers ---------- */
    function calcROI(){
      const i = STATE.roiInputs;
      const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
      const hoursFromMinutes = (STATE.impact.minutes * i.users) / 60;
      const totalHoursSavedMonth = hoursFromMinutes + STATE.impact.pkgHours + STATE.impact.riskHrs;
      const dollarSavedMonth = totalHoursSavedMonth * i.loadedCostPerHour;
      const dollarSavedYear = dollarSavedMonth * 12;
      const netBenefitYear = dollarSavedYear - i.recastAnnualCost;
      const roiPct = i.recastAnnualCost ? round((netBenefitYear / i.recastAnnualCost) * 100) : 0;
      const fteHoursYear = 2080;
      const fteEquivalent = round((totalHoursSavedMonth * 12) / fteHoursYear);
      return {
        i,
        ticketsMonth,
        hoursFromMinutes: round(hoursFromMinutes),
        totalHoursSavedMonth: round(totalHoursSavedMonth),
        dollarSavedMonth: round(dollarSavedMonth),
        dollarSavedYear: round(dollarSavedYear),
        netBenefitYear: round(netBenefitYear),
        roiPct,
        fteEquivalent
      };
    }
    function updateROIOutputs(){
      const r = calcROI();
      setText('kpi-hours', r.totalHoursSavedMonth);
      setText('kpi-year', '$'+num(r.dollarSavedYear));
      setText('kpi-roi', r.roiPct+'%');
      setText('kpi-tickets', num(r.ticketsMonth));
      setText('res-hours', r.totalHoursSavedMonth);
      setText('res-month', '$'+num(r.dollarSavedMonth));
      setText('res-year', '$'+num(r.dollarSavedYear));
      setText('res-net', '$'+num(r.netBenefitYear));
      setText('res-roi', r.roiPct+'%');
      setText('res-fte', r.fteEquivalent);
    }
    function setText(id, value){ const el=document.getElementById(id); if(el) el.textContent = String(value); }

    function kpiId(icon,label,value,hint,id){
      return `
        <div class="section-card p-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-[11px] text-slate-300">${label}</div>
              <div id="${id}" class="text-xl font-semibold tabular-nums">${value}</div>
            </div>
            <i data-lucide="${icon}" class="w-5 h-5 text-sky-300"></i>
          </div>
          ${hint ? `<div class="mt-1 text-[11px] text-slate-400">${hint}</div>` : ''}
        </div>
      `;
    }
    function kvId(label,value,id){
      return `<div class="flex items-center justify-between rounded-lg bg-black/20 px-3 py-2"><span class="text-slate-300">${label}</span><span id="${id}" class="font-semibold tabular-nums">${value}</span></div>`;
    }
    function numInput(label,key,value){
      return `<label class="flex flex-col gap-1 text-sm"><span class="text-[12px] text-slate-300">${label}</span><input class="rounded-lg border border-white/10 bg-[#0b1328] px-3 py-1.5 text-sm focus-ring" inputmode="decimal" value="${value}" data-action="set-roi" data-key="${key}"></label>`;
    }

    /* ---------- Logo mark helpers (must be before CATALOG) ---------- */
    function logo(name,letter,color){ return { name, svg: mark(letter,color) }; }
    function mark(letter,color){
      return `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${letter}">
          <defs><linearGradient id="g${letter.replace(/\W/g,'')}" x1="0" x2="1"><stop offset="0" stop-color="${shade(color,.9)}"/><stop offset="1" stop-color="${shade(color,1.1)}"/></linearGradient></defs>
          <rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="url(#g${letter.replace(/\W/g,'')})" stroke="rgba(255,255,255,.15)"/>
          <text x="50%" y="56%" text-anchor="middle" font-size="22" font-family="Inter,Segoe UI,Arial" font-weight="800" fill="white">${letter}</text>
        </svg>`;
    }
    function multiLogo(name,colors){
      const slices=colors.map((c,i)=>`<rect x="${4+i*9}" y="8" width="7" height="32" rx="4" fill="${c}"></rect>`).join('');
      return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#111827" stroke="rgba(255,255,255,.15)"/>${slices}</svg>` };
    }
    function triLogo(name,r1,r2,r3,r4){
      return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#111827" stroke="rgba(255,255,255,.15)"/><circle cx="24" cy="24" r="12" fill="${r4}"/><path d="M24 12 A12 12 0 0 1 36 24 L24 24 Z" fill="${r1}"/><path d="M36 24 A12 12 0 0 1 24 36 L24 24 Z" fill="${r2}"/><path d="M24 36 A12 12 0 0 1 24 12 L24 24 Z" fill="${r3}"/></svg>` };
    }
    function ringLogo(name,c1,c2){
      return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#111827" stroke="rgba(255,255,255,.15)"/><circle cx="24" cy="24" r="11" fill="${c1}"/><circle cx="20" cy="20" r="8" fill="${c2}"/></svg>` };
    }
    function flameLogo(name,c1,c2){
      return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#111827" stroke="rgba(255,255,255,.15)"/><path d="M24 12c5 7-2 9 3 14 3 3 2 9-3 11-5-2-6-8-3-11 5-5-3-7 3-14z" fill="${c1}"/><circle cx="26" cy="28" r="4" fill="${c2}"/></svg>` };
    }
    function shade(hex,m){ const c=hex.replace('#',''); const n=[0,1,2].map(i=>parseInt(c.slice(i*2,i*2+2),16)); const s=n.map(v=>Math.max(0,Math.min(255,Math.round(v*m)))); return '#'+s.map(v=>v.toString(16).padStart(2,'0')).join(''); }

    /* ---------- Catalogs ---------- */
    const BASE_CATALOG = [
      {title:'CORE PRODUCTIVITY',id:'cat-core',items:[
        logo('Microsoft Word','W','#185ABD'),
        logo('Microsoft Excel','X','#107C41'),
        logo('PowerPoint','P','#D24726'),
        logo('Outlook','O','#106EBE'),
        logo('Microsoft Teams','T','#5B53D6'),
        logo('Google Docs','Dc','#1A73E8'),
        logo('Google Sheets','Sh','#1E8E3E'),
        logo('Google Slides','Sl','#F9AB00')
      ]},
      {title:'MESSAGING & MEETINGS',id:'cat-collab',items:[
        multiLogo('Slack',['#36C5F0','#2EB67D','#E01E5A','#ECB22E']),
        logo('Zoom','Z','#0B5CFF'),
        logo('Gmail','G','#EA4335'),
        logo('Google Meet','GM','#0F9D58')
      ]},
      {title:'WEB BROWSERS',id:'cat-browsers',items:[
        triLogo('Google Chrome','#EA4335','#FBBC05','#34A853','#4285F4'),
        ringLogo('Microsoft Edge','#0C8EC5','#0AA0A3'),
        flameLogo('Mozilla Firefox','#FF7139','#FFCC00')
      ]},
      {title:'ENTERPRISE APPS',id:'cat-enterprise',items:[
        logo('Salesforce','SF','#00A1E0'),
        logo('Workday','WD','#1F5BFF'),
        logo('ServiceNow','SN','#81B29A'),
        logo('SAP','SAP','#0A6ED1'),
        logo('Oracle NetSuite','NS','#C74634')
      ]},
      {title:'SECURITY & ACCESS',id:'cat-security',items:[
        logo('Duo','D','#3CB371'),
        logo('Okta','O','#007DC1'),
        logo('Ping Identity','P','#C0172C'),
        logo('Cisco AnyConnect','AC','#00B5AD'),
        logo('Microsoft Defender','MD','#0067B8'),
        logo('CrowdStrike Falcon','CS','#D61F26')
      ]},
      {title:'STORAGE & CREATIVE',id:'cat-storage',items:[
        logo('Adobe Acrobat','A','#ED2224'),
        logo('Dropbox','DB','#0061FF'),
        logo('Box','BX','#0061D5'),
        logo('OneDrive','OD','#0A5BD5'),
        logo('ZoomIt / Sysinternals','ZI','#58595B')
      ]}
    ];

    const CATALOG = INTUNE_MODE ? [
      { title:'MICROSOFT WORKPLACE', id:'cat-msft', items:[
        logo('Microsoft Teams','T','#5B53D6'),
        ringLogo('Microsoft Edge','#0C8EC5','#0AA0A3'),
        logo('Microsoft Defender','D','#0067B8'),
        logo('OneDrive','OD','#0A5BD5'),
        logo('Microsoft Word','W','#185ABD'),
        logo('Microsoft Excel','X','#107C41'),
        logo('PowerPoint','P','#D24726'),
        logo('Outlook','O','#106EBE')
      ]},
      { title:'INTUNE & SECURITY', id:'cat-intune', items:[
        logo('Microsoft Intune','I','#2563EB'),
        logo('Windows Autopatch','A','#0EA5E9'),
        logo('Entra ID','E','#7C3AED')
      ]},
      {title:'ENTERPRISE APPS',id:'cat-enterprise',items:[
        logo('Salesforce','SF','#00A1E0'),
        logo('Workday','WD','#1F5BFF'),
        logo('ServiceNow','SN','#81B29A'),
        logo('SAP','SAP','#0A6ED1'),
        logo('Oracle NetSuite','NS','#C74634')
      ]},
      {title:'WEB BROWSERS',id:'cat-browsers',items:[
        ringLogo('Microsoft Edge','#0C8EC5','#0AA0A3'),
        triLogo('Google Chrome','#EA4335','#FBBC05','#34A853','#4285F4'),
        flameLogo('Mozilla Firefox','#FF7139','#FFCC00')
      ]},
      {title:'SECURITY & ACCESS',id:'cat-security',items:[
        logo('Microsoft Defender','MD','#0067B8'),
        logo('Duo','D','#3CB371'),
        logo('Okta','O','#007DC1'),
        logo('Ping Identity','P','#C0172C'),
        logo('Cisco AnyConnect','AC','#00B5AD'),
        logo('CrowdStrike Falcon','CS','#D61F26')
      ]},
      {title:'MESSAGING & MEETINGS',id:'cat-collab',items:[
        multiLogo('Slack',['#36C5F0','#2EB67D','#E01E5A','#ECB22E']),
        logo('Zoom','Z','#0B5CFF'),
        logo('Gmail','G','#EA4335'),
        logo('Google Meet','GM','#0F9D58')
      ]},
      {title:'STORAGE & CREATIVE',id:'cat-storage',items:[
        logo('Adobe Acrobat','A','#ED2224'),
        logo('Dropbox','DB','#0061FF'),
        logo('Box','BX','#0061D5'),
        logo('OneDrive','OD','#0A5BD5'),
        logo('ZoomIt / Sysinternals','ZI','#58595B')
      ]}
    ] : BASE_CATALOG;

    /* ---------- Events ---------- */
    function attachEvents(){
      const root=document.getElementById('app');

      root.querySelectorAll('[data-action="switch-tab"]').forEach(b=>b.addEventListener('click',e=>{
        STATE.activeTab=e.currentTarget.getAttribute('data-tab');
        if(STATE.activeTab==='solution'){ STATE.showSolutionCards=false; }
        render();
      }));
      root.querySelectorAll('[data-action="advance"]').forEach(b=>b.addEventListener('click',e=>{
        STATE.activeTab=e.currentTarget.getAttribute('data-next'); 
        if(STATE.activeTab==='solution'){ STATE.showSolutionCards=false; }
        render();
      }));

      // Brief controls
      const briefToggle = root.querySelector('[data-action="toggle-brief"]');
      if (briefToggle) briefToggle.addEventListener('click', ()=>{
        STATE.brief.expanded = !STATE.brief.expanded;
        render();
      });

      const briefInput = root.querySelector('[data-action="set-brief-text"]');
      if (briefInput) {
        const saveNow = ()=>{
          try {
            localStorage.setItem('recast-brief-notes', STATE.brief.text);
            localStorage.setItem('recast-brief-notes-ts', String(Date.now()));
          } catch {}
          STATE.brief.saving=false;
          STATE.brief.lastSaved = new Date().toISOString();
          const badge = document.querySelector('[aria-live="polite"]');
          if (badge) { badge.textContent = 'Saved'; badge.className = 'text-xs px-2 py-1 rounded-full bg-white text-slate-900'; }
        };
        const debouncedSave = debounce(saveNow, 450);

        briefInput.addEventListener('input', e=>{
          STATE.brief.text = e.target.value;
          STATE.brief.saving=true;
          const prev=document.getElementById('brief-preview');
          const read=document.getElementById('brief-read');
          if(prev){ prev.textContent = STATE.brief.text || 'Add your customer-specific notes on the left.'; }
          if(read){ read.textContent = STATE.brief.text || 'Nothing here yet. Paste notes above.'; }
          debouncedSave();
        });
      }

      const briefClear = root.querySelector('[data-action="brief-clear"]');
      if (briefClear) briefClear.addEventListener('click', ()=>{
        STATE.brief.text = '';
        render();
      });

      const briefTemplate = root.querySelector('[data-action="brief-insert-template"]');
      if (briefTemplate) briefTemplate.addEventListener('click', ()=>{
        const tpl = `Audience:\n- CIO / Director of EUC\n\nGoals:\n- Intune-first app delivery (EAC + WinGet + rings)\n\nBlockers:\n- Packaging backlog, zero-day exposure, policy drift\n\nNarrative:\n- Recast stitches EAC + WinGet + Graph → assign to rings → route via Entra/CA → align with Autopatch\n\nSuccess:\n- Fewer tickets, shorter exposure windows, faster Windows/M365 readiness`;
        STATE.brief.text = STATE.brief.text ? STATE.brief.text + '\n\n' + tpl : tpl;
        render();
      });

      const copyBrief = root.querySelector('[data-action="copy-brief"]');
      if (copyBrief) copyBrief.addEventListener('click', async ()=>{
        try { await navigator.clipboard.writeText(STATE.brief.text || ''); } catch {
          const ta=document.createElement('textarea'); ta.value=STATE.brief.text||''; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        copyBrief.textContent = 'Copied';
        setTimeout(()=>{ copyBrief.textContent='Copy'; }, 900);
      });

      // Why* dropdowns (one open)
      root.querySelectorAll('[data-action="toggle-why"]').forEach(b=>b.addEventListener('click',e=>{
        const id=e.currentTarget.getAttribute('data-why');
        STATE.openWhy = STATE.openWhy === id ? null : id;
        render();
      }));

      // Solution interactivity
      root.querySelectorAll('[data-action="set-device"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.device=e.currentTarget.getAttribute('data-value'); render(); }));
      root.querySelectorAll('[data-action="set-network"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.network=e.currentTarget.getAttribute('data-value'); render(); }));
      root.querySelectorAll('[data-action="toggle-compliance"]').forEach(b=>b.addEventListener('click',()=>{ STATE.ctx.compliant=!STATE.ctx.compliant; render(); }));

      const pack=root.querySelector('[data-action="set-pack-hrs"]'); if(pack) pack.addEventListener('input',e=>{ STATE.packHrs=cleanNum(e.target.value); const saved=Math.max(0,STATE.packHrs-STATE.configHrs); const el=e.currentTarget.closest('.sub-card')?.querySelector('strong'); if(el) el.textContent = saved+' hrs saved'; });
      const cfg=root.querySelector('[data-action="set-config-hrs"]'); if(cfg) cfg.addEventListener('input',e=>{ STATE.configHrs=cleanNum(e.target.value); const saved=Math.max(0,STATE.packHrs-STATE.configHrs); const el=e.currentTarget.closest('.sub-card')?.querySelector('strong'); if(el) el.textContent = saved+' hrs saved'; });
      const cur=root.querySelector('[data-action="set-current-hrs"]'); if(cur) cur.addEventListener('input',e=>{ STATE.currentHrs=cleanNum(e.target.value); const reduced=Math.max(0,STATE.currentHrs-1.5); const el=e.currentTarget.closest('.sub-card')?.querySelector('strong'); if(el) el.textContent = round(reduced)+' hrs reduced'; });

      root.querySelectorAll('[data-action="add-impact"]').forEach(b=>b.addEventListener('click',e=>{
        const kind=e.currentTarget.getAttribute('data-kind'); const val=Number(e.currentTarget.getAttribute('data-value'))||0;
        if (kind==='minutes') STATE.impact.minutes+=val;
        if (kind==='pkgHours') STATE.impact.pkgHours+=val;
        if (kind==='riskHrs') STATE.impact.riskHrs+=val;
        updateROIOutputs();
        render();
      }));

      // ROI listeners
      root.querySelectorAll('[data-action="set-roi"]').forEach(inp=>inp.addEventListener('input',e=>{
        const key=e.currentTarget.getAttribute('data-key');
        const v=Number(String(e.target.value).replace(/[^0-9.\-]/g,'')); 
        STATE.roiInputs[key]=isFinite(v)?v:0;
        updateROIOutputs();
      }));

      const resetCalc=root.querySelector('[data-action="reset-calculator"]');
      if(resetCalc) resetCalc.addEventListener('click', ()=>{
        STATE.roiInputs = { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18, loadedCostPerHour: 85, recastAnnualCost: 120000 };
        STATE.impact = { ...STATE.defaults.impact };
        STATE.copied = false;
        render();
      });

      const copyBtn=root.querySelector('[data-action="copy-onepager"]');
      if (copyBtn) copyBtn.addEventListener('click', async ()=>{
        const i = STATE.roiInputs;
        const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
        const hoursFromMinutes = (STATE.impact.minutes * i.users) / 60;
        const totalHoursSavedMonth = hoursFromMinutes + STATE.impact.pkgHours + STATE.impact.riskHrs;
        const dollarSavedMonth = totalHoursSavedMonth * i.loadedCostPerHour;
        const dollarSavedYear = dollarSavedMonth * 12;
        const netBenefitYear = dollarSavedYear - i.recastAnnualCost;
        const roiPct = i.recastAnnualCost ? (netBenefitYear / i.recastAnnualCost) * 100 : 0;
        const fteHoursYear = 2080;
        const fteEquivalent = (totalHoursSavedMonth * 12) / fteHoursYear;
        const body =
`Recast Application Workspace — Executive One-Pager (Intune-aligned)

Assumptions
 - Users: ${i.users}
 - Tickets per user / month: ${i.ticketsPerUserPerMonth}
 - Avg handle: ${i.avgHandleMins} mins
 - Loaded cost: $${i.loadedCostPerHour}/hr
 - Subscription (annual): $${i.recastAnnualCost}

Observed demo impact (illustrative)
 - Minutes saved per user (monthly): ${STATE.impact.minutes}
 - Packaging hours avoided (org): ${STATE.impact.pkgHours}
 - Zero-day window reduced (hrs): ${STATE.impact.riskHrs}

Calculated outcomes
 - Tickets / month: ${num(ticketsMonth)}
 - Hours saved / month: ${round(totalHoursSavedMonth)}
 - $ saved / month: $${num(dollarSavedMonth)}
 - $ saved / year: $${num(dollarSavedYear)}
 - Net benefit / year: $${num(netBenefitYear)}
 - ROI: ${round(roiPct)}%
 - Equivalent IT FTEs freed: ${round(fteEquivalent)}

Notes: Recast complements Microsoft Intune. Metrics are illustrative.`;
        try { await navigator.clipboard.writeText(body); } catch {
          const ta=document.createElement('textarea'); ta.value=body; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        STATE.copied = true; render(); setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
      });

      // Flow controls
      const startBtn=root.querySelector('[data-action="start-flow"]'); if(startBtn) startBtn.addEventListener('click', startFlow);
      const resetBtn=root.querySelector('[data-action="reset-flow"]'); if(resetBtn) resetBtn.addEventListener('click', resetFlow);
      const toggleLabels=root.querySelector('[data-action="toggle-labels"]'); if(toggleLabels) toggleLabels.addEventListener('click', ()=>{ STATE.showLabels=!STATE.showLabels; buildFlow(); });

      const showCards=root.querySelector('[data-action="show-solution-cards"]');
      if(showCards) showCards.addEventListener('click', ()=>{ STATE.showSolutionCards=true; render(); });
    }

    /* ---------- Build Flow ---------- */
    function buildFlow(){
      let base=0;
      CATALOG.forEach(section=>{
        const mount=document.getElementById(section.id); if(!mount) return;
        mount.innerHTML='';
        section.items.forEach((itm,idx)=>{
          const wrap=document.createElement('div'); wrap.className='logo-wrap'; wrap.style.setProperty('--d',(base+idx*0.06).toFixed(2)+'s');
          const ring=document.createElement('div'); ring.className='logo-ring'; ring.innerHTML=itm.svg; ring.title=itm.name; ring.setAttribute('role','img'); ring.setAttribute('aria-label',itm.name);
          wrap.appendChild(ring);
          if(STATE.showLabels){ const label=document.createElement('span'); label.className='logo-name'; label.textContent=itm.name; wrap.appendChild(label); }
          mount.appendChild(wrap);
        });
        base+=0.25;
      });

      buildTiles(document.getElementById('flowConnA'), 14, .5);
      buildTiles(document.getElementById('flowConnB'), 14, .56);
      buildTiles(document.getElementById('flowConnC'), 14, .62);
      buildTiles(document.getElementById('flowGrpA'), 18, .95);
      buildTiles(document.getElementById('flowGrpB'), 18, 1.0);
      buildTiles(document.getElementById('flowGrpC'), 18, 1.05);
      buildTiles(document.getElementById('flowDevA'), 10, 1.5);
      buildTiles(document.getElementById('flowDevB'), 10, 1.55);
      buildTiles(document.getElementById('flowDevC'), 10, 1.6);

      // Reset end-user state to "red"
      const avatar=document.getElementById('endUserAvatar');
      const badge=document.getElementById('endUserBadge');
      if(avatar){ avatar.classList.remove('bg-emerald-500'); avatar.classList.add('bg-rose-600/90'); avatar.textContent='U'; }
      if(badge){ badge.textContent='!'; badge.classList.remove('bg-rose-500'); badge.classList.add('bg-rose-500'); }
    }
    function buildTiles(container,count,baseDelay){
      if(!container) return; container.innerHTML='';
      for(let i=0;i<count;i++){ const d=document.createElement('div'); d.className='tile'; d.style.setProperty('--d',(baseDelay+i*0.04).toFixed(2)+'s'); container.appendChild(d); }
    }

    function startFlow(){
      const card=document.getElementById('flowCard'); if(!card) return;
      card.classList.remove('run'); void card.offsetWidth; card.classList.add('run');
      const flash=document.getElementById('flowHubFlash'); const success=document.getElementById('flowSuccess');
      const avatar=document.getElementById('endUserAvatar'); const badge=document.getElementById('endUserBadge');
      if(flash){ flash.classList.remove('hidden'); setTimeout(()=>flash.classList.add('hidden'),1000); }
      if(success) success.classList.add('hidden');
      setTimeout(()=>{
        if(avatar){ avatar.classList.remove('bg-rose-600/90'); avatar.classList.add('bg-emerald-500'); }
        if(badge){ badge.textContent='✓'; badge.classList.remove('bg-rose-500'); badge.classList.add('bg-green-500'); }
      }, 2100);
      setTimeout(()=>{
        if (success) {
          success.innerHTML = '<i data-lucide="sparkles" class="h-4 w-4"></i><span>Intune assignments & rings applied via Graph — configured once → delivered everywhere.</span>';
          success.classList.remove('hidden');
          if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
        }
      }, 2500);
      setTimeout(()=> card.classList.remove('run'), 6000);
    }
    function resetFlow(){
      const card=document.getElementById('flowCard'); if(!card) return;
      card.classList.remove('run');
      const success=document.getElementById('flowSuccess'); if(success) success.classList.add('hidden');
      const avatar=document.getElementById('endUserAvatar'); const badge=document.getElementById('endUserBadge');
      if(avatar){ avatar.classList.remove('bg-emerald-500'); avatar.classList.add('bg-rose-600/90'); }
      if(badge){ badge.textContent='!'; badge.classList.remove('bg-green-500'); badge.classList.add('bg-rose-500'); }
    }

    /* ---------- Init ---------- */
    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>
