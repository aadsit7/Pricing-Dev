<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recast ‚Äî Compact Click-Through (Realistic Catalog)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="dark light">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'bg-main': '#f9fafb',
              'text-primary': '#111827',
              primary: '#2563eb',
              'primary-hover': '#1d4ed8',
              'border-subtle': '#e5e7eb',
              'primary-blue': '#1e63ff',
              'accent-amber': '#f59e0b',
              'neutral-gray': '#94a3b8',
            },
            borderRadius: {
              radius: '1rem',
            },
            boxShadow: {
              card: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
              hover: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
              'aw-demo': '0 8px 24px rgba(2,6,23,0.08)',
            },
            keyframes: {
              tilePulse: {
                '0%': { transform: 'scale(0.7)', backgroundColor: '#e5e7eb', opacity: '0.4' },
                '60%': { transform: 'scale(1)', backgroundColor: 'var(--primary)', opacity: '1' },
                '100%': { backgroundColor: '#e5e7eb', opacity: '0.9' },
              },
              barGrow: {
                to: { transform: 'scaleX(1)' },
              },
              boltDrop: {
                to: { transform: 'scaleY(1)' },
              },
              appLiftPulse: {
                '0%': { transform: 'translateY(0) scale(1)', filter: 'saturate(0.4)', opacity: '0.65' },
                '30%': { transform: 'translateY(-4px) scale(1.05)' },
                '60%': { transform: 'translateY(-2px) scale(1.02)', filter: 'saturate(1)', opacity: '1' },
                '100%': { transform: 'translateY(0) scale(1)' },
              },
              badgeDrop: {
                to: { opacity: '1', transform: 'translateY(0) scale(1)' },
              },
              fadeInOut: {
                '0%': { opacity: '0' },
                '30%': { opacity: '1' },
                '70%': { opacity: '1' },
                '100%': { opacity: '0' },
              },
              iconLaunch: {
                '0%': { transform: 'scale(1)' },
                '50%': { transform: 'scale(1.1)' },
                '100%': { transform: 'scale(1)' },
              },
              fadeIn: {
                to: { opacity: '1' },
              },
              awFadeIn: {
                from: { opacity: '0', transform: 'translateY(5px)' },
                to: { opacity: '1', transform: 'none' },
              },
            },
            animation: {
              tilePulse: 'tilePulse 1s ease-in-out var(--d, 0s) 1 forwards',
              barGrow: 'barGrow 0.9s ease var(--d, 0s) forwards',
              boltDrop: 'boltDrop 0.9s ease var(--d, 0s) forwards',
              appLiftPulse: 'appLiftPulse 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) var(--d, 0s) 1 forwards',
              badgeDrop: 'badgeDrop 0.8s ease-out var(--d, 0s) forwards',
              fadeInOut: 'fadeInOut 1.5s ease var(--d,0s) forwards',
              iconLaunch: 'iconLaunch 0.5s ease forwards',
              fadeIn: 'fadeIn 1s ease 10s forwards',
              awFadeIn: 'awFadeIn 0.4s ease',
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://unpkg.com">
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body class="min-h-screen antialiased bg-bg-main text-text-primary font-inter">
    <div id="app" class="min-h-screen"></div>
    <script>
      const STATE = {
        activeTab: 'problems',
        impact: { minutes: 9, pkgHours: 6, riskHrs: 22.5 },
        defaults: { impact: { minutes: 9, pkgHours: 6, riskHrs: 22.5 } },
        ctx: { device: 'Windows', network: 'Corporate', compliant: true },
        packHrs: 8, configHrs: 2, currentHrs: 24,
        roiInputs: { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18 },
        copied: false,
        showLabels: false,
        openWhyModal: null,
        openBuckets: { one: false, zero: false, per: false },
        modalOpen: false,
        editBuffers: { change: { intro: '', bullets: '', analyst: '' }, now: { intro: '', bullets: '', analyst: '' }, recast: { intro: '', bullets: '', analyst: '' } },
        currentState: {
          change: {
            intro: "The app layer has become the biggest slowdown in IT. Teams are drowning in apps, constant updates, and one-off fixes, and every project ends up paying the price.",
            bullets: [
              'There are too many apps to manage by hand. Commercial, internal, and legacy software are spread across Intune, ConfigMgr, VDI, Windows, and macOS.',
              'Headcount hasn‚Äôt grown, but the work has exploded. Most teams are already over capacity and spend most of their day reacting to app issues.',
              'Big initiatives keep getting stuck. Cloud moves, Citrix or AVD projects, hardware refreshes, and AI efforts all run into the same wall ‚Äî app readiness.',
              'Technical debt keeps piling up. Different versions of the same app are everywhere, creating more risk, more tickets, and slower recovery when things break.'
            ],
            analyst: "When the application layer is a mess, transformation projects stall or fail. It‚Äôs not because the strategy is wrong, but because there‚Äôs no capacity left to execute."
          },
          now: {
            intro: "IT teams are being asked to manage more apps and more change with the same people and the same tools. The gap between what‚Äôs expected and what‚Äôs possible keeps getting wider.",
            bullets: [
              'App updates and complexity keep increasing, but team size stays the same. You can‚Äôt scale people the way you scale software.',
              'Internal and custom apps don‚Äôt update themselves, so every change adds more manual work, more dependencies, and more risk.',
              'Leadership wants progress on AI, modernization, and new platforms, but the teams who could drive that progress are stuck keeping apps running.',
              'The longer this goes on, the worse it gets. Version sprawl grows, security and compliance get harder, and cleanup costs rise fast.'
            ],
            analyst: "In the next few years, the organizations that succeed with AI and modernization will be the ones that fix app delivery first. Everyone else will hit a hard capacity wall."
          },
          recast: {
            intro: "Recast‚Äôs Application Workspace solves the core problem. It gives IT one place to package, update, and manage every application so the app layer stops slowing everything down.",
            bullets: [
              'One workspace for every app, whether commercial, internal, or legacy. Installs, updates, and access all handled consistently across Intune, ConfigMgr, AVD, and other systems.',
              'Automates what teams still do by hand ‚Äî packaging, versioning, and pushing updates, especially for internal and custom apps.',
              'Reduces technical debt and version sprawl, which means fewer variables when something breaks and far fewer app-related tickets.',
              'Frees up IT capacity. What used to take hours now takes minutes, so migrations, pilots, patch cycles, and AI projects can finally move at business speed.'
            ],
            analyst: "Recast turns app management from a drag on every project into a stable foundation. Readiness stops being the blocker and becomes the default."
          }
        },
        defaultsCurrentState() {
          return JSON.parse(JSON.stringify({
            change: {
              intro: "The app layer has become the biggest slowdown in IT. Teams are drowning in apps, constant updates, and one-off fixes, and every project ends up paying the price.",
              bullets: [
                'There are too many apps to manage by hand. Commercial, internal, and legacy software are spread across Intune, ConfigMgr, VDI, Windows, and macOS.',
                'Headcount hasn‚Äôt grown, but the work has exploded. Most teams are already over capacity and spend most of their day reacting to app issues.',
                'Big initiatives keep getting stuck. Cloud moves, Citrix or AVD projects, hardware refreshes, and AI efforts all run into the same wall ‚Äî app readiness.',
                'Technical debt keeps piling up. Different versions of the same app are everywhere, creating more risk, more tickets, and slower recovery when things break.'
              ],
              analyst: "When the application layer is a mess, transformation projects stall or fail. It‚Äôs not because the strategy is wrong, but because there‚Äôs no capacity left to execute."
            },
            now: {
              intro: "IT teams are being asked to manage more apps and more change with the same people and the same tools. The gap between what‚Äôs expected and what‚Äôs possible keeps getting wider.",
              bullets: [
                'App updates and complexity keep increasing, but team size stays the same. You can‚Äôt scale people the way you scale software.',
                'Internal and custom apps don‚Äôt update themselves, so every change adds more manual work, more dependencies, and more risk.',
                'Leadership wants progress on AI, modernization, and new platforms, but the teams who could drive that progress are stuck keeping apps running.',
                'The longer this goes on, the worse it gets. Version sprawl grows, security and compliance get harder, and cleanup costs rise fast.'
              ],
              analyst: "In the next few years, the organizations that succeed with AI and modernization will be the ones that fix app delivery first. Everyone else will hit a hard capacity wall."
            },
            recast: {
              intro: "Recast‚Äôs Application Workspace solves the core problem. It gives IT one place to package, update, and manage every application so the app layer stops slowing everything down.",
              bullets: [
                'One workspace for every app, whether commercial, internal, or legacy. Installs, updates, and access all handled consistently across Intune, ConfigMgr, AVD, and other systems.',
                'Automates what teams still do by hand ‚Äî packaging, versioning, and pushing updates, especially for internal and custom apps.',
                'Reduces technical debt and version sprawl, which means fewer variables when something breaks and far fewer app-related tickets.',
                'Frees up IT capacity. What used to take hours now takes minutes, so migrations, pilots, patch cycles, and AI projects can finally move at business speed.'
              ],
              analyst: "Recast turns app management from a drag on every project into a stable foundation. Readiness stops being the blocker and becomes the default."
            }
          }));
        },
        progress: { apps: 0, time: 0, tickets: 0 }
      };
      const TABS = [
        { id: 'problems', label: 'Current State', icon: 'alert-triangle' },
        { id: 'solution', label: 'Recast Approach', icon: 'workflow' },
        { id: 'roi', label: 'Business Impact', icon: 'bar-chart-3' }
      ];
      function cx(...a){ return a.filter(Boolean).join(' '); }
      function round(n){ return Math.round(n*100)/100; }
      function num(n){ return new Intl.NumberFormat().format(Math.round(n)); }
      function routeRecommendation(ctx){
        if(!ctx.compliant) return 'Web';
        if(ctx.device==='Windows' && ctx.network!=='Home') return 'Local';
        return 'VDI';
      }
      function cleanNum(v){ v = Number(String(v).replace(/[^0-9.\-]/g,'')); return isFinite(v) ? v : 0; }
      function render(){
        const root=document.getElementById('app');
        root.innerHTML = `
          <header class="relative">
            <div class="relative mx-auto max-w-6xl px-4 pt-8 pb-6">
              <h1 class="text-[40px] md:text-[56px] font-semibold leading-tight"><span class="text-primary">Re</span><span class="text-[#0A1C60]">cast</span> Software</h1>
              <p class="mt-2 max-w-2xl text-base leading-relaxed text-gray-600">
                ${STATE.activeTab==='problems'
                  ? 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more‚Äîmaking the tools you already use faster, smarter, and easier to manage'
                  : 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more‚Äîmaking the tools you already use faster, smarter, and easier to manage'}
              </p>
            </div>
            <div class="relative mx-auto max-w-6xl px-4">
              <div role="tablist" aria-label="Demo sections" class="flex w-full flex-wrap gap-2 rounded bg-slate-50 p-1 ring-1 ring-slate-200">
                ${TABS.map(t=>`
                  <button type="button" class="${cx('inline-flex items-center gap-2 px-3.5 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition', STATE.activeTab===t.id ? 'bg-primary text-white hover:bg-primary-hover rounded' : 'text-[#0A1C60] hover:bg-slate-100 rounded')}" data-action="switch-tab" data-tab="${t.id}" aria-controls="panel-${t.id}" aria-selected="${STATE.activeTab===t.id}">
                    <i data-lucide="${t.icon}" class="w-4 h-4"></i><span>${t.label}</span>
                  </button>
                `).join('')}
              </div>
            </div>
          </header>
          <main class="mx-auto max-w-6xl px-4 pb-16">
            ${STATE.activeTab==='roi' ? `
            <div class="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-3">
              ${chip('Reactive Work Reduced', String(STATE.impact.minutes)+' min/user/mo', 'emerald')}
              ${chip('Hours Saved from Packaging', String(round(STATE.impact.pkgHours)), 'sky')}
              ${chip('Hours Saved from Faster Patching', String(round(STATE.impact.riskHrs)), 'yellow')}
            </div>` : ''}
            <section class="mt-5">${renderActivePanel()}</section>
          </main>
          ${renderModal()}
          ${renderWhyModal()}
        `;
        if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
        attachEvents();
        if (STATE.activeTab === 'solution') { buildFlow(); initAwDemo(); }
        if (STATE.activeTab === 'roi') { updateROIOutputs(); }
      }
      function chip(label,value,tone){
        const tones={emerald:'from-emerald-400/80 to-teal-400/80',sky:'from-sky-400/80 to-indigo-400/80',yellow:'from-yellow-300/90 to-amber-400/90'};
        return `
          <div class="bg-white rounded-radius shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-3">
            <div class="text-xs text-gray-600">${label}</div>
            <div class="mt-1 inline-flex items-center gap-2 rounded-sm bg-gradient-to-r ${tones[tone]} px-2 py-0.5 text-slate-900">
              <i data-lucide="badge-check" class="w-4 h-4"></i><span class="text-sm font-semibold tabular-nums">${value}</span>
            </div>
          </div>
        `;
      }
      function renderActivePanel(){
        if (STATE.activeTab==='problems') return renderProblems();
        if (STATE.activeTab==='solution') return renderSolution();
        if (STATE.activeTab==='roi') return renderROI();
        return '';
      }
      function renderProblems(){
        const items=[
          {t:'Fragmented delivery',s:'Windows / Mac / VDI / Web ‚Äî users guess the right way.',i:'layers'},
          {t:'Packaging backlog',s:'Rebuild per version; updates stall.',i:'boxes'},
          {t:'Zero-day exposure',s:'Patching takes days, not minutes.',i:'shield'},
          {t:'Slow upgrades',s:'Stuck to old images; change is slow.',i:'layout-grid'}
        ];
        return `
          <section id="panel-problems" class="space-y-4">
            <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
              ${items.map(p=>`
                <article class="bg-white rounded-radius shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-4">
                  <div class="flex items-center gap-2"><i data-lucide="${p.i}" class="w-5 h-5 text-primary"></i><h3 class="text-base font-semibold">${p.t}</h3></div>
                  <p class="mt-1 text-sm text-gray-600">${p.s}</p>
                </article>
              `).join('')}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-16 items-stretch">
              ${calloutDropdown('change','alert-triangle','Why Change','bg-slate-50')}
              ${calloutDropdown('now','clock-4','Why Now','bg-slate-50')}
              ${calloutDropdown('recast','sparkles','Why Recast','bg-slate-50', true)}
            </div>
          </section>
        `;
      }
      function calloutDropdown(id, icon, label, headerTone, cta=false){
        return `
          <div class="h-full flex flex-col">
            <button
              type="button"
              class="w-full overflow-hidden ring-1 ring-slate-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition hover:ring-slate-300 shadow-sm rounded-radius"
              data-action="open-why-modal"
              data-why="${id}"
            >
              <div class="${cx('flex items-center justify-between px-5 py-4', headerTone)} border-b border-border-subtle">
                <div class="flex items-center gap-2">
                  <i data-lucide="${icon}" class="w-5 h-5 text-[#0A1C60]" aria-hidden="true"></i>
                  <span class="text-2xl font-semibold tracking-normal text-[#0A1C60]">${label}</span>
                </div>
                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600 transition-transform duration-150" aria-hidden="true"></i>
              </div>
            </button>
          </div>
        `;
      }
      function renderWhyModal(){
        if(!STATE.openWhyModal) return '';
        const id = STATE.openWhyModal;
        const iconMap = { change: 'alert-triangle', now: 'clock-4', recast: 'sparkles' };
        const labelMap = { change: 'Why Change', now: 'Why Now', recast: 'Why Recast' };
        const data = STATE.currentState[id];
        const headerTone = 'bg-slate-50';
        const cta = id === 'recast';
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-300" role="dialog" aria-modal="true" aria-labelledby="why-modal-title-${id}">
            <div class="w-full max-w-4xl mx-4 bg-white rounded-2xl shadow-2xl overflow-hidden transition-transform duration-300 ease-in-out scale-100 opacity-100 max-h-[95vh] overflow-y-auto">
              <div class="${headerTone} px-8 py-6 flex items-center justify-between border-b border-border-subtle">
                <div class="flex items-center gap-3">
                  <i data-lucide="${iconMap[id]}" class="w-8 h-8 text-[#0A1C60]" aria-hidden="true"></i>
                  <h2 id="why-modal-title-${id}" class="text-3xl font-bold tracking-tight text-[#0A1C60]">${labelMap[id]}</h2>
                </div>
                <button type="button" class="text-slate-500 hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 p-2" data-action="close-why-modal" aria-label="Close">
                  <i data-lucide="x" class="w-6 h-6"></i>
                </button>
              </div>
              <div class="p-8 bg-slate-50">
                <p class="text-base leading-relaxed text-gray-600 mb-4">${data.intro}</p>
                <div class="space-y-4">
                  ${data.bullets.map(b=>`
                    <div class="bg-white p-4 rounded-lg shadow-sm flex items-start gap-3 hover:shadow-md transition-shadow duration-300">
                      <i data-lucide="check-circle" class="w-5 h-5 text-primary flex-shrink-0 mt-0.5"></i>
                      <p class="text-base leading-relaxed text-gray-600">${b}</p>
                    </div>
                  `).join('')}
                </div>
                <div class="mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 flex items-start gap-3">
                  <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"></i>
                  <p class="text-base italic text-gray-600">${data.analyst}</p>
                </div>
                ${cta?`
                  <div class="mt-8 flex justify-center">
                    <button id="btnAdvanceToSolution" type="button" data-action="advance" data-next="solution" class="inline-flex bg-primary text-white text-base font-semibold px-6 py-3 items-center gap-3 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 shadow-md hover:shadow-lg hover:bg-primary-hover transition-shadow duration-300 rounded-full">
                      <i data-lucide="arrow-right" class="w-5 h-5"></i>
                      How Recast solves it
                    </button>
                  </div>
                `:''}
              </div>
            </div>
          </div>
        `;
      }
      function bucketAccordion(id, icon, label, contentFunc, headerTone='bg-slate-50'){
        const expanded = STATE.openBuckets[id];
        const contentId = `bucket-content-${id}`;
        return `
          <div class="flex flex-col">
            <button
              type="button"
              class="w-full overflow-hidden ring-1 ring-slate-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition hover:ring-slate-300 shadow-sm rounded-radius"
              data-action="toggle-bucket"
              data-bucket="${id}"
              aria-expanded="${expanded}"
              aria-controls="${contentId}"
            >
              <div class="flex items-center justify-between px-5 py-4 ${headerTone} border-b border-border-subtle">
                <div class="flex items-center gap-2">
                  <i data-lucide="${icon}" class="w-5 h-5 text-[#0A1C60]" aria-hidden="true"></i>
                  <span class="text-lg font-semibold tracking-normal text-[#0A1C60]">${label}</span>
                </div>
                <i data-lucide="${expanded?'chevron-up':'chevron-down'}" class="w-5 h-5 text-gray-600 transition-transform duration-150" aria-hidden="true"></i>
              </div>
            </button>
            <div id="${contentId}" class="overflow-hidden transition-[max-height,opacity] duration-150 ease-in-out ${expanded ? 'max-h-[1200px] opacity-100' : 'max-h-0 opacity-0'}">
              ${expanded ? contentFunc() : ''}
            </div>
          </div>
        `;
      }
      function onePackageContent(){
        const saved=Math.max(0, Number(STATE.packHrs)-Number(STATE.configHrs));
        return `
          <div class="p-4">
            <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-3 text-sm">
              <div class="flex items-center gap-2 font-medium"><i data-lucide="wand-sparkles" class="w-4 h-4"></i> Hours Saved from Packaging</div>
              <label class="mt-2 flex items-center gap-2 text-xs">
                <span class="text-gray-600">Hours/package</span>
                <input class="w-16 rounded bg-slate-100 px-2 py-1" value="${STATE.packHrs}" inputmode="decimal" data-action="set-pack-hrs" aria-label="Hours per package">
                <span>‚Üí</span>
                <input class="w-16 rounded bg-slate-100 px-2 py-1" value="${STATE.configHrs}" inputmode="decimal" data-action="set-config-hrs" aria-label="Hours to configure">
              </label>
              <div class="mt-2 flex items-center justify-between rounded bg-slate-100 px-3 py-2"><span class="tabular-nums">${STATE.packHrs} ‚Üí ${STATE.configHrs} hrs</span><strong class="tabular-nums">${saved} hrs saved</strong></div>
              <div class="mt-2 text-xs flex flex-wrap gap-2">
                <span class="rounded px-2 py-1 bg-slate-100">‚òÅÔ∏è Cloud</span>
                <span class="rounded px-2 py-1 bg-slate-100">üñ•Ô∏è On-Prem</span>
                <span class="rounded px-2 py-1 bg-slate-100">üîÄ Hybrid</span>
              </div>
              <button type="button" class="mt-2 bg-primary text-white px-3 py-1 text-xs font-semibold w-full rounded hover:bg-primary-hover" data-action="add-impact" data-kind="pkgHours" data-value="${saved}">Add to impact</button>
            </div>
          </div>
        `;
      }
      function zeroDayContent(){
        const reduced=Math.max(0, Number(STATE.currentHrs)-1.5);
        return `
          <div class="p-4">
            <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-3 text-sm">
              <div class="flex items-center gap-2 font-medium"><i data-lucide="shield-check" class="w-4 h-4"></i> Hours Saved from Faster Patching</div>
              <label class="mt-2 flex items-center gap-2 text-xs">
                <span class="text-gray-600">Current hrs</span>
                <input class="w-20 rounded bg-slate-100 px-2 py-1" value="${STATE.currentHrs}" inputmode="decimal" data-action="set-current-hrs" aria-label="Current time to deploy (hours)">
              </label>
              <div class="mt-2 flex items-center justify-between rounded bg-slate-100 px-3 py-2"><span class="tabular-nums">${STATE.currentHrs} ‚Üí 1.5 hrs</span><strong class="tabular-nums">${round(reduced)} hrs reduced</strong></div>
              <button type="button" class="mt-2 bg-primary text-white px-3 py-1 text-xs font-semibold w-full rounded hover:bg-primary-hover" data-action="add-impact" data-kind="riskHrs" data-value="${reduced}">Add to impact</button>
            </div>
          </div>
        `;
      }
      function perUserContent(){
        const totalMin = Math.max(0, Number(STATE.impact.minutes));
        const route=routeRecommendation(STATE.ctx);
        return `
          <div class="p-4">
            <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-3 text-sm">
              <div class="flex items-center gap-2 font-medium"><i data-lucide="mouse-pointer" class="w-4 h-4"></i> Reactive Work Reduced</div>
              <div class="mt-2 flex items-center justify-between rounded bg-slate-100 px-3 py-2">
                <span class="tabular-nums">18 ‚Üí ${totalMin} min</span>
                <strong class="tabular-nums">${totalMin} min saved</strong>
              </div>
            </div>
            <div class="mt-2 grid grid-cols-3 gap-2 text-xs">
              ${['Windows','Mac'].map(d=>pill(d,STATE.ctx.device===d,'set-device',d)).join('')}
              ${['Corporate','VPN'].map(n=>pill(n,STATE.ctx.network===n,'set-network',n)).join('')}
              ${pill(STATE.ctx.compliant?'Compliant':'Non-compliant',STATE.ctx.compliant,'toggle-compliance','')}
            </div>
            <div class="mt-3"><button type="button" class="bg-transparent text-[#0A1C60] border-2 border-[#0A1C60] px-3 py-1 text-xs w-full rounded hover:text-primary hover:border-primary" data-action="add-impact" data-kind="minutes" data-value="2">Add to impact (+2 min saved per user)</button></div>
          </div>
        `;
      }
      function renderSolution(){
        return `
          <section id="panel-solution" class="space-y-3">
            <div class="grid grid-cols-1 gap-3 lg:grid-cols-2">
              ${renderFlow()}
              <section id="awDemo" class="bg-white border border-[rgba(15,23,42,0.1)] rounded-[14px] shadow-aw-demo p-5 text-[#0f172a]">
                <header class="mb-4">
                  <h2 class="text-[18px] mb-1">Modern IT Challenges ‚Äî Expectations vs. Reality</h2>
                  <p class="text-[13px] text-[rgba(15,23,42,0.7)]">Requests and change are accelerating faster than IT resources can scale.</p>
                </header>
                <div class="aw-stage">
                  <article class="aw-scene hidden" data-scene="0">
                    <div>
                      <div style="max-width:900px;">
  <svg viewBox="0 0 900 520" width="100%" height="auto" xmlns="http://www.w3.org/2000/svg">
    <style>
      .title { font: 700 30px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill:#111; }
      .label { font: 600 18px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill:#111; }
      .small { font: 500 16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill:#444; }
      .axis  { stroke:#111; stroke-width:4; }
      .tick  { stroke:#111; stroke-width:3; }
    </style>

    <defs>
      <!-- light grid background -->
      <pattern id="grid" width="24" height="24" patternUnits="userSpaceOnUse">
        <path d="M24 0H0V24" fill="none" stroke="#d7d7d7" stroke-width="1"/>
      </pattern>

      <!-- diagonal hatch fill for the gap -->
      <pattern id="hatch" width="14" height="14" patternUnits="userSpaceOnUse" patternTransform="rotate(30)">
        <line x1="0" y1="0" x2="0" y2="14" stroke="#c61a1a" stroke-width="4" opacity="0.75"/>
      </pattern>
    </defs>

    <!-- chart area -->
    <rect x="70" y="50" width="780" height="380" fill="url(#grid)" stroke="#111" stroke-width="4"/>

    <!-- axes (left + bottom) -->
    <line class="axis" x1="70" y1="50" x2="70" y2="430"/>
    <line class="axis" x1="70" y1="430" x2="850" y2="430"/>

    <!-- y-axis ticks -->
    <g opacity="0.95">
      <line class="tick" x1="70" y1="380" x2="52" y2="380"/>
      <line class="tick" x1="70" y1="330" x2="52" y2="330"/>
      <line class="tick" x1="70" y1="280" x2="52" y2="280"/>
      <line class="tick" x1="70" y1="230" x2="52" y2="230"/>
      <line class="tick" x1="70" y1="180" x2="52" y2="180"/>
      <line class="tick" x1="70" y1="130" x2="52" y2="130"/>
      <line class="tick" x1="70" y1="80"  x2="52" y2="80"/>
    </g>

    <!-- capacity line (flat, gray) -->
    <!-- Adjust y=300 to move the capacity up/down -->
    <line x1="70" y1="300" x2="850" y2="300" stroke="#7a7a7a" stroke-width="10" stroke-linecap="round"/>

    <!-- demand curve (red, increasing) -->
    <!-- Tweak these control points to change curvature -->
    <path id="demandCurve"
          d="M 90 390
             C 210 380, 300 360, 380 330
             C 470 295, 540 240, 610 190
             C 690 130, 760 80, 840 65"
          fill="none" stroke="#d31717" stroke-width="12" stroke-linecap="round"/>

    <!-- widening gap: hatched region between curve and capacity line -->
    <!-- This is a closed shape: follow curve, drop to capacity line, return along capacity -->
    <path d="M 380 330
             C 470 295, 540 240, 610 190
             C 690 130, 760 80, 840 65
             L 840 300
             L 380 300
             Z"
          fill="url(#hatch)" opacity="0.9"/>

    <!-- labels inside plot -->
    <text x="585" y="135" class="label" fill="#d31717">Business Demand</text>
    <text x="615" y="160" class="label" fill="#d31717">&amp; Complexity</text>

    <text x="560" y="328" class="label" fill="#6a6a6a" opacity="0.9">IT Execution Capacity</text>

    <!-- callout: The Widening Gap -->
    <g>
      <rect x="160" y="210" width="290" height="70" fill="white" stroke="#d31717" stroke-width="6"/>
      <text x="180" y="255" class="label" fill="#d31717">The Widening Gap</text>

      <!-- pointer to gap -->
      <polyline points="450,280 505,280 545,312"
                fill="none" stroke="#d31717" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
    </g>

    <!-- axis labels -->
    <text x="460" y="495" class="label">Time</text>

    <text x="-290" y="30" transform="rotate(-90)" class="label">Volume/Complexity</text>

    <!-- x-axis segment labels -->
    <text x="110" y="465" class="small">Past 3 Years</text>
    <text x="420" y="465" class="small">Present</text>
    <text x="685" y="465" class="small">Next 3 Years</text>
  </svg>
</div>
                      <p class="mt-2 text-[12px] text-[rgba(15,23,42,0.6)]">IT isn‚Äôt failing ‚Äî it‚Äôs being asked to do exponentially more with linear resources.</p>
                    </div>
                  </article>
                  <article class="aw-scene hidden" data-scene="1">
                    <h3 class="text-[18px] font-medium leading-tight">Why Change ‚Äî The Application Layer Has Become the Slowdown</h3>
                    <p class="text-[13px] text-[rgba(15,23,42,0.7)]">Every platform, every migration, every update waits on app readiness.</p>
                    <div class="mt-[12px] text-center">
                      <div class="flex flex-wrap justify-center gap-[3px]">
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Cloud Migration</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">AI Initiative</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">VDI Project</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Security Patch</span>
                      </div>
                      <div class="bg-[rgba(245,158,11,0.1)] border border-[rgba(245,158,11,0.3)] p-[8px] rounded-[10px] mt-2 flex flex-wrap justify-center gap-[3px]">
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">SCCM</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Intune</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Citrix</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">AVD</span>
                      </div>
                      <div class="mt-2">‚ö†Ô∏è Slow delivery ‚Ä¢ Ticket volume rising</div>
                    </div>
                    <p class="mt-2 text-[12px] text-[rgba(15,23,42,0.6)]">
                      ‚ÄúWhen the app layer is a mess, transformation projects stall ‚Äî not because strategy is wrong, but because there‚Äôs no capacity left to execute.‚Äù
                    </p>
                  </article>
                  <article class="aw-scene hidden" data-scene="2">
                    <h3 class="text-[18px] font-medium leading-tight">Why Recast Application Workspace</h3>
                    <p class="text-[13px] text-[rgba(15,23,42,0.7)]">One orchestration layer that absorbs complexity ‚Äî so IT can move forward.</p>
                    <div class="mt-[12px] text-center flex justify-between items-center gap-2">
                      <div class="flex flex-wrap justify-center gap-[3px]">
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">SCCM</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Intune</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Citrix</span>
                        <span class="inline-block bg-[#f1f5f9] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">AVD</span>
                      </div>
                      <div class="bg-[rgba(30,99,255,0.1)] border border-[rgba(30,99,255,0.3)] rounded-[10px] px-[12px] py-[8px] m-[6px]">Application Workspace</div>
                      <div class="flex flex-wrap justify-center gap-[3px]">
                        <span class="inline-block bg-[rgba(30,99,255,0.08)] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Windows</span>
                        <span class="inline-block bg-[rgba(30,99,255,0.08)] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">macOS</span>
                        <span class="inline-block bg-[rgba(30,99,255,0.08)] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">VDI / AVD</span>
                        <span class="inline-block bg-[rgba(30,99,255,0.08)] rounded-[8px] px-[10px] py-[6px] m-[3px] text-[12px]">Mobile</span>
                      </div>
                    </div>
                    <div class="flex justify-around mt-[12px] text-[13px]">
                      <div><strong id="appsCount" class="block text-[20px] text-primary-blue">0</strong> Apps Processed</div>
                      <div><strong id="hoursSaved" class="block text-[20px] text-primary-blue">0</strong> Hours Saved</div>
                      <div><strong id="ticketsAvoided" class="block text-[20px] text-primary-blue">0</strong> Tickets Avoided</div>
                    </div>
                    <p class="mt-2 text-[12px] text-[rgba(15,23,42,0.6)]">One front door for every app. One control plane for every platform.</p>
                  </article>
                </div>
                <nav class="flex justify-between items-center mt-[14px]">
                  <button class="border border-[rgba(15,23,42,0.15)] rounded-[10px] bg-white px-[12px] py-[8px] cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" data-aw-nav="prev">‚Üê Back</button>
                  <div class="flex gap-[6px]">
                    <button class="w-[8px] h-[8px] rounded-full bg-[rgba(30,99,255,0.2)] cursor-pointer [aria-selected=true]:bg-primary-blue" data-aw-dot="0" aria-selected="true"></button>
                    <button class="w-[8px] h-[8px] rounded-full bg-[rgba(30,99,255,0.2)] cursor-pointer [aria-selected=true]:bg-primary-blue" data-aw-dot="1" aria-selected="false"></button>
                    <button class="w-[8px] h-[8px] rounded-full bg-[rgba(30,99,255,0.2)] cursor-pointer [aria-selected=true]:bg-primary-blue" data-aw-dot="2" aria-selected="false"></button>
                  </div>
                  <button class="bg-primary-blue hover:bg-[#1e63ff]/90 text-white border-transparent rounded-[10px] px-[12px] py-[8px] cursor-pointer transition-colors duration-300" data-aw-nav="next">Next ‚Üí</button>
                </nav>
                <footer class="mt-4">
                  <button class="bg-primary-blue hover:bg-[#1e63ff]/90 text-white border-transparent rounded-[10px] px-[12px] py-[8px] cursor-pointer transition-colors duration-300 w-full md:w-auto" id="awSeeImpact" data-action="advance" data-next="roi">See Business Impact</button>
                </footer>
              </section>
            </div>
          </section>
        `;
      }
      function pill(label,active,action,value){
        return `<button type="button" class="${cx('px-3 py-1 border text-xs transition rounded-sm',active?'bg-primary text-white border-transparent hover:bg-primary-hover':'bg-transparent text-[#0A1C60] border-slate-200 hover:border-primary')}" data-action="${action}" data-value="${String(value)}">${label}</button>`;
      }
      function renderFlow(){
        return `
          <div class="bg-white rounded-radius shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-4">
            <div class="flex items-center justify-between gap-3">
              <div class="flex items-center gap-2">
                <div class="h-6 w-6 rounded-sm grid place-items-center bg-[#0A1C60]"><i data-lucide="boxes" class="h-3.5 w-3.5 text-white"></i></div>
                <div>
                  <h3 class="text-base font-semibold">Application Workspace</h3>
                  <div class="text-xs text-gray-600">Curated & secured catalog</div>
                </div>
              </div>
              <div class="flex items-center gap-2 text-xs">
                <button type="button" class="bg-transparent text-[#0A1C60] border-2 border-[#0A1C60] px-2.5 py-1 rounded hover:text-primary hover:border-primary" data-action="toggle-labels">${STATE.showLabels?'Hide':'Show'} labels</button>
                <button type="button" data-action="start-flow" class="bg-primary text-white px-2.5 py-1.5 text-xs font-semibold rounded hover:bg-primary-hover">Start</button>
                <button type="button" data-action="reset-flow" class="bg-transparent text-[#0A1C60] border-2 border-[#0A1C60] px-2.5 py-1.5 rounded hover:text-primary hover:border-primary">Reset</button>
              </div>
            </div>
            <div class="mt-2 flex gap-2 text-xs">
            </div>
            <div id="flowCard" class="mt-3 border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-3 relative bg-gradient-to-b from-white to-slate-50 shadow-inner ${STATE.showLabels ? 'show-labels' : ''}" role="region" aria-label="Animated flow">
              <div id="progressCounters" class="hidden mb-3 grid grid-cols-3 gap-2 text-sm text-center">
                <div><span class="font-semibold tabular-nums" id="appsProcessed">0</span> apps processed</div>
                <div><span class="font-semibold tabular-nums" id="timeSaved">0</span> hours saved</div>
                <div><span class="font-semibold tabular-nums" id="ticketsAvoided">0</span> tickets avoided</div>
              </div>
              <div class="space-y-2 relative">
                ${CATALOG.map(s=>`
                  <div class="grid grid-cols-[15ch_1fr] gap-2 items-center border-t border-[#e5e7eb] pt-2 first:border-t-0 first:pt-0 transition-all duration-300">
                    <div class="flex items-center gap-2 uppercase text-gray-600 text-xs tracking-widest"><i data-lucide="folder" class="w-3 h-3"></i>${s.title}</div>
                    <div id="${s.id}" class="flex flex-wrap gap-2"></div>
                  </div>
                `).join('')}
                <div id="overlayTag" class="opacity-0 transition-opacity duration-300 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/90 p-4 rounded-radius shadow-card z-10 show-labels:opacity-100 show-labels:delay-500 text-center text-sm text-gray-600">Every app mapped to stage, policy, region, and device.</div>
              </div>
              <div id="flowHubFlash" class="mt-2 hidden text-primary"><span class="inline-flex items-center gap-1 text-xs"><i data-lucide="bolt" class="h-4 w-4"></i><span>Update published</span></span></div>
              <div class="mt-3 grid grid-cols-3 gap-2 relative" aria-hidden="true">
                ${['A','B','C'].map((k,i)=>`
                  <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-2 relative">
                    <div class="text-xs text-gray-600">${['Existing Platforms','Staged Rings','Access & Policy'][i]}</div>
                    <div id="flowConn${k}" class="mt-1 grid grid-cols-10 gap-1.5"></div>
                    <div class="mt-1 h-[0.22rem] rounded-[2px] origin-left scale-x-0 bg-gradient-to-r from-primary to-primary-hover run:animate-barGrow" style="--d:${3 + .5*i}s"></div>
                    <i data-lucide="check-circle" class="absolute top-1 right-1 w-4 h-4 text-green-500 animate-fadeInOut" style="--d:${4 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px bg-gradient-to-r from-transparent to-[#e5e7eb] bg-[length:4px_1px] bg-repeat-x opacity-50"></div>
              </div>
              <div class="mt-3 grid grid-cols-3 gap-2 relative" aria-hidden="true">
                ${['A','B','C'].map((k,i)=>`
                  <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-2 relative">
                    <div class="text-xs text-gray-600">${['Business Unit','Subsidiary','Region'][i]}</div>
                    <div id="flowGrp${k}" class="mt-1 grid grid-cols-8 gap-1.5"></div>
                    <div class="mx-auto mt-1 w-[0.22rem] h-16 rounded-[2px] origin-top scale-y-0 bg-gradient-to-b from-[#0A1C60] to-primary run:animate-boltDrop" style="--d:${5 + .5*i}s"></div>
                    <i data-lucide="shield-check" class="absolute top-1 right-1 w-4 h-4 text-green-500 animate-fadeInOut" style="--d:${6 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px bg-gradient-to-r from-transparent to-[#e5e7eb] bg-[length:4px_1px] bg-repeat-x opacity-50"></div>
              </div>
              <div class="mt-3 grid grid-cols-3 gap-2 relative" aria-hidden="true">
                ${['A','B','C'].map((k,i)=>`
                  <div class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-2 text-center relative">
                    <i data-lucide="${['monitor-smartphone','laptop','smartphone'][i]}" class="h-5 w-5 text-gray-600"></i>
                    <div id="flowDev${k}" class="mt-1 grid grid-cols-6 gap-1.5"></div>
                    <div class="mt-1 text-[11px] text-gray-600">${['Windows & macOS','VDI / Web','Mobile'][i]}</div>
                    <i data-lucide="check-circle" class="absolute top-1 right-1 w-4 h-4 text-green-500 animate-fadeInOut" style="--d:${8 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px bg-gradient-to-r from-transparent to-[#e5e7eb] bg-[length:4px_1px] bg-repeat-x opacity-50"></div>
              </div>
              <div class="mt-3">
                <div id="endUserCard" class="border border-border-subtle bg-bg-main rounded-[0.666rem] transition-shadow duration-300 p-3 transition-all duration-500">
                  <div class="flex items-center gap-3">
                    <div id="endUserAvatar" class="h-9 w-9 grid place-items-center font-semibold rounded-full bg-[#EA4335]">U</div>
                    <div class="text-sm">
                      <div class="font-medium">End user</div>
                      <div id="endUserMessage" class="text-gray-600">Apps on demand ‚Äî no waiting, no tickets.</div>
                    </div>
                  </div>
                  <div class="mt-3 h-[0.38rem] rounded-[2px] origin-left scale-x-0 bg-gradient-to-r from-primary to-primary-hover run:animate-barGrow" style="--d:10s"></div>
                  <div class="relative mt-2 border border-border-subtle bg-[#F7F9FB] rounded-radius p-4">
                    <i data-lucide="laptop" class="h-5 w-5 text-gray-600"></i>
                    <div id="endUserBadge" class="absolute right-2 top-2 w-[1.15rem] h-[1.15rem] rounded-full opacity-0 translate-y-[-6px] scale-90 bg-[#E11D48] grid place-items-center font-bold text-black run:animate-badgeDrop" style="--d:11s">!</div>
                    <div class="mt-1 text-[11px] text-gray-600">Workspace launches the correct app instantly</div>
                  </div>
                  <div id="miniWorkspace" class="mt-3 hidden grid grid-cols-4 gap-2">
                    ${miniApps.map(app => `<div class="w-[2.1rem] h-[2.1rem] rounded-full grid place-items-center bg-white shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] transition-all duration-300 hover:shadow-[0_0_8px_rgba(37,99,235,0.3)] hover:scale-105 cursor-pointer" data-action="launch-icon">${app.svg}</div>`).join('')}
                  </div>
                </div>
                <div id="flowSuccess" class="mt-2 hidden inline-flex items-center gap-1 text-[13px] animate-fadeIn text-green-500"><i data-lucide="sparkles" class="h-4 w-4"></i><span>Configured once ‚Üí delivered everywhere.</span></div>
              </div>
            </div>
          </div>
        `;
      }
      const miniApps = [
        logo('Microsoft Word','W','#185ABD'),
        logo('Microsoft Teams','T','#5B53D6'),
        logo('SAP','SAP','#0A6ED1'),
        logo('Zoom','Z','#0B5CFF')
      ];
      function renderROI(){
        const r = calcROI();
        return `
          <section id="panel-roi" class="space-y-6">
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-2">
              <div class="bg-white rounded-3xl shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-8">
                <h3 class="text-2xl font-light mb-6 text-gray-900">Assumptions</h3>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
                  ${numInput('# users','users', r.i.users)}
                  ${numInput('Tickets per user / mo','ticketsPerUserPerMonth', r.i.ticketsPerUserPerMonth)}
                  ${numInput('Avg handle (mins)','avgHandleMins', r.i.avgHandleMins)}
                </div>
                <div class="mt-8 space-y-6">
                  ${bucketAccordion('per', 'mouse-pointer', 'Reactive Work Reduced', perUserContent)}
                  ${bucketAccordion('one', 'wand-sparkles', 'Hours Saved from Packaging', onePackageContent)}
                  ${bucketAccordion('zero', 'shield-check', 'Hours Saved from Faster Patching', zeroDayContent)}
                </div>
                <div class="mt-8">
                  <button type="button" data-action="open-currentstate-editor" class="inline-flex items-center gap-2 bg-transparent text-gray-600 border-2 border-gray-300 px-5 py-3 text-base font-light focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-full hover:text-primary hover:border-primary">
                    <i data-lucide="edit-3" class="w-5 h-5"></i> Edit Current State
                  </button>
                </div>
              </div>
              <div class="bg-white rounded-3xl shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-8">
                <h3 class="text-2xl font-light mb-6 text-gray-900">Results</h3>
                <div class="space-y-4 text-lg">
                  ${kv('Hours Returned / Month', num(round(r.totalHoursMonth)))}
                  ${kv('Hours Returned / Year', num(round(r.totalHoursYear)))}
                </div>
                <div class="mt-8 flex flex-wrap gap-4">
                  <button type="button" data-action="reset-calculator" class="inline-flex items-center gap-2 bg-transparent text-gray-600 border-2 border-gray-300 px-5 py-3 text-base font-light focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-full hover:text-primary hover:border-primary">Reset</button>
                  <button type="button" data-action="copy-onepager" class="inline-flex items-center gap-2 bg-primary text-white px-5 py-3 text-base font-light focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-full hover:bg-primary-hover">
                    <i data-lucide="clipboard" class="w-5 h-5"></i> ${STATE.copied ? 'Copied!' : 'Copy capacity summary'}
                  </button>
                </div>
              </div>
              <div class="bg-white rounded-3xl shadow-card transition-shadow duration-300 ease-in-out hover:shadow-hover hover:-translate-y-0.5 p-8 col-span-1 md:col-span-2">
                <h3 class="text-2xl font-light mb-6 text-gray-900">Impact Breakdown</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div>
                    <h4 class="text-xl font-light mb-4 text-gray-900">Where the Time Comes From</h4>
                    <div class="space-y-4 text-lg">
                      ${kv('Packaging Work Reduced / Month', num(round(r.packagingHoursMonth)))}
                      ${kv('Zero-Day Patch Time Reduced / Month', num(round(r.patchHoursMonth)))}
                      ${kv('App-Related Reactive Work Reduced / Month', num(round(r.reactiveHoursMonth)))}
                    </div>
                  </div>
                  <div>
                    <h4 class="text-xl font-light mb-4 text-gray-900">Technical Debt Impact</h4>
                    <div class="space-y-4 text-lg">
                      ${kv('App Version Reduction (estimated)', '30-50% fewer active versions')}
                      ${kv('Faster Patch Window', `${STATE.currentHrs} ‚Üí 1.5 hrs (${r.patchReductionPct}% reduction)`)}
                      ${kv('Tickets Avoided (est.)', num(round(r.ticketsAvoided)) + ' / month')}
                    </div>
                  </div>
                  <div>
                    <h4 class="text-xl font-light mb-4 text-gray-900">Project Velocity Impact</h4>
                    <ul class="space-y-4 text-lg list-disc pl-5">
                      <li>Faster migration and pilot cycles (apps ready sooner)</li>
                      <li>Reduces blockers for AVD, W365, AI, and modernization projects</li>
                      <li>Frees capacity for strategic initiatives</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
        `;
      }
      function calcROI(){
        const i = STATE.roiInputs;
        const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
        const reactiveHoursMonth = (STATE.impact.minutes * i.users) / 60;
        const packagingHoursMonth = STATE.impact.pkgHours;
        const patchHoursMonth = STATE.impact.riskHrs;
        const totalHoursMonth = reactiveHoursMonth + packagingHoursMonth + patchHoursMonth;
        const totalHoursYear = totalHoursMonth * 12;
        const ticketsAvoided = (STATE.impact.minutes * i.users) / i.avgHandleMins;
        const patchReductionPct = STATE.currentHrs > 0 ? Math.round((STATE.impact.riskHrs / STATE.currentHrs) * 100) : 0;
        return {
          i,
          ticketsMonth: round(ticketsMonth),
          reactiveHoursMonth: round(reactiveHoursMonth),
          packagingHoursMonth: round(packagingHoursMonth),
          patchHoursMonth: round(patchHoursMonth),
          totalHoursMonth,
          totalHoursYear,
          ticketsAvoided,
          patchReductionPct
        };
      }
      function updateROIOutputs(){
      }
      function setText(id, value){ const el=document.getElementById(id); if(el) el.textContent = String(value); }
      function kv(label,value){
        return `<div class="flex items-center justify-between rounded-sm bg-slate-100 px-3 py-2"><span class="text-gray-600">${label}</span><span class="font-semibold tabular-nums">${value}</span></div>`;
      }
      function numInput(label,key,value){
        return `<label class="flex flex-col gap-1 text-sm"><span class="text-xs text-gray-600">${label}</span><input class="rounded-sm border border-slate-200 bg-slate-50 px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" inputmode="decimal" value="${value}" data-action="set-roi" data-key="${key}"></label>`;
      }
      const CATALOG=[
        {title:'CORE PRODUCTIVITY',id:'cat-core',items:[
          logo('Microsoft Word','W','#185ABD'),
          logo('Microsoft Excel','X','#107C41'),
          logo('PowerPoint','P','#D24726'),
          logo('Outlook','O','#106EBE'),
          logo('Microsoft Teams','T','#5B53D6'),
          logo('Google Docs','Dc','#1A73E8'),
          logo('Google Sheets','Sh','#1E8E3E'),
          logo('Google Slides','Sl','#F9AB00')
        ]},
        {title:'MESSAGING & MEETINGS',id:'cat-collab',items:[
          multiLogo('Slack',['#36C5F0','#2EB67D','#E01E5A','#ECB22E']),
          logo('Zoom','Z','#0B5CFF'),
          logo('Gmail','G','#EA4335'),
          logo('Google Meet','GM','#0F9D58')
        ]},
        {title:'WEB BROWSERS',id:'cat-browsers',items:[
          triLogo('Google Chrome','#EA4335','#FBBC05','#34A853','#4285F4'),
          ringLogo('Microsoft Edge','#0C8EC5','#0AA0A3'),
          flameLogo('Mozilla Firefox','#FF7139','#FFCC00')
        ]},
        {title:'ENTERPRISE APPS',id:'cat-enterprise',items:[
          logo('Salesforce','SF','#00A1E0'),
          logo('Workday','WD','#1F5BFF'),
          logo('ServiceNow','SN','#81B29A'),
          logo('SAP','SAP','#0A6ED1'),
          logo('Oracle NetSuite','NS','#C74634')
        ]},
        {title:'SECURITY & ACCESS',id:'cat-security',items:[
          logo('Duo','D','#3CB371'),
          logo('Okta','O','#007DC1'),
          logo('Ping Identity','P','#C0172C'),
          logo('Cisco AnyConnect','AC','#00B5AD'),
          logo('Microsoft Defender','MD','#0067B8'),
          logo('CrowdStrike Falcon','CS','#D61F26')
        ]},
        {title:'STORAGE & CREATIVE',id:'cat-storage',items:[
          logo('Adobe Acrobat','A','#ED2224'),
          logo('Dropbox','DB','#0061FF'),
          logo('Box','BX','#0061D5'),
          logo('OneDrive','OD','#0A5BD5'),
          logo('ZoomIt / Sysinternals','ZI','#58595B')
        ]}
      ];
      const appConfigs = [
        {stage:'Prod', policy:'MFA + VPN', region:'AMER', device:'Windows'},
        {stage:'QA', policy:'Compliant only', region:'APAC', device:'Any'},
        {stage:'Dev', policy:'MFA required', region:'EMEA', device:'Mac'},
        {stage:'Prod', policy:'VPN only', region:'Global', device:'Windows'},
        {stage:'QA', policy:'MFA required', region:'AMER', device:'Any'},
        {stage:'Dev', policy:'MFA required', region:'APAC', device:'Mac'},
        {stage:'Prod', policy:'Compliant only', region:'EMEA', device:'Windows'},
        {stage:'QA', policy:'VPN only', region:'Global', device:'Any'}
      ];
      let flatIndex = 0;
      CATALOG.forEach(sec => sec.items.forEach(itm => { itm.config = appConfigs[flatIndex % appConfigs.length]; flatIndex++; }));
      function logo(name,letter,color){ return { name, svg: mark(letter,color) }; }
      function mark(letter,color){
        return `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${letter}">
            <defs><linearGradient id="g${letter.replace(/\W/g,'')}" x1="0" x2="1"><stop offset="0" stop-color="${shade(color,.9)}"/><stop offset="1" stop-color="${shade(color,1.1)}"/></linearGradient></defs>
            <rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="url(#g${letter.replace(/\W/g,'')})" stroke="rgba(0,0,0,.15)"/>
          <text x="50%" y="56%" text-anchor="middle" font-size="22" font-family="Inter,Segoe UI,Arial" font-weight="800" fill="#0A1C60">${letter}</text>
          </svg>`;
      }
      function multiLogo(name,colors){
        const slices=colors.map((c,i)=>`<rect x="${4+i*9}" y="8" width="7" height="32" rx="4" fill="${c}"></rect>`).join('');
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/>${slices}</svg>` };
      }
      function triLogo(name,r1,r2,r3,r4){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><circle cx="24" cy="24" r="12" fill="${r4}"/><path d="M24 12 A12 12 0 0 1 36 24 L24 24 Z" fill="${r1}"/><path d="M36 24 A12 12 0 0 1 24 36 L24 24 Z" fill="${r2}"/><path d="M24 36 A12 12 0 0 1 24 12 L24 24 Z" fill="${r3}"/></svg>` };
      }
      function ringLogo(name,c1,c2){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><circle cx="24" cy="24" r="11" fill="${c1}"/><circle cx="20" cy="20" r="8" fill="${c2}"/></svg>` };
      }
      function flameLogo(name,c1,c2){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><path d="M24 12c5 7-2 9 3 14 3 3 2 9-3 11-5-2-6-8-3-11 5-5-3-7 3-14z" fill="${c1}"/><circle cx="26" cy="28" r="4" fill="${c2}"/></svg>` };
      }
      function shade(hex,m){ const c=hex.replace('#',''); const n=[0,1,2].map(i=>parseInt(c.slice(i*2,i*2+2),16)); const s=n.map(v=>Math.max(0,Math.min(255,Math.round(v*m)))); return '#'+s.map(v=>v.toString(16).padStart(2,'0')).join(''); }
      const USER_ID = String(window.APP_USER_ID || "guest");
      const PAGE_SCOPE = location.origin + location.pathname + location.search;
      const STORAGE_KEY = `currentState:${USER_ID}:${PAGE_SCOPE}`;
      let DEFAULT_CURRENT_STATE = null;
      const $ = (sel, ctx = document) => ctx.querySelector(sel);
      const fields = {
        changeIntro: () => $('#changeIntro'),
        changeBullets: () => $('#changeBullets'),
        changeAnalyst: () => $('#changeAnalyst'),
        nowIntro: () => $('#nowIntro'),
        nowBullets: () => $('#nowBullets'),
        nowAnalyst: () => $('#nowAnalyst'),
        recastIntro: () => $('#recastIntro'),
        recastBullets: () => $('#recastBullets'),
        recastAnalyst: () => $('#recastAnalyst')
      };
      function captureDefaultsOnce(){
        if (DEFAULT_CURRENT_STATE) return;
        DEFAULT_CURRENT_STATE = STATE.defaultsCurrentState();
      }
      function readFields(){
        return {
          change: {
            intro: fields.changeIntro()?.value ?? "",
            bullets: fields.changeBullets()?.value ?? "",
            analyst: fields.changeAnalyst()?.value ?? ""
          },
          now: {
            intro: fields.nowIntro()?.value ?? "",
            bullets: fields.nowBullets()?.value ?? "",
            analyst: fields.nowAnalyst()?.value ?? ""
          },
          recast: {
            intro: fields.recastIntro()?.value ?? "",
            bullets: fields.recastBullets()?.value ?? "",
            analyst: fields.recastAnalyst()?.value ?? ""
          }
        };
      }
      function writeFields(data){
        if(!data) return;
        if(fields.changeIntro()) fields.changeIntro().value = data.change.intro ?? "";
        if(fields.changeBullets()) fields.changeBullets().value = data.change.bullets ?? "";
        if(fields.changeAnalyst()) fields.changeAnalyst().value = data.change.analyst ?? "";
        if(fields.nowIntro()) fields.nowIntro().value = data.now.intro ?? "";
        if(fields.nowBullets()) fields.nowBullets().value = data.now.bullets ?? "";
        if(fields.nowAnalyst()) fields.nowAnalyst().value = data.now.analyst ?? "";
        if(fields.recastIntro()) fields.recastIntro().value = data.recast.intro ?? "";
        if(fields.recastBullets()) fields.recastBullets().value = data.recast.bullets ?? "";
        if(fields.recastAnalyst()) fields.recastAnalyst().value = data.recast.analyst ?? "";
      }
      function loadDraft(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : null;
        }catch{return null;}
      }
      function saveDraft(payload){
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(payload)); }
        catch(e){ console.warn('Save failed (storage blocked or full):', e); }
      }
      function clearDraft(){
        try{ localStorage.removeItem(STORAGE_KEY); }catch{}
      }
      function initCurrentStateModal(){
        captureDefaultsOnce();
        const draft = loadDraft();
        if(draft) writeFields(draft);
        const saveBtn = $('#btnSaveCurrentState');
        const resetBtn = $('#btnResetCurrentState');
        if (saveBtn && !saveBtn.dataset.wired){
          saveBtn.dataset.wired = "1";
          saveBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            saveDraft(readFields());
          });
        }
        if (resetBtn && !resetBtn.dataset.wired){
          resetBtn.dataset.wired = "1";
          resetBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            clearDraft();
            writeFields(DEFAULT_CURRENT_STATE);
            STATE.currentState = STATE.defaultsCurrentState();
            render();
          });
        }
      }
      function renderModal(){
        if(!STATE.modalOpen) return '';
        const buf = STATE.editBuffers;
        const toLines = arr => arr.join('\n');
        const ensure = v => v ?? '';
        return `
          <div role="dialog" aria-modal="true" aria-labelledby="cs-editor-title" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 overflow-auto p-4 md:p-8 transition-opacity duration-300">
            <div class="w-[95vw] h-[95vh] bg-white rounded-2xl shadow-2xl p-8 overflow-y-auto">
              <div class="flex items-center justify-between">
                <h2 id="cs-editor-title" class="text-xl font-semibold tracking-normal">Edit Current State</h2>
                <button type="button" class="bg-transparent text-[#0A1C60] p-2 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded" data-action="close-modal" aria-label="Close">
                  <i data-lucide="x" class="w-4 h-4"></i>
                </button>
              </div>
              <p class="mt-1 text-sm text-gray-600">Edit the introduction, bullets (one per line, max 4), and analyst trend for each section.</p>
              <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
                ${editorSection('change','Why Change', ensure(buf.change.intro) || STATE.currentState.change.intro, ensure(buf.change.bullets) || toLines(STATE.currentState.change.bullets), ensure(buf.change.analyst) || STATE.currentState.change.analyst)}
                ${editorSection('now','Why Now', ensure(buf.now.intro) || STATE.currentState.now.intro, ensure(buf.now.bullets) || toLines(STATE.currentState.now.bullets), ensure(buf.now.analyst) || STATE.currentState.now.analyst)}
                ${editorSection('recast','Why Recast', ensure(buf.recast.intro) || STATE.currentState.recast.intro, ensure(buf.recast.bullets) || toLines(STATE.currentState.recast.bullets), ensure(buf.recast.analyst) || STATE.currentState.recast.analyst)}
              </div>
              <div class="mt-5 flex flex-wrap gap-2">
                <button id="btnSaveCurrentState" type="button" data-action="save-currentstate" class="inline-flex items-center gap-2 bg-primary text-white px-4 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded hover:bg-primary-hover">
                  <i data-lucide="save" class="w-4 h-4"></i> Save
                </button>
                <button id="btnResetCurrentState" type="button" data-action="reset-currentstate-defaults" class="inline-flex items-center gap-2 bg-transparent text-[#0A1C60] border-2 border-[#0A1C60] px-4 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded hover:text-primary hover:border-primary">
                  <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Reset to default
                </button>
              </div>
            </div>
          </div>
        `;
      }
      function editorSection(key,label,introValue,bulletsValue,analystValue){
        return `
          <div class="flex flex-col gap-4">
            <span class="text-sm font-semibold">${label}</span>
            <label class="flex flex-col gap-1">
              <span class="text-xs text-gray-600">Introduction</span>
              <textarea id="${key}Intro" data-action="edit-buffer" data-key="${key}" data-subkey="intro" class="min-h-[80px] rounded-sm border border-slate-200 bg-white p-3 text-sm leading-5 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" aria-label="${label} introduction editor" rows="2">${introValue}</textarea>
            </label>
            <label class="flex flex-col gap-1">
              <div class="flex items-center gap-2 text-xs text-gray-600">
                <i data-lucide="check-circle" class="w-4 h-4 text-primary"></i>
                Bullets (one per line, max 4)
              </div>
              <textarea id="${key}Bullets" data-action="edit-buffer" data-key="${key}" data-subkey="bullets" class="min-h-[160px] rounded-sm border border-slate-200 bg-white p-3 text-sm leading-5 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" aria-label="${label} bullets editor" rows="6">${bulletsValue}</textarea>
            </label>
            <label class="flex flex-col gap-1">
              <span class="text-xs text-gray-600">Analyst Trend</span>
              <textarea id="${key}Analyst" data-action="edit-buffer" data-key="${key}" data-subkey="analyst" class="min-h-[80px] rounded-sm border border-slate-200 bg-white p-3 text-sm leading-5 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" aria-label="${label} analyst editor" rows="2">${analystValue}</textarea>
            </label>
          </div>
        `;
      }
      function attachEvents(){
        const root=document.getElementById('app');
        root.querySelectorAll('[data-action="switch-tab"]').forEach(b=>b.addEventListener('click',e=>{
          STATE.activeTab=e.currentTarget.getAttribute('data-tab');
          render();
        }));
        root.querySelectorAll('[data-action="advance"]').forEach(b=>b.addEventListener('click',e=>{
          STATE.activeTab=e.currentTarget.getAttribute('data-next');
          STATE.openWhyModal = null;
          render();
        }));
        root.querySelectorAll('[data-action="open-why-modal"]').forEach(b=>b.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-why');
          STATE.openWhyModal = id;
          render();
        }));
        root.querySelectorAll('[data-action="close-why-modal"]').forEach(b=>b.addEventListener('click',()=>{
          STATE.openWhyModal = null;
          render();
        }));
        root.querySelectorAll('[data-action="toggle-bucket"]').forEach(b=>b.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-bucket');
          STATE.openBuckets[id] = !STATE.openBuckets[id];
          render();
        }));
        root.querySelectorAll('[data-action="set-device"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.device=e.currentTarget.getAttribute('data-value'); render(); }));
        root.querySelectorAll('[data-action="set-network"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.network=e.currentTarget.getAttribute('data-value'); render(); }));
        root.querySelectorAll('[data-action="toggle-compliance"]').forEach(b=>b.addEventListener('click',()=>{ STATE.ctx.compliant=!STATE.ctx.compliant; render(); }));
        const pack=root.querySelector('[data-action="set-pack-hrs"]'); if(pack) pack.addEventListener('input',e=>{ STATE.packHrs=cleanNum(e.target.value); render(); });
        const cfg=root.querySelector('[data-action="set-config-hrs"]'); if(cfg) cfg.addEventListener('input',e=>{ STATE.configHrs=cleanNum(e.target.value); render(); });
        const cur=root.querySelector('[data-action="set-current-hrs"]'); if(cur) cur.addEventListener('input',e=>{ STATE.currentHrs=cleanNum(e.target.value); render(); });
        root.querySelectorAll('[data-action="add-impact"]').forEach(b=>b.addEventListener('click',e=>{
          const kind=e.currentTarget.getAttribute('data-kind'); const val=Number(e.currentTarget.getAttribute('data-value'))||0;
          if (kind==='minutes') STATE.impact.minutes+=val;
          if (kind==='pkgHours') STATE.impact.pkgHours+=val;
          if (kind==='riskHrs') STATE.impact.riskHrs+=val;
          updateROIOutputs();
          render();
        }));
        root.querySelectorAll('[data-action="set-roi"]').forEach(inp=>inp.addEventListener('input',e=>{
          const key=e.currentTarget.getAttribute('data-key');
          const v=Number(String(e.target.value).replace(/[^0-9.\-]/g,''));
          STATE.roiInputs[key]=isFinite(v)?v:0;
          render();
        }));
        const resetCalc=root.querySelector('[data-action="reset-calculator"]');
        if(resetCalc) resetCalc.addEventListener('click', ()=>{
          STATE.roiInputs = { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18 };
          STATE.impact = { ...STATE.defaults.impact };
          STATE.copied = false;
          render();
        });
        const copyBtn=root.querySelector('[data-action="copy-onepager"]');
        if(copyBtn) copyBtn.addEventListener('click', async ()=>{
          const r = calcROI();
          const body =
 `Recast Application Workspace ‚Äî Capacity Dashboard
 Assumptions
  - Users: ${r.i.users}
  - Tickets per user / month: ${r.i.ticketsPerUserPerMonth}
  - Avg handle: ${r.i.avgHandleMins} mins
 Observed impact
  - Minutes saved per user (monthly): ${STATE.impact.minutes}
  - Packaging hours avoided: ${STATE.impact.pkgHours}
  - Zero-day hours avoided: ${STATE.impact.riskHrs}
 Outcomes
  - Hours Returned / Month: ${round(r.totalHoursMonth)}
  - Hours Returned / Year: ${round(r.totalHoursYear)}
  - Packaging Work Reduced / Month: ${round(r.packagingHoursMonth)}
  - Zero-Day Patch Time Reduced / Month: ${round(r.patchHoursMonth)}
  - App-Related Reactive Work Reduced / Month: ${round(r.reactiveHoursMonth)}
  - Tickets Avoided (est.): ${round(r.ticketsAvoided)} / month
  - Faster Patch Window: ${STATE.currentHrs} to 1.5 hrs (${r.patchReductionPct}% reduction)
  - App Version Reduction (estimated): 30-50% fewer active versions
 Notes: Illustrative; replace with your data.`;
          try { await navigator.clipboard.writeText(body); } catch {
            const ta=document.createElement('textarea'); ta.value=body; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
          }
          STATE.copied = true; render(); setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
        });
        const startBtn=root.querySelector('[data-action="start-flow"]'); if(startBtn) startBtn.addEventListener('click', startFlow);
        const resetBtn=root.querySelector('[data-action="reset-flow"]'); if(resetBtn) resetBtn.addEventListener('click', resetFlow);
        const toggleLabels=root.querySelector('[data-action="toggle-labels"]'); if(toggleLabels) toggleLabels.addEventListener('click', ()=>{ STATE.showLabels=!STATE.showLabels; toggleOverlay(); buildFlow(); });
        root.querySelectorAll('[data-action="launch-icon"]').forEach(icon=>icon.addEventListener('click', ()=>{ icon.classList.add('animate-iconLaunch'); setTimeout(()=>icon.classList.remove('animate-iconLaunch'), 500); }));
        const openEditor=root.querySelector('[data-action="open-currentstate-editor"]');
        if(openEditor) openEditor.addEventListener('click', ()=>{
          STATE.modalOpen = true;
          STATE.editBuffers = { change: { intro: '', bullets: '', analyst: '' }, now: { intro: '', bullets: '', analyst: '' }, recast: { intro: '', bullets: '', analyst: '' } };
          render();
          setTimeout(()=>{ try { window.lucide.createIcons(); } catch{} }, 0);
          setTimeout(()=>{ initCurrentStateModal(); }, 0);
        });
      }
      function toggleOverlay(){
        const overlay = document.getElementById('overlayTag');
        if(STATE.showLabels){
          overlay.classList.remove('hidden');
          setTimeout(()=>{ overlay.classList.add('hidden'); },3000);
        }
      }
      function buildFlow(){
        let base=0;
        CATALOG.forEach(section=>{
          const mount=document.getElementById(section.id); if(!mount) return;
          mount.innerHTML='';
          section.items.forEach((itm,idx)=>{
            const wrap=document.createElement('div'); wrap.className='flex items-center gap-1 transition-all duration-300 show-labels:flex-col show-labels:items-start show-labels:gap-[0.2rem]'; wrap.style.setProperty('--d',(base+idx*0.2).toFixed(2)+'s');
            const ring=document.createElement('div'); ring.className='w-[2.1rem] h-[2.1rem] rounded-full grid place-items-center bg-white shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] transition-all duration-300 hover:shadow-[0_0_8px_rgba(37,99,235,0.3)] hover:scale-105 show-labels:w-[1.8rem] show-labels:h-[1.8rem] run:animate-appLiftPulse'; ring.innerHTML=itm.svg; ring.title=itm.name; ring.setAttribute('role','img'); ring.setAttribute('aria-label',itm.name);
            wrap.appendChild(ring);
            if(STATE.showLabels){
              const label=document.createElement('span'); label.className='text-[0.7rem] text-gray-500 opacity-0 -translate-x-[10px] transition-all duration-300 show-labels:opacity-100 show-labels:translate-x-0 whitespace-normal text-left'; label.textContent=itm.name; wrap.appendChild(label);
              const meta=document.createElement('div'); meta.className='text-[0.6rem] text-gray-500 opacity-0 translate-y-[5px] transition-all duration-300 relative top-auto left-auto z-[5] whitespace-nowrap flex flex-col gap-[0.1rem] items-start w-full justify-start show-labels:opacity-100 show-labels:translate-y-0';
              meta.innerHTML = `<span>Stage: ${itm.config.stage}</span><span>Policy: ${itm.config.policy}</span><span>Region: ${itm.config.region}</span><span>Device: ${itm.config.device}</span>`;
              wrap.appendChild(meta);
            }
            mount.appendChild(wrap);
          });
          base+=1.5;
        });
        buildTiles(document.getElementById('flowConnA'), 14, 3);
        buildTiles(document.getElementById('flowConnB'), 14, 3.5);
        buildTiles(document.getElementById('flowConnC'), 14, 4);
        buildTiles(document.getElementById('flowGrpA'), 18, 5);
        buildTiles(document.getElementById('flowGrpB'), 18, 5.5);
        buildTiles(document.getElementById('flowGrpC'), 18, 6);
        buildTiles(document.getElementById('flowDevA'), 10, 8);
        buildTiles(document.getElementById('flowDevB'), 10, 8.5);
        buildTiles(document.getElementById('flowDevC'), 10, 9);
        const avatar=document.getElementById('endUserAvatar');
        const badge=document.getElementById('endUserBadge');
        if(avatar){ avatar.style.background='#EA4335'; avatar.textContent='U'; }
        if(badge){ badge.textContent='!'; badge.style.background='#E11D48'; }
        const message = document.getElementById('endUserMessage');
        if(message) message.textContent = 'Apps on demand ‚Äî no waiting, no tickets.';
        const mini = document.getElementById('miniWorkspace');
        if(mini) mini.classList.add('hidden');
        const counters = document.getElementById('progressCounters');
        if(counters) counters.classList.add('hidden');
        const card = document.getElementById('flowCard');
        if(card) card.classList.remove('run');
        if(STATE.showLabels) card.classList.add('show-labels');
        else card.classList.remove('show-labels');
        const endCard = document.getElementById('endUserCard');
        if(endCard) endCard.classList.remove('scale-105', 'bg-white', 'border-green-500');
        STATE.progress = { apps: 0, time: 0, tickets: 0 };
        updateProgress();
        const success=document.getElementById('flowSuccess'); if(success) success.classList.add('hidden');
      }
      function buildTiles(container,count,baseDelay){
        if(!container) return; container.innerHTML='';
        for(let i=0;i<count;i++){ const d=document.createElement('div'); d.className='w-[0.45rem] h-[0.45rem] rounded-[2px] bg-gray-200 opacity-90 run:animate-tilePulse'; d.style.setProperty('--d',(baseDelay+i*0.1).toFixed(2)+'s'); container.appendChild(d); }
      }
      function startFlow(){
        const card=document.getElementById('flowCard'); if(!card) return;
        card.classList.remove('run'); void card.offsetWidth; card.classList.add('run');
        const flash=document.getElementById('flowHubFlash'); const success=document.getElementById('flowSuccess');
        const avatar=document.getElementById('endUserAvatar'); const badge=document.getElementById('endUserBadge');
        const message = document.getElementById('endUserMessage'); const mini = document.getElementById('miniWorkspace');
        const counters = document.getElementById('progressCounters'); const endCard = document.getElementById('endUserCard');
        if(flash){ flash.classList.remove('hidden'); setTimeout(()=>flash.classList.add('hidden'),2000); }
        if(success) success.classList.add('hidden');
        if(counters) counters.classList.remove('hidden');
        let interval = setInterval(updateProgress, 100);
        setTimeout(()=>{
          if(avatar){ avatar.style.background= '#10b981'; }
          if(badge){ badge.textContent='‚úì'; badge.style.background= '#10b981'; }
          if(message) message.textContent = 'Apps on demand ‚Äî no waiting, no tickets. Workspace launches the correct app instantly.';
          if(mini) mini.classList.remove('hidden');
          if(endCard) endCard.classList.add('scale-105', 'bg-white', 'border-green-500');
          if(success) success.classList.remove('hidden');
          clearInterval(interval);
        }, 11000);
        setTimeout(()=> card.classList.remove('run'), 12000);
      }
      function updateProgress(){
        if(STATE.progress.apps < 128) STATE.progress.apps += 4;
        if(STATE.progress.time < 46) STATE.progress.time += 2;
        if(STATE.progress.tickets < 73) STATE.progress.tickets += 3;
        setText('appsProcessed', STATE.progress.apps > 128 ? 128 : STATE.progress.apps);
        setText('timeSaved', STATE.progress.time > 46 ? 46 : STATE.progress.time);
        setText('ticketsAvoided', STATE.progress.tickets > 73 ? 73 : STATE.progress.tickets);
      }
      function resetFlow(){
        STATE.progress = { apps: 0, time: 0, tickets: 0 };
        STATE.showLabels = false;
        buildFlow();
      }
      function initAwDemo() {
        const root = document.getElementById("awDemo");
        if (!root) return;
        const scenes = root.querySelectorAll(".aw-scene");
        const dots = root.querySelectorAll("[data-aw-dot]");
        const nextBtn = root.querySelector('[data-aw-nav="next"]');
        const prevBtn = root.querySelector('[data-aw-nav="prev"]');
        let idx = 0;
        function setScene(i) {
          idx = Math.max(0, Math.min(i, scenes.length - 1));
          scenes.forEach((s, j) => {
            if (j === idx) {
              s.classList.remove('hidden');
              s.classList.add('block');
              s.classList.remove('animate-awFadeIn'); 
              void s.offsetWidth; 
              s.classList.add('animate-awFadeIn');
            } else {
              s.classList.remove('block', 'animate-awFadeIn');
              s.classList.add('hidden');
            }
          });
          dots.forEach((d, j) => d.setAttribute("aria-selected", j === idx ? "true" : "false"));
          prevBtn.disabled = idx === 0;
          nextBtn.textContent = idx === scenes.length - 1 ? "Restart ‚Ü∫" : "Next ‚Üí";
          if (idx === 2) animateMetrics();
        }
        function animateMetrics() {
          const metrics = [
            { el: "#appsCount", target: 128 },
            { el: "#hoursSaved", target: 46 },
            { el: "#ticketsAvoided", target: 73 }
          ];
          metrics.forEach(m => {
            const el = root.querySelector(m.el);
            let start = 0;
            const step = () => {
              start++;
              el.textContent = Math.min(m.target, start);
              if (start < m.target) requestAnimationFrame(step);
            };
            requestAnimationFrame(step);
          });
        }
        nextBtn.addEventListener("click", () => {
          if (idx === scenes.length - 1) setScene(0);
          else setScene(idx + 1);
        });
        prevBtn.addEventListener("click", () => setScene(idx - 1));
        dots.forEach((d, i) => d.addEventListener("click", () => setScene(i)));
        setScene(0);
      }
      document.addEventListener('DOMContentLoaded', render);
      document.addEventListener('click', (e)=>{
        const act = e.target.closest('[data-action]');
        if(!act) return;
        const action = act.getAttribute('data-action');
        if(action==='close-modal'){
          STATE.modalOpen=false; render();
        }
        if(action==='edit-buffer'){
          const key = act.getAttribute('data-key');
          const subkey = act.getAttribute('data-subkey');
          act.addEventListener('input', (evt)=>{ STATE.editBuffers[key][subkey] = evt.target.value; });
        }
        if(action==='save-currentstate'){
          const parseLines = (s)=> (s||'').split('\n').map(l=>l.trim()).filter(Boolean).slice(0,4);
          const fallback = STATE.defaultsCurrentState();
          const formData = readFields();
          STATE.currentState = {
            change: {
              intro: formData.change.intro.trim() || fallback.change.intro,
              bullets: parseLines(formData.change.bullets) || fallback.change.bullets,
              analyst: formData.change.analyst.trim() || fallback.change.analyst
            },
            now: {
              intro: formData.now.intro.trim() || fallback.now.intro,
              bullets: parseLines(formData.now.bullets) || fallback.now.bullets,
              analyst: formData.now.analyst.trim() || fallback.now.analyst
            },
            recast: {
              intro: formData.recast.intro.trim() || fallback.recast.intro,
              bullets: parseLines(formData.recast.bullets) || fallback.recast.bullets,
              analyst: formData.recast.analyst.trim() || fallback.recast.analyst
            }
          };
          saveDraft({
            change: {
              intro: $('#changeIntro')?.value || '',
              bullets: $('#changeBullets')?.value || '',
              analyst: $('#changeAnalyst')?.value || ''
            },
            now: {
              intro: $('#nowIntro')?.value || '',
              bullets: $('#nowBullets')?.value || '',
              analyst: $('#nowAnalyst')?.value || ''
            },
            recast: {
              intro: $('#recastIntro')?.value || '',
              bullets: $('#recastBullets')?.value || '',
              analyst: $('#recastAnalyst')?.value || ''
            }
          });
          STATE.modalOpen=false;
          STATE.activeTab='problems';
          STATE.openWhyModal=null;
          render();
        }
        if(action==='reset-currentstate-defaults'){
          clearDraft();
          captureDefaultsOnce();
          writeFields(DEFAULT_CURRENT_STATE);
          STATE.currentState = STATE.defaultsCurrentState();
          render();
        }
      });
      document.addEventListener('keydown',(e)=>{
        if(e.key==='Escape' && (STATE.modalOpen || STATE.openWhyModal)){
          STATE.modalOpen=false;
          STATE.openWhyModal=null;
          render();
        }
      });
    </script>
  </body>
</html>
