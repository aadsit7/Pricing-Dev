<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Recast — Compact Click-Through (Realistic Catalog)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"></noscript>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://unpkg.com">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .focus-ring:focus-visible{outline:2px solid #facc15;outline-offset:2px}
    html,body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .section-card{border-radius:1rem;border:1px solid rgba(255,255,255,.08);background:#0c142b}
    .sub-card{border-radius:.75rem;border:1px solid rgba(255,255,255,.08);background:#0a1124}
    .tile{width:.45rem;height:.45rem;border-radius:.25rem;background:#334155;opacity:.9}
    .run .tile{animation:tilePulse 1s ease-in-out var(--d,0s) 1 forwards}
    @keyframes tilePulse{0%{transform:scale(.7);background:#334155;opacity:.4}60%{transform:scale(1);background:#38bdf8;opacity:1}100%{background:#334155;opacity:.9}}
    .flow-bar{height:.22rem;border-radius:.25rem;transform-origin:left center;transform:scaleX(0)}
    .run .flow-bar{animation:barGrow .9s ease forwards var(--d,0s)}
    @keyframes barGrow{to{transform:scaleX(1)}}
    .bolt-line{width:.22rem;border-radius:.25rem;transform-origin:top center;transform:scaleY(0)}
    .run .bolt-line{animation:boltDrop .9s ease forwards var(--d,0s)}
    @keyframes boltDrop{to{transform:scaleY(1)}}
    .logo-ring{width:2.1rem;height:2.1rem;border-radius:9999px;display:grid;place-items:center;background:#0a1226;box-shadow:inset 0 0 0 1px rgba(255,255,255,.15)}
    .logo-wrap{display:flex;align-items:center;gap:.4rem}
    .logo-name{font-size:.7rem;color:#cbd5e1;white-space:nowrap}
    .run .logo-ring{animation:appPop .85s cubic-bezier(.2,.8,.2,1) var(--d,0s) 1 forwards}
    @keyframes appPop{0%{transform:scale(.85);filter:saturate(.4);opacity:.65}60%{transform:scale(1.05);filter:saturate(1);opacity:1}100%{transform:scale(1)}}
    .user-beam{height:.38rem;border-radius:.38rem;transform-origin:left center;transform:scaleX(0)}
    .run .user-beam{animation:barGrow 1s ease forwards var(--d,0s)}
    .badge{width:1.15rem;height:1.15rem;border-radius:.3rem;opacity:0;transform:translateY(-6px) scale(.9)}
    .run .badge{animation:badgeDrop .8s ease-out var(--d,0s) forwards}
    @keyframes badgeDrop{to{opacity:1;transform:translateY(0) scale(1)}}
    .cat-row{display:grid;grid-template-columns:15ch 1fr;gap:.5rem;align-items:center}
    .cat-title{font-size:.7rem;letter-spacing:.08em}
    /* ===== Hero (Intune + Recast + Azure) ===== */
    .hero-wrap{aspect-ratio:1/1;position:relative;isolation:isolate}
    .ring{position:absolute;border-radius:9999px;border:1px dashed rgba(148,163,184,.25);inset:10%}
    .ring.recast{inset:20%;border-style:solid;border-color:rgba(250,204,21,.6)}
    .ring.azure{inset:0%;border-style:solid;border-color:rgba(56,189,248,.35)}
    .node{position:absolute;display:grid;place-items:center;border-radius:9999px}
    .node.intune{width:160px;height:160px;left:50%;top:50%;transform:translate(-50%,-50%);background:#0b1328;box-shadow:inset 0 0 0 2px rgba(99,102,241,.7),0 0 0 10px rgba(99,102,241,.18)}
    .node.recast{width:230px;height:230px;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}
    .node.azure{width:360px;height:360px;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}
    .pulse{animation:pulseHero 1.6s ease-out infinite}
    @keyframes pulseHero{0%{box-shadow:0 0 0 0 rgba(250,204,21,.0),inset 0 0 0 2px rgba(99,102,241,.7)}70%{box-shadow:0 0 0 14px rgba(250,204,21,.06),inset 0 0 0 2px rgba(99,102,241,.7)}100%{box-shadow:0 0 0 0 rgba(250,204,21,.0),inset 0 0 0 2px rgba(99,102,241,.7)}}
    .spoke{position:absolute;height:2px;width:120px;background:linear-gradient(90deg,rgba(148,163,184,.0),rgba(56,189,248,.9));transform-origin:left center;opacity:.25}
    .spoke.active{opacity:1}
    .app-dot{position:absolute;width:14px;height:14px;border-radius:9999px;background:#1f2a44;box-shadow:0 0 0 1px rgba(255,255,255,.15)}
    .app-dot.active{background:#22c55e}
    .label-chip{position:absolute;top:100%;transform:translateY(8px);white-space:nowrap}
    .stage-glow{box-shadow:0 0 0 4px rgba(250,204,21,.25),0 0 40px rgba(250,204,21,.25)}
    .typewriter{overflow:hidden;white-space:nowrap}
    .typewriter.show{animation:tw .6s steps(24,end)}
    @keyframes tw{from{width:0}to{width:100%}}
    @media (prefers-reduced-motion: reduce){
      .pulse,.run .tile,.run .flow-bar,.run .bolt-line,.badge,.typewriter.show{animation:none}
    }
  </style>
</head>
<body class="min-h-screen bg-[#0b1020] text-slate-100 antialiased">
  <div id="app" class="min-h-screen"></div>

  <script>
    const STATE = {
      activeTab: 'problems',
      impact: { minutes: 9, pkgHours: 6, riskHrs: 0 },
      defaults: { impact: { minutes: 9, pkgHours: 6, riskHrs: 0 } },
      ctx: { device: 'Windows', network: 'Corporate', compliant: true },
      packHrs: 8, configHrs: 2, currentHrs: 24,
      roiInputs: { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18, loadedCostPerHour: 85, recastAnnualCost: 120000 },
      copied: false,
      showLabels: false,
      showSolutionCards: true, /* not used in redesigned solution but kept to avoid breaking */
      openWhy: null,

      /* ===== Recast Approach (state machine) ===== */
      solution: {
        index: 0, // 0..N-1
        playing: false,
        beforeAfter: 'before', // 'before' | 'after'
        toggles: {
          platforms: { win:true, mac:true, vdi:true, mobile:true },
          categories: { productivity:true, security:true, web:true },
          policies: { rings:true, conditional:true }
        }
      }
    };

    const TABS = [
      { id: 'problems', label: 'Current State', icon: 'alert-triangle' },
      { id: 'solution', label: 'Recast Approach', icon: 'workflow' },
      { id: 'roi', label: 'Impact & ROI', icon: 'bar-chart-3' }
    ];

    /* ===== Steps drive everything (Principles → Process → Applications) ===== */
    const STEPS = [
      {
        id: 'principle',
        title: 'Principle: Intune is the hub',
        caption: 'Intune is powerful, but app delivery gaps slow adoption.',
        kpiDelta: { minutes: 0, pkgHours: 0, riskHrs: 0 }
      },
      {
        id: 'predict',
        title: 'Predict',
        caption: 'Detect needs and gaps across platforms and categories.',
        kpiDelta: { minutes: 2, pkgHours: 0, riskHrs: 0 }
      },
      {
        id: 'prepare',
        title: 'Prepare',
        caption: 'Recast packages once and aligns policies/rings automatically.',
        kpiDelta: { minutes: 1, pkgHours: 4, riskHrs: 0 }
      },
      {
        id: 'deploy',
        title: 'Deploy',
        caption: 'Apps flow into Intune and out to every device instantly.',
        kpiDelta: { minutes: 3, pkgHours: 1, riskHrs: 8 }
      },
      {
        id: 'operate',
        title: 'Operate',
        caption: 'Zero-day patches land in hours; compliance stays enforced.',
        kpiDelta: { minutes: 3, pkgHours: 1, riskHrs: 6 }
      }
    ];

    function cx(...a){ return a.filter(Boolean).join(' '); }
    function round(n){ return Math.round(n*100)/100; }
    function num(n){ return new Intl.NumberFormat().format(Math.round(n)); }
    function routeRecommendation(ctx){
      if(!ctx.compliant) return 'Web';
      if(ctx.device==='Windows' && ctx.network!=='Home') return 'Local';
      return 'VDI';
    }
    function cleanNum(v){ v = Number(String(v).replace(/[^0-9.\-]/g,'')); return isFinite(v) ? v : 0; }

    function render(){
      const root=document.getElementById('app');
      const isSolution = STATE.activeTab==='solution';
      root.innerHTML = `
        <header class="relative overflow-hidden">
          <div aria-hidden="true" class="absolute inset-0">
            <div class="absolute -top-40 -left-28 h-[420px] w-[420px] blur-[110px] rounded-full bg-gradient-to-br from-sky-500/25 via-indigo-500/20 to-fuchsia-500/30"></div>
            <div class="absolute -top-16 right-0 h-[280px] w-[280px] blur-[110px] rounded-full bg-gradient-to-br from-fuchsia-400/25 via-purple-500/20 to-sky-500/25"></div>
          </div>
          <div class="relative mx-auto max-w-6xl px-4 pt-8 pb-6">
            <h1 class="text-[32px] font-extrabold leading-tight">
              <span class="text-white">${isSolution ? 'Intune at the Center. Recast Makes it Complete.' : 'Recast Software'}</span>
            </h1>
            <p class="mt-2 max-w-2xl text-[16px] leading-[1.5] text-slate-300">
              ${STATE.activeTab==='problems'
                ? 'Application deployment isn’t the problem. Doing it fast, consistently, and securely across the business is. — Microsoft MVP'
                : isSolution
                  ? 'Recast plugs directly into your Intune process on Azure — packaging, patching, and enforcing policies so apps actually arrive where users need them.'
                  : 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more—making the tools you already use faster, smarter, and easier to manage'}
            </p>
          </div>
          <div class="relative mx-auto max-w-6xl px-4">
            <div role="tablist" aria-label="Demo sections" class="flex w-full flex-wrap gap-2 rounded-full bg-[#0b152f] p-1 ring-1 ring-white/10">
              ${TABS.map(t=>`
                <button type="button" class="${cx('inline-flex items-center gap-2 rounded-full px-3.5 py-1.5 text-sm focus-ring transition', STATE.activeTab===t.id ? 'bg-yellow-400 text-slate-900' : 'text-slate-200 hover:bg白/5').replace('白','white')}" data-action="switch-tab" data-tab="${t.id}" aria-controls="panel-${t.id}" aria-selected="${STATE.activeTab===t.id}">
                  <i data-lucide="${t.icon}" class="w-4 h-4"></i><span>${t.label}</span>
                </button>
              `).join('')}
            </div>
          </div>
        </header>

        <main class="mx-auto max-w-6xl px-4 pb-16">
          ${STATE.activeTab!=='problems' ? renderKPIRow() : ''}
          <section class="mt-5">${renderActivePanel()}</section>
        </main>
      `;
      if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
      attachEvents();
      if (STATE.activeTab === 'solution') {
        renderHeroSpokes(); // initialize dynamic hero spokes/dots
        announceCaption(); // ARIA live
      }
      if (STATE.activeTab === 'roi') { updateROIOutputs(); }
    }

    function renderKPIRow(){
      const step = STEPS[STATE.solution.index];
      const simImpact = simulateImpactUntil(STATE.solution.index);
      return `
        <div class="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-3" aria-live="off">
          ${chip('Minutes saved (per user/per month)', String(simImpact.minutes), 'emerald', 'kpi-minutes')}
          ${chip('Packaging hours avoided', String(simImpact.pkgHours), 'sky', 'kpi-pkg')}
          ${chip('Zero-day window reduced (hrs)', String(round(simImpact.riskHrs)), 'yellow', 'kpi-risk')}
        </div>
      `;
    }
    function chip(label,value,tone,id){
      const tones={emerald:'from-emerald-400/80 to-teal-400/80',sky:'from-sky-400/80 to-indigo-400/80',yellow:'from-yellow-300/90 to-amber-400/90'};
      return `
        <div class="section-card p-3">
          <div class="text-[11px] text-slate-300">${label}</div>
          <div id="${id}" class="mt-1 inline-flex items-center gap-2 rounded-full bg-gradient-to-r px-2 py-0.5 text-slate-900 ${tones[tone]}">
            <i data-lucide="badge-check" class="w-4 h-4"></i><span class="text-sm font-semibold tabular-nums">${value}</span>
          </div>
        </div>
      `;
    }

    function renderActivePanel(){
      if (STATE.activeTab==='problems') return renderProblems();
      if (STATE.activeTab==='solution') return renderSolutionRedesigned();
      if (STATE.activeTab==='roi') return renderROI();
      return '';
    }

    /* ===== Existing 'Problems' and utilities kept intact ===== */
    function renderProblems(){
      const items=[
        {t:'Inconsistent app experience',s:'Apps delivered differently across endpoints create complexity. Without unified delivery in Intune, IT is forced to manage multiple workflows, slowing adoption.',i:'layers'},
        {t:'Intune migration bottlenecks',s:'Thousands of apps need to be rebuilt for Intune. Backlogs stall migrations, leaving customers stuck in co-management or delaying Intune cutover.',i:'boxes'},
        {t:'Security gaps in Intune',s:'Delayed Intune app patching exposes enterprises to zero-day attacks and compliance failures — unacceptable in today’s threat landscape.',i:'shield'},
        {t:'Stalled modernization',s:'App readiness is the #1 blocker to Windows and Intune upgrades. Without automated delivery, modernization stalls.',i:'layout-grid'}
      ];
      return `
        <section id="panel-problems" class="space-y-4">
          <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
            ${items.map(p=>`
              <article class="section-card p-4">
                <div class="flex items-center gap-2"><i data-lucide="${p.i}" class="w-5 h-5 text-sky-300"></i><h3 class="text-base font-semibold">${p.t}</h3></div>
                <p class="mt-1 text-sm text-slate-300">${p.s}</p>
              </article>
            `).join('')}
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-16 items-stretch">
            ${calloutDropdown(
              'change',
              'alert-triangle',
              'Why Change',
              [
                'App delivery is the last barrier to Intune adoption. Customers can move devices and policies into Intune, but without a scalable way to package, patch, and deliver apps, rollouts stall.',
                'Fragmentation slows Intune migrations. Too many apps, too many updates — IT can’t keep pace, which means Intune projects hit delays or require hybrid co-management for far too long.',
                'Transformation depends on apps. Cloud security, AI, and Windows modernization all grind to a halt until apps are managed at scale in Intune.'
              ],
              'bg-teal-900',
              false,
            )}

            ${calloutDropdown(
              'now',
              'clock-4',
              'Why Now',
              [
                'Modern work moves fast. Windows updates, SaaS changes, and AI-powered tools update constantly. If apps don’t keep up, Intune adoption lags.',
                'Security pressure is mounting. Zero-day attacks and compliance requirements make slow patching unacceptable — Intune needs apps delivered faster than legacy SCCM or manual packaging allows.',
                'Capacity crunch. IT teams aren’t growing, but Microsoft keeps adding Intune workloads. If app management isn’t solved, enterprises delay migrations or underutilize Intune investments.'
              ],
              'bg-purple-900',
              false,
            )}

            ${calloutDropdown(
              'recast',
              'sparkles',
              'Why Recast',
              [
                'App management built for Intune. Recast delivers packaging, patching, and deployment from a single platform that extends Intune’s reach — no extra infrastructure, no hybrid reliance.',
                'Enterprise scale, proven today. 7,000+ curated apps, automated updates, and instant delivery eliminate manual effort and let customers realize Intune value faster.',
                'Accelerates Microsoft growth. By removing app friction, Recast helps Microsoft land Intune faster, expand workloads (security, compliance, AI), and increase cloud stickiness.'
              ],
              'bg-fuchsia-900',
              true,
            )}
          </div>
        </section>
      `;
    }
    function calloutDropdown(id, icon, label, bullets, headerTone, cta=false, supportLine=''){
      const expanded = STATE.openWhy === id;
      const contentId = `why-content-${id}`;
      return `
        <div class="h-full flex flex-col">
          <button
            type="button"
            class="w-full rounded-2xl overflow-hidden shadow-sm ring-1 ring-white/10 focus-ring transition hover:ring-white/20"
            data-action="toggle-why"
            data-why="${id}"
            aria-expanded="${expanded}"
            aria-controls="${contentId}"
          >
            <div class="${cx('flex items-center justify-between px-5', headerTone)}">
              <div class="flex items-center gap-2">
                <i data-lucide="${icon}" class="w-5 h-5 text-white/95" aria-hidden="true"></i>
                <span class="py-4 text-[22px] font-extrabold tracking-tight text-white">${label}</span>
              </div>
              <i data-lucide="${expanded?'chevron-up':'chevron-down'}" class="w-5 h-5 text-white/90 transition-transform duration-300 ${expanded?'rotate-180':''}" aria-hidden="true"></i>
            </div>

            <div id="${contentId}" class="bg-white text-slate-900 overflow-hidden" style="max-height:${expanded?'1200px':'0'};opacity:${expanded?'1':'0'};transition:max-height 280ms cubic-bezier(.2,.8,.2,1),opacity 280ms ease;padding:${expanded?'24px 20px':'0 20px'}">
              <ul class="list-disc pl-6 text-[18px] leading-[1.45] space-y-3 text-slate-800 text-left">
                ${bullets.map(b=>`<li>${b}</li>`).join('')}
              </ul>
              ${supportLine ? `<p class="mt-4 text-[14px] text-slate-700">${supportLine}</p>` : ''}
              ${cta?`
                <div class="mt-6 flex justify-end">
                  <button type="button" data-action="advance" data-next="solution" class="inline-flex rounded-full bg-[#0b1020] text-white text-[14px] font-semibold px-4 py-2 items-center gap-2 hover:brightness-110 focus-ring">
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    How Recast solves it
                  </button>
                </div>
              `:''}
            </div>
          </button>
        </div>
      `;
    }

    /* ===== Redesigned Solution Tab ===== */
    function renderSolutionRedesigned(){
      const s = STATE.solution;
      const step = STEPS[s.index];
      const rightCards = [
        { id:'speed', title:'Faster app delivery', icon:'zap', before:'Staged manually. Hours lost.', after:'One-click to Intune. Instant rings.' },
        { id:'zeroday', title:'Zero-day patch alignment', icon:'shield-check', before:'Day(s) delay exposes risk.', after:'Hours, not days. Aligned to policy.' },
        { id:'policy', title:'Auto-policy enforcement', icon:'check-circle-2', before:'Drift across devices.', after:'Enforced via Intune at scale.' },
      ];
      return `
        <section id="panel-solution" class="space-y-3" aria-labelledby="solution-title">
          <div class="grid grid-cols-12 gap-4">
            <!-- Left: Inputs/Foundations -->
            <aside class="col-span-12 lg:col-span-3 section-card p-4" aria-label="Inputs and foundations">
              <h3 id="solution-title" class="text-base font-semibold flex items-center gap-2"><i data-lucide="sliders" class="w-4 h-4"></i> Inputs</h3>
              <div class="mt-3 space-y-3">
                <div class="sub-card p-3">
                  <div class="text-xs text-slate-300 mb-2">Existing Platforms</div>
                  <div class="grid grid-cols-2 gap-2">
                    ${togglePill('platforms','win','Windows',s.toggles.platforms.win)}
                    ${togglePill('platforms','mac','macOS',s.toggles.platforms.mac)}
                    ${togglePill('platforms','vdi','VDI/Web',s.toggles.platforms.vdi)}
                    ${togglePill('platforms','mobile','Mobile',s.toggles.platforms.mobile)}
                  </div>
                </div>
                <div class="sub-card p-3">
                  <div class="text-xs text-slate-300 mb-2">App Categories</div>
                  <div class="grid grid-cols-2 gap-2">
                    ${togglePill('categories','productivity','Productivity',s.toggles.categories.productivity)}
                    ${togglePill('categories','security','Security',s.toggles.categories.security)}
                    ${togglePill('categories','web','Web/Browsers',s.toggles.categories.web)}
                  </div>
                </div>
                <div class="sub-card p-3">
                  <div class="text-xs text-slate-300 mb-2">Policies / Rings</div>
                  <div class="grid grid-cols-2 gap-2">
                    ${togglePill('policies','rings','Rings',s.toggles.policies.rings)}
                    ${togglePill('policies','conditional','Conditional',s.toggles.policies.conditional)}
                  </div>
                </div>
                <div class="text-[11px] text-slate-400">Tip: Click items to light up the center. They feed into Intune through Recast.</div>
              </div>
            </aside>

            <!-- Center: Hero -->
            <section class="col-span-12 lg:col-span-6 section-card p-4" role="region" aria-label="Intune and Recast flow">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="h-6 w-6 rounded-lg bg-gradient-to-br from-sky-500 via-indigo-500 to-fuchsia-500 grid place-items-center"><i data-lucide="workflow" class="h-3.5 w-3.5 text-white"></i></div>
                  <div>
                    <h3 class="text-base font-semibold">Intune-Centered Delivery</h3>
                    <div class="text-[12px] text-slate-400">Recast plugs into Intune on Azure to complete app management</div>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button type="button" class="rounded-full border border-white/15 bg-white/10 px-2.5 py-1.5 text-[12px] hover:bg-white/20 focus-ring" data-action="solution-prev" aria-label="Previous step"><i data-lucide="arrow-left" class="w-4 h-4"></i></button>
                  <button type="button" class="rounded-full bg-white px-2.5 py-1.5 text-[12px] font-semibold text-slate-900 hover:brightness-95 focus-ring" data-action="solution-play">${STATE.solution.playing?'Pause':'Play'}</button>
                  <button type="button" class="rounded-full border border-white/15 bg-white/10 px-2.5 py-1.5 text-[12px] hover:bg-white/20 focus-ring" data-action="solution-next" aria-label="Next step"><i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                </div>
              </div>

              <div class="mt-3 hero-wrap" id="hero">
                <!-- Azure outer -->
                <div class="ring azure"></div>
                <div class="node azure grid place-items-center text-[11px] text-slate-300">
                  <div class="label-chip text-sky-300/80">Azure</div>
                </div>

                <!-- Recast middle ring -->
                <div class="ring recast ${highlightIf('prepare','deploy','operate')}" id="recast-ring"></div>
                <div class="node recast grid place-items-center">
                  <div class="rounded-full border border-yellow-400/70 bg-yellow-300/10 px-2 py-1 text-[11px] text-yellow-300 font-semibold backdrop-blur ${highlightIf('prepare','deploy','operate')}">Recast Application Workspace</div>
                </div>

                <!-- Intune center -->
                <div class="node intune ${STATE.solution.index===0 ? 'pulse' : 'stage-glow'}" id="intune-node" aria-label="Intune Hub">
                  <div class="text-center">
                    <div class="text-xs text-indigo-300">Microsoft</div>
                    <div class="text-2xl font-extrabold text-white">Intune</div>
                    <div class="mt-1 text-[11px] text-slate-400">App & policy delivery</div>
                  </div>
                </div>

                <!-- Spokes + app dots injected by JS -->
              </div>

              <div class="mt-3">
                <div class="flex items-center justify-between">
                  <div class="text-sm font-semibold">${step.title}</div>
                  <div class="flex items-center gap-2" role="tablist" aria-label="Stages">
                    ${STEPS.map((_,i)=>`<button type="button" class="h-2.5 w-2.5 rounded-full ${i===STATE.solution.index?'bg-yellow-400':'bg-white/20'} focus-ring" data-action="solution-jump" data-index="${i}" aria-label="Go to step ${i+1}" aria-selected="${i===STATE.solution.index}"></button>`).join('')}
                  </div>
                </div>
                <p id="solution-caption" class="typewriter show mt-2 text-sm text-slate-300" aria-live="polite">${step.caption}</p>
              </div>

              <div class="mt-3 flex items-center justify-between border-t border-white/10 pt-3">
                <div class="text-[12px] text-slate-400">Use ← / → to navigate</div>
                <a href="https://azure.microsoft.com/en-us/marketplace/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-full bg-sky-500/90 px-3 py-1.5 text-sm font-semibold text-black hover:brightness-110 focus-ring" aria-label="Get it on Azure Marketplace">
                  <i data-lucide="store" class="w-4 h-4"></i> Get it on Azure Marketplace
                </a>
              </div>
            </section>

            <!-- Right: Recast Value Add -->
            <aside class="col-span-12 lg:col-span-3 section-card p-4" aria-label="Recast capabilities">
              <div class="flex items-center justify-between">
                <h3 class="text-base font-semibold flex items-center gap-2"><i data-lucide="sparkles" class="w-4 h-4"></i> Recast Value</h3>
                <div class="inline-flex rounded-full bg-white/10 p-1" role="group" aria-label="Before and After toggle">
                  ${beforeAfterButton('before', 'Before')}
                  ${beforeAfterButton('after', 'After')}
                </div>
              </div>
              <div class="mt-3 grid grid-cols-1 gap-2" role="tablist" aria-label="Value cards">
                ${rightCards.map((c,idx)=>`
                  <article role="tab" aria-selected="${idx===activeCardIndex()}" class="sub-card p-3 ${idx===activeCardIndex()?'ring-1 ring-yellow-300/60':''}">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <i data-lucide="${c.icon}" class="w-4 h-4 text-sky-300"></i>
                        <div class="text-sm font-semibold">${c.title}</div>
                      </div>
                      ${idx===activeCardIndex()?'<span class="animate-pulse text-[10px] px-2 py-0.5 rounded-full bg-yellow-300 text-slate-900 font-bold">LIVE</span>':''}
                    </div>
                    <p class="mt-1 text-sm ${STATE.solution.beforeAfter==='before'?'text-rose-300':'text-emerald-300'}">
                      ${STATE.solution.beforeAfter==='before' ? c.before : c.after}
                    </p>
                  </article>
                `).join('')}
              </div>
            </aside>
          </div>
        </section>
      `;
    }
    function beforeAfterButton(mode,label){
      const on = STATE.solution.beforeAfter===mode;
      return `<button type="button" data-action="solution-mode" data-mode="${mode}" class="${cx('px-2 py-1 rounded-full text-xs font-semibold focus-ring', on?'bg-white text-slate-900':'text-slate-200 hover:bg-white/10')}">${label}</button>`;
    }
    function togglePill(group,key,label,active){
      return `<button type="button" data-action="solution-toggle" data-group="${group}" data-key="${key}" class="${cx('rounded-full px-2.5 py-1 text-xs border transition focus-ring', active?'bg-yellow-300 text-slate-900 border-transparent':'bg-[#0a1124] text-slate-200 border-white/10 hover:bg-white/10')}">
        <span>${label}</span>
      </button>`;
    }
    function activeCardIndex(){
      const i = STATE.solution.index;
      if(i<=1) return 0; // Predict -> speed
      if(i===2) return 2; // Prepare -> policy
      return 1; // Deploy/Operate -> zero-day
    }

    /* ===== ROI Tab (unchanged) ===== */
    function renderROI(){
      const r = calcROI();
      return `
        <section id="panel-roi" class="space-y-3">
          <div class="section-card p-3"><div class="text-sm font-medium">Planting consistency in app delivery today is what prevents outages and chaos three years from now.</div></div>

          <div class="grid grid-cols-1 gap-3 sm:grid-cols-4">
            ${kpiId('timer','Hours saved / mo', r.totalHoursSavedMonth, 'Per-user minutes × users + packaging + zero-day', 'kpi-hours')}
            ${kpiId('line-chart','$ saved / yr', '$'+num(r.dollarSavedYear), 'Illustrative only', 'kpi-year')}
            ${kpiId('percent','ROI', r.roiPct+'%', 'Net of subscription', 'kpi-roi')}
            ${kpiId('rocket','Tickets / mo', num(r.ticketsMonth), 'Scale context', 'kpi-tickets')}
          </div>

          <div class="grid grid-cols-1 gap-3 lg:grid-cols-3">
            <div class="section-card p-4 lg:col-span-2">
              <h3 class="text-base font-semibold">Assumptions (edit)</h3>
              <div class="mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2">
                ${numInput('# users','users', r.i.users)}
                ${numInput('Tickets per user / mo','ticketsPerUserPerMonth', r.i.ticketsPerUserPerMonth)}
                ${numInput('Avg handle (mins)','avgHandleMins', r.i.avgHandleMins)}
                ${numInput('Loaded cost ($/hr)','loadedCostPerHour', r.i.loadedCostPerHour)}
                ${numInput('Recast annual cost ($)','recastAnnualCost', r.i.recastAnnualCost)}
              </div>
              <div class="mt-3 text:[11px] text-slate-400">All values are examples. Replace with your data for accurate estimates.</div>
            </div>

            <div class="section-card p-4">
              <h3 class="text-base font-semibold">Results</h3>
              <div class="mt-3 space-y-2 text-sm">
                ${kvId('Hours saved / month', r.totalHoursSavedMonth, 'res-hours')}
                ${kvId('$ saved / month', '$'+num(r.dollarSavedMonth), 'res-month')}
                ${kvId('$ saved / year', '$'+num(r.dollarSavedYear), 'res-year')}
                ${kvId('Net benefit / year', '$'+num(r.netBenefitYear), 'res-net')}
                ${kvId('ROI', r.roiPct+'%', 'res-roi')}
                ${kvId('Equivalent IT FTEs freed', r.fteEquivalent, 'res-fte')}
              </div>
              <div class="mt-2 text-[11px] text-slate-400 italic">Add a short customer proof-point here (e.g., “Cut packaging time by 80% in first 30 days”).</div>
              <div class="mt-4 flex flex-wrap gap-2">
                <button type="button" data-action="reset-calculator" class="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/20 focus-ring">Reset</button>
                <button type="button" data-action="copy-onepager" class="inline-flex items-center gap-2 rounded-full bg-yellow-400 px-4 py-2 text-sm font-semibold text-slate-900 hover:brightness-95 focus-ring">
                  <i data-lucide="clipboard" class="w-4 h-4"></i> ${STATE.copied ? 'Copied!' : 'Copy executive one-pager'}
                </button>
              </div>
            </div>
          </div>

          <p class="text-[11px] text-slate-400">Transparency: Recast AW complements device management (e.g., Intune). Windows/macOS focus. Metrics are illustrative; actuals vary.</p>
        </section>
      `;
    }

    /* ===== Shared utilities (kept) ===== */
    function calcROI(){
      const i = STATE.roiInputs;
      const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
      const hoursFromMinutes = (STATE.impact.minutes * i.users) / 60;
      const totalHoursSavedMonth = hoursFromMinutes + STATE.impact.pkgHours + STATE.impact.riskHrs;
      const dollarSavedMonth = totalHoursSavedMonth * i.loadedCostPerHour;
      const dollarSavedYear = dollarSavedMonth * 12;
      const netBenefitYear = dollarSavedYear - i.recastAnnualCost;
      const roiPct = i.recastAnnualCost ? round((netBenefitYear / i.recastAnnualCost) * 100) : 0;
      const fteHoursYear = 2080;
      const fteEquivalent = round((totalHoursSavedMonth * 12) / fteHoursYear);
      return {
        i,
        ticketsMonth,
        hoursFromMinutes: round(hoursFromMinutes),
        totalHoursSavedMonth: round(totalHoursSavedMonth),
        dollarSavedMonth: round(dollarSavedMonth),
        dollarSavedYear: round(dollarSavedYear),
        netBenefitYear: round(netBenefitYear),
        roiPct,
        fteEquivalent
      };
    }
    function updateROIOutputs(){
      const r = calcROI();
      setText('kpi-hours', r.totalHoursSavedMonth);
      setText('kpi-year', '$'+num(r.dollarSavedYear));
      setText('kpi-roi', r.roiPct+'%');
      setText('kpi-tickets', num(r.ticketsMonth));
      setText('res-hours', r.totalHoursSavedMonth);
      setText('res-month', '$'+num(r.dollarSavedMonth));
      setText('res-year', '$'+num(r.dollarSavedYear));
      setText('res-net', '$'+num(r.netBenefitYear));
      setText('res-roi', r.roiPct+'%');
      setText('res-fte', r.fteEquivalent);
    }
    function setText(id, value){ const el=document.getElementById(id); if(el) el.textContent = String(value); }
    function kpiId(icon,label,value,hint,id){
      return `
        <div class="section-card p-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-[11px] text-slate-300">${label}</div>
              <div id="${id}" class="text-xl font-semibold tabular-nums">${value}</div>
            </div>
            <i data-lucide="${icon}" class="w-5 h-5 text-sky-300"></i>
          </div>
          ${hint ? `<div class="mt-1 text-[11px] text-slate-400">${hint}</div>` : ''}
        </div>
      `;
    }
    function kvId(label,value,id){
      return `<div class="flex items-center justify-between rounded-lg bg-black/20 px-3 py-2"><span class="text-slate-300">${label}</span><span id="${id}" class="font-semibold tabular-nums">${value}</span></div>`;
    }
    function numInput(label,key,value){
      return `<label class="flex flex-col gap-1 text-sm"><span class="text-[12px] text-slate-300">${label}</span><input class="rounded-lg border border-white/10 bg-[#0b1328] px-3 py-1.5 text-sm focus-ring" inputmode="decimal" value="${value}" data-action="set-roi" data-key="${key}"></label>`;
    }

    /* ===== Catalog + legacy flow helpers kept (not used by redesigned solution) ===== */
    const CATALOG=[]; // intentionally empty to avoid unused heavy DOM in new solution

    /* ===== Events ===== */
    function attachEvents(){
      const root=document.getElementById('app');

      root.querySelectorAll('[data-action="switch-tab"]').forEach(b=>b.addEventListener('click',e=>{
        STATE.activeTab=e.currentTarget.getAttribute('data-tab');
        render();
      }));
      root.querySelectorAll('[data-action="advance"]').forEach(b=>b.addEventListener('click',e=>{
        STATE.activeTab=e.currentTarget.getAttribute('data-next');
        render();
      }));

      root.querySelectorAll('[data-action="toggle-why"]').forEach(b=>b.addEventListener('click',e=>{
        const id=e.currentTarget.getAttribute('data-why');
        STATE.openWhy = (STATE.openWhy === id) ? null : id;
        render();
      }));

      // ROI inputs
      root.querySelectorAll('[data-action="set-roi"]').forEach(inp=>inp.addEventListener('input',e=>{
        const key=e.currentTarget.getAttribute('data-key');
        const v=Number(String(e.target.value).replace(/[^0-9.\-]/g,'')); 
        STATE.roiInputs[key]=isFinite(v)?v:0;
        updateROIOutputs();
      }));
      const resetCalc=root.querySelector('[data-action="reset-calculator"]');
      if(resetCalc) resetCalc.addEventListener('click', ()=>{
        STATE.roiInputs = { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18, loadedCostPerHour: 85, recastAnnualCost: 120000 };
        STATE.impact = { ...STATE.defaults.impact };
        STATE.copied = false;
        render();
      });
      const copyBtn=root.querySelector('[data-action="copy-onepager"]');
      if(copyBtn) copyBtn.addEventListener('click', async ()=>{
        const i = STATE.roiInputs;
        const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
        const hoursFromMinutes = (STATE.impact.minutes * i.users) / 60;
        const totalHoursSavedMonth = hoursFromMinutes + STATE.impact.pkgHours + STATE.impact.riskHrs;
        const dollarSavedMonth = totalHoursSavedMonth * i.loadedCostPerHour;
        const dollarSavedYear = dollarSavedMonth * 12;
        const netBenefitYear = dollarSavedYear - i.recastAnnualCost;
        const roiPct = i.recastAnnualCost ? (netBenefitYear / i.recastAnnualCost) * 100 : 0;
        const fteHoursYear = 2080;
        const fteEquivalent = (totalHoursSavedMonth * 12) / fteHoursYear;
        const body =
`Recast Application Workspace — Executive One-Pager

Assumptions
 - Users: ${i.users}
 - Tickets per user / month: ${i.ticketsPerUserPerMonth}
 - Avg handle: ${i.avgHandleMins} mins
 - Loaded cost: $${i.loadedCostPerHour}/hr
 - Subscription (annual): $${i.recastAnnualCost}

Observed demo impact (illustrative)
 - Minutes saved per user (monthly): ${STATE.impact.minutes}
 - Packaging hours avoided (org): ${STATE.impact.pkgHours}
 - Zero-day window reduced (hrs): ${STATE.impact.riskHrs}

Calculated outcomes
 - Tickets / month: ${num(ticketsMonth)}
 - Hours saved / month: ${round(totalHoursSavedMonth)}
 - $ saved / month: $${num(dollarSavedMonth)}
 - $ saved / year: $${num(dollarSavedYear)}
 - Net benefit / year: $${num(netBenefitYear)}
 - ROI: ${round(roiPct)}%
 - Equivalent IT FTEs freed: ${round(fteEquivalent)}

Notes: Illustrative; replace with your data.`;
        try { await navigator.clipboard.writeText(body); } catch {
          const ta=document.createElement('textarea'); ta.value=body; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        STATE.copied = true; render(); setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
      });

      // Solution tab interactions
      if (STATE.activeTab==='solution'){
        root.querySelectorAll('[data-action="solution-toggle"]').forEach(b=>b.addEventListener('click',e=>{
          const group=e.currentTarget.getAttribute('data-group');
          const key=e.currentTarget.getAttribute('data-key');
          STATE.solution.toggles[group][key]=!STATE.solution.toggles[group][key];
          feedHeroFromToggles();
          renderKPIMiniAnimate();
        }));
        const play=root.querySelector('[data-action="solution-play"]');
        const next=root.querySelector('[data-action="solution-next"]');
        const prev=root.querySelector('[data-action="solution-prev"]');
        const modeBtns=root.querySelectorAll('[data-action="solution-mode"]');
        const dots=root.querySelectorAll('[data-action="solution-jump"]');

        if(play) play.addEventListener('click', ()=>{
          STATE.solution.playing = !STATE.solution.playing;
          if(STATE.solution.playing){ autoAdvance(); } else { clearInterval(window.__autoTimer); }
          render();
        });
        if(next) next.addEventListener('click', ()=>{ stepNext(); });
        if(prev) prev.addEventListener('click', ()=>{ stepPrev(); });
        modeBtns.forEach(b=>b.addEventListener('click', e=>{
          STATE.solution.beforeAfter = e.currentTarget.getAttribute('data-mode');
          render();
        }));
        dots.forEach(b=>b.addEventListener('click', e=>{
          const idx=Number(e.currentTarget.getAttribute('data-index'));
          jumpTo(idx);
        }));

        // Keyboard arrows
        document.addEventListener('keydown', onKeyNav);
      } else {
        document.removeEventListener('keydown', onKeyNav);
        clearInterval(window.__autoTimer);
        STATE.solution.playing=false;
      }
    }

    function onKeyNav(e){
      if(STATE.activeTab!=='solution') return;
      if(e.key==='ArrowRight'){ stepNext(); }
      if(e.key==='ArrowLeft'){ stepPrev(); }
    }
    function stepNext(){
      const last=STEPS.length-1;
      STATE.solution.index = Math.min(last, STATE.solution.index+1);
      onStepChange();
    }
    function stepPrev(){
      STATE.solution.index = Math.max(0, STATE.solution.index-1);
      onStepChange();
    }
    function jumpTo(i){
      const clamped=Math.max(0, Math.min(STEPS.length-1, i));
      STATE.solution.index = clamped;
      onStepChange(true);
    }
    function onStepChange(skipAnim=false){
      bumpKPIsToStep(STATE.solution.index);
      if(!skipAnim){ flashHeroForStep(); }
      render();
      dispatchCustom('demo:stateChange',{from:null,to:STEPS[STATE.solution.index].id});
    }
    function autoAdvance(){
      clearInterval(window.__autoTimer);
      window.__autoTimer = setInterval(()=>{
        if(STATE.activeTab!=='solution') return clearInterval(window.__autoTimer);
        if(STATE.solution.index===STEPS.length-1){ STATE.solution.index=0; } else { STATE.solution.index++; }
        onStepChange();
      }, 2200);
    }
    function dispatchCustom(name,detail){ try{ document.dispatchEvent(new CustomEvent(name,{detail})); }catch{} }

    /* ===== KPIs dynamic simulation ===== */
    function simulateImpactUntil(stepIndex){
      const base = { ...STATE.defaults.impact };
      for(let i=0;i<=stepIndex;i++){
        base.minutes += STEPS[i].kpiDelta.minutes;
        base.pkgHours += STEPS[i].kpiDelta.pkgHours;
        base.riskHrs += STEPS[i].kpiDelta.riskHrs;
      }
      return base;
    }
    function bumpKPIsToStep(i){
      const sim = simulateImpactUntil(i);
      STATE.impact.minutes = sim.minutes;
      STATE.impact.pkgHours = sim.pkgHours;
      STATE.impact.riskHrs = sim.riskHrs;
      updateKPIRow();
      updateROIOutputs();
    }
    function updateKPIRow(){
      const mins=document.getElementById('kpi-minutes');
      const pkg=document.getElementById('kpi-pkg');
      const risk=document.getElementById('kpi-risk');
      if(mins) mins.querySelector('span:last-child').textContent = String(STATE.impact.minutes);
      if(pkg) pkg.querySelector('span:last-child').textContent = String(STATE.impact.pkgHours);
      if(risk) risk.querySelector('span:last-child').textContent = String(round(STATE.impact.riskHrs));
    }
    function renderKPIMiniAnimate(){
      // subtle grow effect on update
      ['kpi-minutes','kpi-pkg','kpi-risk'].forEach(id=>{
        const el=document.getElementById(id);
        if(!el) return;
        el.classList.remove('scale-105'); void el.offsetWidth; el.classList.add('scale-105');
        setTimeout(()=>el.classList.remove('scale-105'),200);
      });
    }

    /* ===== Hero construction ===== */
    function renderHeroSpokes(){
      const hero=document.getElementById('hero');
      if(!hero) return;
      // remove old spokes/dots
      hero.querySelectorAll('.spoke,.app-dot').forEach(n=>n.remove());

      // Place spokes around circle (simulate apps/policies flowing)
      const s=STATE.solution;
      const enabledItems = computeEnabledSources();
      const total = enabledItems.length;
      const radius = 180; // from center to spoke dot
      const center = { x: hero.clientWidth/2, y: hero.clientHeight/2 };

      enabledItems.forEach((item,idx)=>{
        const angle = (idx/Math.max(1,total)) * Math.PI*2;
        const x = center.x + Math.cos(angle) * radius;
        const y = center.y + Math.sin(angle) * radius;
        const spoke = document.createElement('div');
        spoke.className='spoke';
        const deg = (angle*180/Math.PI);
        spoke.style.left = `${center.x}px`;
        spoke.style.top = `${center.y}px`;
        spoke.style.transform = `rotate(${deg}deg)`;
        spoke.style.width = `${Math.hypot(x-center.x, y-center.y)-80}px`;
        hero.appendChild(spoke);

        const dot = document.createElement('div');
        dot.className='app-dot';
        dot.style.left = `${x-7}px`;
        dot.style.top = `${y-7}px`;
        dot.title = item.label;
        hero.appendChild(dot);
      });

      feedHeroFromToggles();
    }
    function computeEnabledSources(){
      const t=STATE.solution.toggles;
      const items=[];
      if(t.platforms.win) items.push({group:'Platform',label:'Windows'});
      if(t.platforms.mac) items.push({group:'Platform',label:'macOS'});
      if(t.platforms.vdi) items.push({group:'Platform',label:'VDI/Web'});
      if(t.platforms.mobile) items.push({group:'Platform',label:'Mobile'});

      if(t.categories.productivity) items.push({group:'Category',label:'Productivity'});
      if(t.categories.security) items.push({group:'Category',label:'Security'});
      if(t.categories.web) items.push({group:'Category',label:'Web/Browsers'});

      if(t.policies.rings) items.push({group:'Policy',label:'Rings'});
      if(t.policies.conditional) items.push({group:'Policy',label:'Conditional'});

      return items;
    }
    function feedHeroFromToggles(){
      const hero=document.getElementById('hero'); if(!hero) return;
      const spokes=[...hero.querySelectorAll('.spoke')];
      const dots=[...hero.querySelectorAll('.app-dot')];
      const count=computeEnabledSources().length;
      spokes.forEach((s,i)=>{
        const active = i < count;
        s.classList.toggle('active', active);
      });
      dots.forEach((d,i)=>{
        const active = i < count;
        d.classList.toggle('active', active);
      });
    }
    function flashHeroForStep(){
      const intune=document.getElementById('intune-node');
      const ring=document.getElementById('recast-ring');
      if(!intune || !ring) return;
      intune.classList.add('stage-glow'); ring.classList.add('stage-glow');
      setTimeout(()=>{ intune.classList.remove('stage-glow'); ring.classList.remove('stage-glow'); }, 500);
    }
    function announceCaption(){
      const cap=document.getElementById('solution-caption');
      if(!cap) return;
      cap.classList.remove('show'); void cap.offsetWidth; cap.classList.add('show');
    }

    /* ===== Legacy helpers needed by Problems/ROI (logos etc.) ===== */
    function k(){return;}
    function logo(name,letter,color){ return { name, svg: mark(letter,color) }; }
    function mark(letter,color){
      return `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${letter}">
          <defs><linearGradient id="g${letter.replace(/\W/g,'')}" x1="0" x2="1"><stop offset="0" stop-color="${shade(color,.9)}"/><stop offset="1" stop-color="${shade(color,1.1)}"/></linearGradient></defs>
          <rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="url(#g${letter.replace(/\W/g,'')})" stroke="rgba(255,255,255,.15)"/>
          <text x="50%" y="56%" text-anchor="middle" font-size="22" font-family="Inter,Segoe UI,Arial" font-weight="800" fill="white">${letter}</text>
        </svg>`;
    }
    function shade(hex,m){ const c=hex.replace('#',''); const n=[0,1,2].map(i=>parseInt(c.slice(i*2,i*2+2),16)); const s=n.map(v=>Math.max(0,Math.min(255,Math.round(v*m)))); return '#'+s.map(v=>v.toString(16).padStart(2,'0')).join(''); }

    /* ===== Boot ===== */
    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>
