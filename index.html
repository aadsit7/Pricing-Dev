<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recast Pricing Calculator</title>
  <meta name="description" content="Calculator for Recast pricing based on Monthly Active Users (MAUs). Returns per-user monthly price, total monthly cost, and total annual cost. Enforces a 250-user minimum." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-50">
  <div id="cdn-fallback" role="alert" class="hidden bg-amber-900/40 text-amber-200 border border-amber-500/40 px-4 py-3 text-sm">
    Some visual enhancements may be unavailable if CDNs are blocked, but the calculator still works.
  </div>

  <header class="max-w-4xl mx-auto px-4 pt-10 pb-6">
    <div class="flex items-center justify-between gap-4">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Recast Pricing Calculator</h1>
      <button id="copy-summary" type="button" class="inline-flex items-center gap-2 rounded-full bg-indigo-500 hover:bg-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-300 px-4 py-2 text-sm font-medium">
        <i data-lucide="clipboard-copy" class="w-4 h-4" aria-hidden="true"></i>
        <span>Copy Summary</span>
      </button>
    </div>
    <p class="text-slate-300 text-sm mt-2">Exact pricing math implemented per the tier rules provided. Results show MSRP and do not constitute a formal quote.</p>
  </header>

  <main class="max-w-4xl mx-auto px-4 pb-16">
    <section aria-labelledby="calc-title" class="rounded-2xl bg-slate-900/60 border border-slate-800 p-6 shadow">
      <h2 id="calc-title" class="text-lg font-semibold mb-4">Calculator</h2>

      <form id="calc-form" class="grid gap-6 sm:grid-cols-2" novalidate>
        <div>
          <label for="mau" class="block font-medium mb-2">Monthly Active Users (MAUs)</label>
          <div class="flex items-center gap-2">
            <input id="mau" name="mau" type="number" inputmode="numeric" min="1" step="1" value="500" class="w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400" aria-describedby="mau-help mau-error" />
            <button id="btn-calc" type="submit" class="inline-flex items-center gap-2 rounded-lg bg-indigo-500 hover:bg-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-300 px-4 py-2 font-medium">
              <i data-lucide="calculator" class="w-4 h-4" aria-hidden="true"></i>
              Calculate
            </button>
          </div>
          <p id="mau-help" class="text-xs text-slate-400 mt-1">Minimum 250 users required for contract pricing.</p>
          <p id="mau-error" class="hidden text-xs text-red-300 mt-1" role="alert"></p>
        </div>

        <div>
          <label class="block font-medium mb-2">Tier Rules (MSRP)</label>
          <ul class="text-sm text-slate-300 space-y-1">
            <li><span class="font-medium text-slate-200">Not eligible</span> if MAU &lt; 250</li>
            <li>250–999: <span class="font-medium">$4.00</span> per user / month</li>
            <li>1,000–4,999: <span class="font-medium">$3.50</span> per user / month</li>
            <li>5,000–9,999: <span class="font-medium">$3.00</span> per user / month</li>
            <li>10,000+: <span class="font-medium">$2.50</span> per user / month</li>
          </ul>
        </div>
      </form>

      <div id="notice" class="hidden mt-6 rounded-lg border border-amber-500/40 bg-amber-900/40 text-amber-100 px-4 py-3" role="alert">
        <div class="flex items-start gap-2">
          <i data-lucide="alert-triangle" class="w-5 h-5 mt-[2px]" aria-hidden="true"></i>
          <p id="notice-text" class="text-sm">Not eligible for contract pricing. Minimum user count is 250.</p>
        </div>
      </div>

      <div id="results" class="mt-6 grid gap-4 sm:grid-cols-3" aria-live="polite" aria-busy="false">
        <article class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
          <h3 class="text-sm text-slate-300 mb-1">Per-User Monthly Price</h3>
          <p id="price-per-user" class="text-2xl font-bold">$0.00</p>
        </article>
        <article class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
          <h3 class="text-sm text-slate-300 mb-1">Total Monthly Cost</h3>
          <p id="total-monthly" class="text-2xl font-bold">$0.00</p>
        </article>
        <article class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
          <h3 class="text-sm text-slate-300 mb-1">Total Annual Cost (1-Year)</h3>
          <p id="total-annual" class="text-2xl font-bold">$0.00</p>
        </article>
      </div>
    </section>

    <section aria-labelledby="quickfill-title" class="mt-8 rounded-2xl bg-slate-900/60 border border-slate-800 p-6 shadow">
      <h2 id="quickfill-title" class="text-lg font-semibold mb-4">Quick Test (Sample Outputs)</h2>
      <div class="flex flex-wrap gap-2">
        <button data-fill="300" type="button" class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:bg-slate-700 text-sm">300 → should be $4.00 / $1,200 / $14,400</button>
        <button data-fill="1200" type="button" class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:bg-slate-700 text-sm">1200 → $3.50 / $4,200 / $50,400</button>
        <button data-fill="6000" type="button" class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:bg-slate-700 text-sm">6000 → $3.00 / $18,000 / $216,000</button>
        <button data-fill="15000" type="button" class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:bg-slate-700 text-sm">15000 → $2.50 / $37,500 / $450,000</button>
      </div>
    </section>
  </main>

  <div id="toast" role="status" class="hidden fixed bottom-4 right-4 bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 text-sm shadow">
    Summary copied to clipboard.
  </div>

  <script>
    // ---------- App State ----------
    const STATE = {
      users: 500,
      pricePerUser: 0,
      totals: {
        monthly: 0,
        annual: 0
      }
    };

    // ---------- Helpers ----------
    function formatUSD(n) {
      const v = Number.isFinite(n) ? n : 0;
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 }).format(v);
    }

    function getTierPricePerUser(users) {
      if (!Number.isFinite(users) || users < 1) return { eligible: false, price: 0, reason: 'Enter a valid whole number of users.' };
      if (users < 250) return { eligible: false, price: 0, reason: 'Not eligible for contract pricing. Minimum user count is 250.' };
      if (users <= 999) return { eligible: true, price: 4.00 };
      if (users <= 4999) return { eligible: true, price: 3.50 };
      if (users <= 9999) return { eligible: true, price: 3.00 };
      return { eligible: true, price: 2.50 };
    }

    function computeTotals() {
      const { eligible, price } = getTierPricePerUser(STATE.users);
      STATE.pricePerUser = eligible ? price : 0;
      const monthly = eligible ? round2(STATE.users * STATE.pricePerUser) : 0;
      const annual = eligible ? round2(monthly * 12) : 0;
      STATE.totals.monthly = monthly;
      STATE.totals.annual = annual;
      return { eligible };
    }

    function round2(n) {
      return Math.round((n + Number.EPSILON) * 100) / 100;
    }

    // ---------- Rendering ----------
    function renderAll() {
      const { eligible } = computeTotals();

      const priceEl = document.getElementById('price-per-user');
      const monthlyEl = document.getElementById('total-monthly');
      const annualEl = document.getElementById('total-annual');
      const notice = document.getElementById('notice');
      const noticeText = document.getElementById('notice-text');

      if (!eligible) {
        priceEl.textContent = '$0.00';
        monthlyEl.textContent = '$0.00';
        annualEl.textContent = '$0.00';
        noticeText.textContent = getTierPricePerUser(STATE.users).reason;
        notice.classList.remove('hidden');
      } else {
        notice.classList.add('hidden');
        priceEl.textContent = formatUSD(STATE.pricePerUser);
        monthlyEl.textContent = formatUSD(STATE.totals.monthly);
        annualEl.textContent = formatUSD(STATE.totals.annual);
      }

      const input = document.getElementById('mau');
      if (String(input.value) !== String(STATE.users)) input.value = STATE.users;
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      setTimeout(() => t.classList.add('hidden'), 1600);
    }

    // ---------- Events ----------
    function initEvents() {
      const form = document.getElementById('calc-form');
      const input = document.getElementById('mau');
      const err = document.getElementById('mau-error');

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const n = Number.parseInt(input.value, 10);
        if (!Number.isFinite(n) || n < 1) {
          err.textContent = 'Please enter a valid whole number.';
          err.classList.remove('hidden');
          return;
        }
        err.classList.add('hidden');
        STATE.users = n;
        renderAll();
      });

      document.querySelectorAll('[data-fill]').forEach(btn => {
        btn.addEventListener('click', () => {
          const n = Number.parseInt(btn.getAttribute('data-fill'), 10);
          input.value = n;
          STATE.users = n;
          renderAll();
        });
      });

      document.getElementById('copy-summary').addEventListener('click', async () => {
        const line1 = `Users: ${STATE.users}`;
        const line2 = `Per-user monthly price: ${formatUSD(STATE.pricePerUser)}`;
        const line3 = `Total monthly cost: ${formatUSD(STATE.totals.monthly)}`;
        const line4 = `Total annual cost (12 mo): ${formatUSD(STATE.totals.annual)}`;
        const body = ['Recast Pricing Summary', '', line1, line2, line3, line4].join('\n');
        try {
          await navigator.clipboard.writeText(body);
          showToast('Summary copied to clipboard.');
        } catch {
          const mailto = `mailto:?subject=${encodeURIComponent('Recast Pricing Summary')}&body=${encodeURIComponent(body)}`;
          window.location.href = mailto;
        }
      });
    }

    // ---------- Init ----------
    (function init() {
      if (!window.tailwind || !window.lucide) {
        document.getElementById('cdn-fallback').classList.remove('hidden');
      }
      if (window.lucide && typeof window.lucide.createIcons === 'function') {
        window.lucide.createIcons();
      }
      initEvents();
      renderAll();
    })();
  </script>
</body>
</html>
