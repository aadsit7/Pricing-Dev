<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recast ‚Äî Compact Click-Through (Realistic Catalog)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="dark light">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://unpkg.com">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            keyframes: {
              tilePulse: {
                '0%': { transform: 'scale(0.7)', backgroundColor: '#e5e7eb', opacity: '0.4' },
                '60%': { transform: 'scale(1)', backgroundColor: '#2563eb', opacity: '1' },
                '100%': { backgroundColor: '#e5e7eb', opacity: '0.9' },
              },
              barGrow: {
                to: { transform: 'scaleX(1)' },
              },
              boltDrop: {
                to: { transform: 'scaleY(1)' },
              },
              appLiftPulse: {
                '0%': { transform: 'translateY(0) scale(1)', filter: 'saturate(0.4)', opacity: '0.65' },
                '30%': { transform: 'translateY(-4px) scale(1.05)' },
                '60%': { transform: 'translateY(-2px) scale(1.02)', filter: 'saturate(1)', opacity: '1' },
                '100%': { transform: 'translateY(0) scale(1)' },
              },
              badgeDrop: {
                to: { opacity: '1', transform: 'translateY(0) scale(1)' },
              },
              fadeInOut: {
                '0%': { opacity: '0' },
                '30%': { opacity: '1' },
                '70%': { opacity: '1' },
                '100%': { opacity: '0' },
              },
              iconLaunch: {
                '0%': { transform: 'scale(1)' },
                '50%': { transform: 'scale(1.1)' },
                '100%': { transform: 'scale(1)' },
              },
              fadeIn: {
                to: { opacity: '1' },
              },
              modalEnter: {
                '0%': { transform: 'scale(0.95)', opacity: '0' },
                '100%': { transform: 'scale(1)', opacity: '1' },
              },
              overlayFade: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
            },
            animation: {
              tilePulse: 'tilePulse 1s ease-in-out var(--d, 0s) 1 forwards',
              barGrow: 'barGrow 0.9s ease forwards var(--d, 0s)',
              boltDrop: 'boltDrop 0.9s ease forwards var(--d, 0s)',
              appLiftPulse: 'appLiftPulse 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) var(--d, 0s) 1 forwards',
              badgeDrop: 'badgeDrop 0.8s ease-out var(--d, 0s) forwards',
              fadeInOut: 'fadeInOut 1.5s ease var(--d,0s) forwards',
              iconLaunch: 'iconLaunch 0.5s ease forwards',
              fadeIn: 'fadeIn 1s ease 10s forwards',
              modalEnter: 'modalEnter 300ms cubic-bezier(0.2, 0.8, 0.2, 1)',
              overlayFade: 'overlayFade 300ms ease',
            },
          },
        },
      };
    </script>
    <style>
      /* Overlay sits on top of the Application Workspace card */
      #recast-approach-animation-layer {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: 999;
      }
      #recast-approach-animation-layer .lottie {
          position: absolute;
          width: 100%;
          height: 100%;
          display: none;
      }
      /* Final calm state after animation */
      .workspace-final .warning,
      .workspace-final .duplicate,
      .workspace-final .loading-indicator {
          opacity: 0;
          transition: opacity .25s ease-out;
      }
      .workspace-final .app-icon {
          opacity: 1;
          transform: scale(1);
          transition: .25s ease-out;
      }
      .dimmed {
        opacity: 0.5;
        transition: opacity 0.3s ease;
      }
      .highlighted {
        border-color: #10B981;
        box-shadow: 0 0 0 3px rgba(16,185,129,0.3);
        transition: all 0.3s ease;
      }
      .processed {
        background-color: #ECFDF5 !important;
        border-color: #D1FAE5 !important;
        color: #065F46 !important;
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="min-h-screen antialiased bg-gray-50 text-gray-900 font-[Inter]">
    <div id="app" class="min-h-screen"></div>
    <script>
      const STATE = {
        activeTab: 'problems',
        impact: { minutes: 9, pkgHours: 6, riskHrs: 22.5 },
        defaults: { impact: { minutes: 9, pkgHours: 6, riskHrs: 22.5 } },
        ctx: { device: 'Windows', network: 'Corporate', compliant: true },
        packHrs: 8, configHrs: 2, currentHrs: 24,
        roiInputs: { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18 },
        copied: false,
        showLabels: false,
        showSolutionCards: true,
        openWhy: null,
        openWhyModal: null,
        openCards: { core: false, onboarding: false, trust: false },
        visitedCards: [],
        openBuckets: { one: false, zero: false, per: false, edit: false },
        modalOpen: false,
        editBuffers: { change: { intro: '', bullets: '', analyst: '' }, now: { intro: '', bullets: '', analyst: '' }, recast: { intro: '', bullets: '', analyst: '' } },
        selectedBullets: {},
        currentState: {
          change: {
            intro: "The app layer has become the biggest slowdown in IT. Teams are drowning in apps, constant updates, and one-off fixes, and every project ends up paying the price.",
            bullets: [
              'There are too many apps to manage by hand. Commercial, internal, and legacy software are spread across Intune, ConfigMgr, VDI, Windows, and macOS.',
              'Headcount hasn‚Äôt grown, but the work has exploded. Most teams are already over capacity and spend most of their day reacting to app issues.',
              'Big initiatives keep getting stuck. Cloud moves, Citrix or AVD projects, hardware refreshes, and AI efforts all run into the same wall ‚Äî app readiness.',
              'Technical debt keeps piling up. Different versions of the same app are everywhere, creating more risk, more tickets, and slower recovery when things break.'
            ],
            analyst: "When the application layer is a mess, transformation projects stall or fail. It‚Äôs not because the strategy is wrong, but because there‚Äôs no capacity left to execute."
          },
          now: {
            intro: "IT teams are being asked to manage more apps and more change with the same people and the same tools. The gap between what‚Äôs expected and what‚Äôs possible keeps getting wider.",
            bullets: [
              'App updates and complexity keep increasing, but team size stays the same. You can‚Äôt scale people the way you scale software.',
              'Internal and custom apps don‚Äôt update themselves, so every change adds more manual work, more dependencies, and more risk.',
              'Leadership wants progress on AI, modernization, and new platforms, but the teams who could drive that progress are stuck keeping apps running.',
              'The longer this goes on, the worse it gets. Version sprawl grows, security and compliance get harder, and cleanup costs rise fast.'
            ],
            analyst: "In the next few years, the organizations that succeed with AI and modernization will be the ones that fix app delivery first. Everyone else will hit a hard capacity wall."
          },
          recast: {
            intro: "Recast‚Äôs Application Workspace solves the core problem. It gives IT one place to package, update, and manage every application so the app layer stops slowing everything down.",
            bullets: [
              'One workspace for every app, whether commercial, internal, or legacy. Installs, updates, and access all handled consistently across Intune, ConfigMgr, AVD, and other systems.',
              'Automates what teams still do by hand ‚Äî packaging, versioning, and pushing updates, especially for internal and custom apps.',
              'Reduces technical debt and version sprawl, which means fewer variables when something breaks and far fewer app-related tickets.',
              'Frees up IT capacity. What used to take hours now takes minutes, so migrations, pilots, patch cycles, and AI projects can finally move at business speed.'
            ],
            analyst: "Recast turns app management from a drag on every project into a stable foundation. Readiness stops being the blocker and becomes the default."
          }
        },
        defaultsCurrentState() {
          return JSON.parse(JSON.stringify({
            change: {
              intro: "The app layer has become the biggest slowdown in IT. Teams are drowning in apps, constant updates, and one-off fixes, and every project ends up paying the price.",
              bullets: [
                'There are too many apps to manage by hand. Commercial, internal, and legacy software are spread across Intune, ConfigMgr, VDI, Windows, and macOS.',
                'Headcount hasn‚Äôt grown, but the work has exploded. Most teams are already over capacity and spend most of their day reacting to app issues.',
                'Big initiatives keep getting stuck. Cloud moves, Citrix or AVD projects, hardware refreshes, and AI efforts all run into the same wall ‚Äî app readiness.',
                'Technical debt keeps piling up. Different versions of the same app are everywhere, creating more risk, more tickets, and slower recovery when things break.'
              ],
              analyst: "When the application layer is a mess, transformation projects stall or fail. It‚Äôs not because the strategy is wrong, but because there‚Äôs no capacity left to execute."
            },
            now: {
              intro: "IT teams are being asked to manage more apps and more change with the same people and the same tools. The gap between what‚Äôs expected and what‚Äôs possible keeps getting wider.",
              bullets: [
                'App updates and complexity keep increasing, but team size stays the same. You can‚Äôt scale people the way you scale software.',
                'Internal and custom apps don‚Äôt update themselves, so every change adds more manual work, more dependencies, and more risk.',
                'Leadership wants progress on AI, modernization, and new platforms, but the teams who could drive that progress are stuck keeping apps running.',
                'The longer this goes on, the worse it gets. Version sprawl grows, security and compliance get harder, and cleanup costs rise fast.'
              ],
              analyst: "In the next few years, the organizations that succeed with AI and modernization will be the ones that fix app delivery first. Everyone else will hit a hard capacity wall."
            },
            recast: {
              intro: "Recast‚Äôs Application Workspace solves the core problem. It gives IT one place to package, update, and manage every application so the app layer stops slowing everything down.",
              bullets: [
                'One workspace for every app, whether commercial, internal, or legacy. Installs, updates, and access all handled consistently across Intune, ConfigMgr, AVD, and other systems.',
                'Automates what teams still do by hand ‚Äî packaging, versioning, and pushing updates, especially for internal and custom apps.',
                'Reduces technical debt and version sprawl, which means fewer variables when something breaks and far fewer app-related tickets.',
                'Frees up IT capacity. What used to take hours now takes minutes, so migrations, pilots, patch cycles, and AI projects can finally move at business speed.'
              ],
              analyst: "Recast turns app management from a drag on every project into a stable foundation. Readiness stops being the blocker and becomes the default."
            }
          }));
        },
        progress: { apps: 0, time: 0, tickets: 0 }
      };
      const TABS = [
        { id: 'problems', label: 'Current State', icon: 'alert-triangle' },
        { id: 'solution', label: 'Recast Approach', icon: 'workflow' },
        { id: 'roi', label: 'Business Impact', icon: 'bar-chart-3' }
      ];
      const NEW_CARDS = [
        {
          id: 'core',
          icon: 'layers',
          title: 'How Recast Does It.',
          bullets: [
            'One workspace for every app: Package, deploy, patch, and retire apps across Intune, ConfigMgr, Citrix, Omnissa, Azure, and AVD ‚Äî all from one console. Simplifies management, removes silos, accelerates project readiness.',
            '7,500+ enterprise apps ready to deploy: Largest pre-tested app catalog available; includes commercial, internal, and legacy support. Cuts packaging time and shortens pilot-to-production cycles.',
            'Automated patching and validation: Automated versioning, rollback, and compliance checks across environments. Keeps apps secure and compliant without manual effort.',
            'Policy-driven automation: Workflow engine reduces manual tasks by ~60% per Recast documentation. Frees up IT time for strategic initiatives (AI, modernization, migrations).',
            'Unified dashboard and self-service: Single visibility plane for admins + instant delivery for end users. Reduces tickets, improves user experience, and speeds delivery.'
          ],
          closer: 'Configured once ‚Äî Delivered everywhere.',
          timeline: false,
          bgHeader: 'bg-gray-50',
          bgContent: 'bg-gray-50'
        },
        {
          id: 'onboarding',
          icon: 'clock',
          title: 'Onboard & Up to Speed Fast.',
          bullets: [
            'Standard rollout in 4‚Äì6 weeks (Kickoff ‚Äî Implementation ‚Äî UAT ‚Äî Launch ‚Äî Enablement).',
            'No new infrastructure ‚Äî integrates with your existing management tools.',
            'Guided setup with dedicated Customer Success Manager.',
            'Typical resource: 1‚Äì2 IT engineers part-time.',
            'Enablement includes training, certification, and success planning.'
          ],
          closer: 'From first call to production in weeks, not months.',
          timeline: true,
          bgHeader: 'bg-gray-50',
          bgContent: 'bg-gray-50'
        },
        {
          id: 'trust',
          icon: 'shield-check',
          title: 'Trusted by Customers',
          bullets: [
            '60M+ endpoints across 130+ countries.',
            '70k+ Customers & Trusted by global organizations| Citibank, McKinsey & Company, U.S. Air Force, FEMA, Hitachi, Johns Hopkins, Costco, Government of Canada.',
            '87 CSAT Score | Most trusted in the industry',
            'Proven scalability from small pilots to global deployments.',
            'Backed by enterprise-grade support and compliance alignment (SOC 2, ISO 27001).'
          ],
          closer: 'Trusted by organizations that can‚Äôt afford downtime.',
          timeline: false,
          bgHeader: 'bg-gray-50',
          bgContent: 'bg-gray-50'
        }
      ];
      const onboardingMiniTimelineEnabled = true;
      function cx(...a){ return a.filter(Boolean).join(' '); }
      function round(n){ return Math.round(n*100)/100; }
      function num(n){ return new Intl.NumberFormat().format(Math.round(n)); }
      function routeRecommendation(ctx){
        if(!ctx.compliant) return 'Web';
        if(ctx.device==='Windows' && ctx.network!=='Home') return 'Local';
        return 'VDI';
      }
      function cleanNum(v){ v = Number(String(v).replace(/[^0-9.\-]/g,'')); return isFinite(v) ? v : 0; }
      function render(){
        const root=document.getElementById('app');
        root.innerHTML = `
          <header class="relative">
            <div class="relative mx-auto max-w-6xl px-6 lg:px-12 pt-8 pb-6">
              <h1 class="text-4xl md:text-5xl font-semibold leading-tight"><span class="text-blue-600">Re</span><span class="text-gray-900">cast Application Workspace</span></h1>
              <p class="mt-2 max-w-2xl text-base leading-relaxed text-gray-700">
                ${STATE.activeTab==='problems'
                  ? 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more‚Äîmaking the tools you already use faster, smarter, and easier to manage'
                  : 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more‚Äîmaking the tools you already use faster, smarter, and easier to manage'}
              </p>
            </div>
            <div class="relative mx-auto max-w-6xl px-6 lg:px-12">
              <div role="tablist" aria-label="Demo sections" class="flex flex-nowrap overflow-x-auto gap-2 rounded bg-gray-50 p-1 ring-1 ring-gray-200">
                ${TABS.map(t=>`
                  <button type="button" class="${cx('flex-1 inline-flex items-center justify-center gap-2 px-3.5 py-1.5 text-sm focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 transition rounded-full', STATE.activeTab===t.id ? 'bg-blue-600 text-white hover:bg-blue-700' : 'text-gray-900 hover:bg-gray-100')}" data-action="switch-tab" data-tab="${t.id}" aria-controls="panel-${t.id}" aria-selected="${STATE.activeTab===t.id}">
                    <i data-lucide="${t.icon}" class="w-4 h-4"></i><span>${t.label}</span>
                  </button>
                `).join('')}
              </div>
            </div>
          </header>
          <main class="mx-auto max-w-6xl px-6 lg:px-12 pb-8 gap-4">
            ${STATE.activeTab==='roi' ? `
            <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-3">
              ${chip('Reactive Work Reduced', String(STATE.impact.minutes)+' min/user/mo', 'emerald')}
              ${chip('Hours Saved from Packaging', String(round(STATE.impact.pkgHours)), 'sky')}
              ${chip('Hours Saved from Faster Patching', String(round(STATE.impact.riskHrs)), 'yellow')}
            </div>` : ''}
            <section class="mt-4">${renderActivePanel()}</section>
          </main>
          ${renderModal()}
          ${renderWhyModal()}
        `;
        if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
        attachEvents();
        if (STATE.activeTab === 'solution') { buildFlow(); }
        if (STATE.activeTab === 'roi') { updateROIOutputs(); }
        if (STATE.activeTab === 'solution') { attachAccordionKeyboard(); }
      }
      function chip(label,value,tone){
        const tones={emerald:'from-emerald-400/80 to-teal-400/80',sky:'from-sky-400/80 to-indigo-400/80',yellow:'from-yellow-300/90 to-amber-400/90'};
        return `
          <div class="rounded-2xl bg-white shadow-md hover:shadow-lg hover:-translate-y-[2px] transition-shadow duration-300 transition-transform p-2">
            <div class="text-[11px] text-gray-600">${label}</div>
            <div class="mt-0.5 inline-flex items-center gap-1.5 rounded bg-gradient-to-r px-1.5 py-0.5 text-gray-900 ${tones[tone]}">
              <i data-lucide="badge-check" class="w-3.5 h-3.5"></i><span class="text-[12px] font-semibold tabular-nums">${value}</span>
            </div>
          </div>
        `;
      }
      function renderActivePanel(){
        if (STATE.activeTab==='problems') return renderProblems();
        if (STATE.activeTab==='solution') return renderSolution();
        if (STATE.activeTab==='roi') return renderROI();
        return '';
      }
      const pressures = [
        { id: 'cost', title: 'COST-TO-OPERATE REDUCTION', bullets: ['Manual app management creates avoidable, costly overhead.', 'Redundant installs inflate spend and block strategic work.', 'Teams can‚Äôt scale delivery to match business growth.', 'Lack of standardization hides costs across the lifecycle.'] },
        { id: 'risk', title: 'RISK, COMPLIANCE & SECURITY', bullets: ['Version sprawl and patch gaps expose persistent risks.', 'No unified view blocks governance and fast response.', 'Manual oversight increases error, audit, and compliance failure.'] },
        { id: 'capacity', title: 'CAPACITY & DELIVERY VELOCITY', bullets: ['Flat headcount can‚Äôt meet rising app demands.', 'Repetitive tasks delay modernization and cloud shifts.', 'App readiness issues stall critical business initiatives.'] },
        { id: 'employee', title: 'EMPLOYEE EXPERIENCE & ENABLEMENT', bullets: ['App delays stall workflows and reduce productivity.', 'Version mismatches break processes and fuel IT distrust.', 'Inconsistent delivery drives shadow IT and support load.'] }
      ];
      function renderProblems(){
        return `
          <section id="panel-problems" class="space-y-3">
            <h2 class="text-3xl font-semibold leading-tight">Top Pressures Organizations Face in 2025</h2>
            <p class="text-xl text-gray-700 leading-relaxed">- Application Layer is the #1 bottleneck for continuous transformation.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-start">
              ${pressures.map(p=>`
                <div class="rounded-2xl bg-white shadow-md hover:shadow-lg hover:-translate-y-[2px] transition-shadow duration-300 transition-transform p-4 flex flex-col space-y-1 h-full">
                  <h3 class="text-[14px] font-semibold mb-1">${p.title}</h3>
                  <ul class="list-disc list-inside space-y-1 text-[12px] text-gray-700">
                    ${p.bullets.map((b,i)=>{
                      const selected = (STATE.selectedBullets[p.id] || []).includes(i);
                      return `
                        <li class="flex items-center gap-2 min-h-[1.25rem] ${selected ? 'bg-blue-50 rounded-md p-1 transition-colors' : ''} ${b ? '' : 'invisible' }">
                          <label class="flex items-center gap-2 cursor-pointer select-none w-full">
                            <input type="checkbox" class="sr-only" data-action="toggle-bullet" data-category="${p.id}" data-index="${i}" ${selected ? 'checked' : ''} aria-label="Select: ${b}">
                            <div class="w-3.5 h-3.5 border-2 rounded-full flex items-center justify-center transition-all duration-200 ease-in-out shrink-0 ${selected ? 'bg-blue-600 border-blue-600' : 'border-gray-300 bg-white'}">
                              ${selected ? '<i data-lucide="check" class="w-2.5 h-2.5 text-white stroke-[3]"></i>' : ''}
                            </div>
                            <span class="${selected ? 'text-blue-800 font-medium' : ''}">${b}</span>
                          </label>
                        </li>
                      `;
                    }).join('')}
                  </ul>
                </div>
              `).join('')}
            </div>
            <div class="mt-6 flex justify-between items-center">
              <button type="button" data-action="reset-bullets" class="bg-transparent text-gray-900 border-2 border-gray-900 rounded-full px-4 py-1.5 hover:text-blue-600 hover:border-blue-600 hover:scale-102 transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 text-sm">Reset</button>
              <button type="button" data-action="next-tab" class="bg-blue-600 text-white rounded-full px-4 py-1.5 hover:bg-blue-700 hover:scale-102 transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 text-sm">Next</button>
            </div>
          </section>
        `;
      }
      function calloutDropdown(id, icon, label, headerTone, cta=false){
        return `
          <div class="h-full flex flex-col">
            <button
              type="button"
              class="w-full overflow-hidden ring-1 ring-gray-200 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 transition hover:ring-gray-300 shadow-sm rounded-2xl"
              data-action="open-why-modal"
              data-why="${id}"
            >
              <div class="${cx('flex items-center justify-between px-4 py-3', headerTone)} border-b border-gray-200">
                <div class="flex items-center gap-1.5">
                  <i data-lucide="${icon}" class="w-4.5 h-4.5 text-gray-900" aria-hidden="true"></i>
                  <span class="text-lg font-semibold tracking-normal text-gray-900">${label}</span>
                </div>
                <i data-lucide="chevron-right" class="w-4.5 h-4.5 text-gray-600 transition-transform duration-150" aria-hidden="true"></i>
              </div>
            </button>
          </div>
        `;
      }
      function renderWhyModal(){
        if(!STATE.openWhyModal) return '';
        const id = STATE.openWhyModal;
        const iconMap = { change: 'alert-triangle', now: 'clock-4', recast: 'sparkles' };
        const labelMap = { change: 'Why Change', now: 'Why Now', recast: 'Why Recast' };
        const data = STATE.currentState[id];
        const headerTone = 'bg-gray-50';
        const cta = id === 'recast';
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 animate-overlayFade" role="dialog" aria-modal="true" aria-labelledby="why-modal-title-${id}">
            <div class="w-full max-w-4xl mx-4 bg-white rounded-2xl shadow-2xl overflow-hidden animate-modalEnter" style="max-height: 95vh; overflow-y: auto;">
              <div class="${headerTone} px-6 py-4 flex items-center justify-between border-b border-gray-200">
                <div class="flex items-center gap-2">
                  <i data-lucide="${iconMap[id]}" class="w-7 h-7 text-gray-900" aria-hidden="true"></i>
                  <h2 id="why-modal-title-${id}" class="text-2xl font-bold tracking-tight text-gray-900">${labelMap[id]}</h2>
                </div>
                <button type="button" class="text-gray-500 hover:text-gray-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 p-1.5" data-action="close-why-modal" aria-label="Close">
                  <i data-lucide="x" class="w-5 h-5"></i>
                </button>
              </div>
              <div class="p-6 bg-gray-50">
                <p class="text-[15px] leading-relaxed text-gray-700 mb-3">${data.intro}</p>
                <div class="space-y-3">
                  ${data.bullets.map(b=>`
                    <div class="bg-white p-3 rounded-lg shadow-sm flex items-start gap-2 hover:shadow-md transition-shadow duration-300">
                      <i data-lucide="check-circle" class="w-4.5 h-4.5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                      <p class="text-[15px] leading-relaxed text-gray-700">${b}</p>
                    </div>
                  `).join('')}
                </div>
                <div class="mt-5 bg-white p-3 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 flex items-start gap-2">
                  <i data-lucide="lightbulb" class="w-4.5 h-4.5 text-yellow-400 flex-shrink-0 mt-0.5"></i>
                  <p class="text-[15px] italic text-gray-700">${data.analyst}</p>
                </div>
                ${cta?`
                  <div class="mt-6 flex justify-center">
                    <button id="btnAdvanceToSolution" type="button" data-action="advance" data-next="solution" class="inline-flex bg-blue-600 text-white text-[15px] font-semibold px-5 py-2.5 items-center gap-2 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 shadow-md hover:shadow-lg hover:bg-blue-700 transition-shadow duration-300 rounded-full">
                      <i data-lucide="arrow-right" class="w-4.5 h-4.5"></i>
                      How Recast solves it
                    </button>
                  </div>
                `:''}
              </div>
            </div>
          </div>
        `;
      }
      function popoutCard(card){
        const expanded = STATE.openCards[card.id];
        const contentId = `card-content-${card.id}`;
        return `
          <div class="h-full flex flex-col">
            <button
              type="button"
              class="accordion-header w-full overflow-hidden ring-1 ring-gray-200 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 transition hover:ring-gray-300 shadow-sm rounded-2xl min-h-[44px]"
              data-action="toggle-card"
              data-card="${card.id}"
              aria-expanded="${expanded}"
              aria-controls="${contentId}"
            >
              <div class="${card.bgHeader || 'bg-gray-50'} px-4 py-3 flex flex-col border-b border-gray-200">
                <div class="flex justify-between items-center">
                  <div class="flex items-center gap-1.5">
                    <i data-lucide="${card.icon}" class="w-5 h-5 text-gray-900" aria-hidden="true"></i>
                    <span class="text-lg font-medium text-left tracking-normal text-gray-900">${card.title}</span>
                  </div>
                  <div class="flex items-center gap-1.5">
                    <span class="text-[13px] text-gray-700">${expanded ? 'Collapse' : 'Expand'}</span>
                    <i data-lucide="chevron-down" class="w-4.5 h-4.5 text-gray-600 transition-transform duration-150 ${expanded ? 'rotate-180' : ''}" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </button>
            <div id="${contentId}" class="accordion-content overflow-hidden border-l-4 border-blue-600 ${card.bgContent} ${expanded ? 'max-h-[1200px] opacity-100 p-4' : 'max-h-0 opacity-0 p-0'} transition-[max-height] duration-150 ease-[cubic-bezier(0.2,0.8,0.2,1)] transition-opacity duration-150">
              <ul class="list-disc pl-5 text-[15px] leading-relaxed space-y-2 text-gray-700 text-left">
                ${card.bullets.map(b=>`<li>${b}</li>`).join('')}
              </ul>
              ${card.timeline && onboardingMiniTimelineEnabled && expanded ? renderMiniTimeline() : ''}
              <p class="mt-3 italic text-[15px] text-gray-700">${card.closer}</p>
            </div>
          </div>
        `;
      }
      function renderMiniTimeline(){
        const phases = [
          {icon: 'play-circle', label: 'Kickoff'},
          {icon: 'hammer', label: 'Implementation'},
          {icon: 'check-circle', label: 'UAT'},
          {icon: 'flag', label: 'Launch'},
          {icon: 'book-open', label: 'Enablement'}
        ];
        return `
          <div class="flex items-center justify-between mt-3" aria-hidden="true">
            ${phases.map((p, i) => `
              ${i > 0 ? '<div class="flex-1 h-px bg-gray-200 mx-1.5"></div>' : ''}
              <div class="flex flex-col items-center">
                <i data-lucide="${p.icon}" class="w-4.5 h-4.5 text-blue-600"></i>
                <span class="text-[11px] mt-0.5 text-gray-700">${p.label}</span>
              </div>
            `).join('')}
          </div>
        `;
      }
      function bucketAccordion(id, icon, label, contentFunc, headerTone='bg-gray-50'){
        const expanded = STATE.openBuckets[id];
        const contentId = `bucket-content-${id}`;
        return `
          <div class="flex flex-col">
            <button
              type="button"
              class="w-full overflow-hidden ring-1 ring-gray-200 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 transition hover:ring-gray-300 shadow-sm rounded-2xl"
              data-action="toggle-bucket"
              data-bucket="${id}"
              aria-expanded="${expanded}"
              aria-controls="${contentId}"
            >
              <div class="flex items-center justify-between px-4 py-3 ${headerTone} border-b border-gray-200">
                <div class="flex items-center gap-1.5">
                  <i data-lucide="${icon}" class="w-4.5 h-4.5 text-gray-900" aria-hidden="true"></i>
                  <span class="text-[15px] font-semibold tracking-normal text-gray-900">${label}</span>
                </div>
                <i data-lucide="${expanded?'chevron-up':'chevron-down'}" class="w-4.5 h-4.5 text-gray-600 transition-transform duration-150" aria-hidden="true"></i>
              </div>
            </button>
            <div id="${contentId}" class="accordion-content overflow-hidden ${expanded ? 'max-h-[1200px] opacity-100' : 'max-h-0 opacity-0'} transition-[max-height] duration-150 ease-[cubic-bezier(0.2,0.8,0.2,1)] transition-opacity duration-150">
              ${expanded ? contentFunc() : ''}
            </div>
          </div>
        `;
      }
      function onePackageContent(){
        const saved=Math.max(0, Number(STATE.packHrs)-Number(STATE.configHrs));
        return `
          <div class="p-3">
            <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-2.5 text-[13px]">
              <div class="flex items-center gap-1.5 font-medium"><i data-lucide="wand-sparkles" class="w-3.5 h-3.5"></i> Hours Saved from Packaging</div>
              <label class="mt-1.5 flex items-center gap-1.5 text-[11px]">
                <span class="text-gray-700">Hours/package</span>
                <input class="w-14 rounded bg-gray-100 px-1.5 py-0.5 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" value="${STATE.packHrs}" inputmode="decimal" data-action="set-pack-hrs" aria-label="Hours per package">
                <span>‚Üí</span>
                <input class="w-14 rounded bg-gray-100 px-1.5 py-0.5 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" value="${STATE.configHrs}" inputmode="decimal" data-action="set-config-hrs" aria-label="Hours to configure">
              </label>
              <div class="mt-1.5 flex items-center justify-between rounded bg-gray-100 px-2 py-1"><span class="tabular-nums">${STATE.packHrs} ‚Üí ${STATE.configHrs} hrs</span><strong class="tabular-nums">${saved} hrs saved</strong></div>
              <div class="mt-1.5 text-[11px] flex flex-wrap gap-1.5">
                <span class="rounded px-1.5 py-0.5 bg-gray-100">‚òÅÔ∏è Cloud</span>
                <span class="rounded px-1.5 py-0.5 bg-gray-100">üñ•Ô∏è On-Prem</span>
                <span class="rounded px-1.5 py-0.5 bg-gray-100">üîÄ Hybrid</span>
              </div>
              <button type="button" class="mt-1.5 bg-blue-600 text-white px-2.5 py-0.5 text-[11px] font-semibold w-full rounded hover:bg-blue-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2">Add to impact</button>
            </div>
          </div>
        `;
      }
      function zeroDayContent(){
        const reduced=Math.max(0, Number(STATE.currentHrs)-1.5);
        return `
          <div class="p-3">
            <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-2.5 text-[13px]">
              <div class="flex items-center gap-1.5 font-medium"><i data-lucide="shield-check" class="w-3.5 h-3.5"></i> Hours Saved from Faster Patching</div>
              <label class="mt-1.5 flex items-center gap-1.5 text-[11px]">
                <span class="text-gray-700">Current hrs</span>
                <input class="w-16 rounded bg-gray-100 px-1.5 py-0.5 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" value="${STATE.currentHrs}" inputmode="decimal" data-action="set-current-hrs" aria-label="Current time to deploy (hours)">
              </label>
              <div class="mt-1.5 flex items-center justify-between rounded bg-gray-100 px-2 py-1"><span class="tabular-nums">${STATE.currentHrs} ‚Üí 1.5 hrs</span><strong class="tabular-nums">${round(reduced)} hrs reduced</strong></div>
              <button type="button" class="mt-1.5 bg-blue-600 text-white px-2.5 py-0.5 text-[11px] font-semibold w-full rounded hover:bg-blue-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" data-action="add-impact" data-kind="riskHrs" data-value="${reduced}">Add to impact</button>
            </div>
          </div>
        `;
      }
      function perUserContent(){
        const totalMin = Math.max(0, Number(STATE.impact.minutes));
        const route=routeRecommendation(STATE.ctx);
        return `
          <div class="p-3">
            <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-2.5 text-[13px]">
              <div class="flex items-center gap-1.5 font-medium"><i data-lucide="mouse-pointer" class="w-3.5 h-3.5"></i> Reactive Work Reduced</div>
              <div class="mt-1.5 flex items-center justify-between rounded bg-gray-100 px-2 py-1">
                <span class="tabular-nums">18 ‚Üí ${totalMin} min</span>
                <strong class="tabular-nums">${totalMin} min saved</strong>
              </div>
            </div>
            <div class="mt-1.5 grid grid-cols-3 gap-1.5 text-[11px]">
              ${['Windows','Mac'].map(d=>pill(d,STATE.ctx.device===d,'set-device',d)).join('')}
              ${['Corporate','VPN'].map(n=>pill(n,STATE.ctx.network===n,'set-network',n)).join('')}
              ${pill(STATE.ctx.compliant?'Compliant':'Non-compliant',STATE.ctx.compliant,'toggle-compliance','')}
            </div>
            <div class="mt-2"><button type="button" class="bg-transparent text-gray-900 border-2 border-gray-900 px-2.5 py-0.5 text-[11px] w-full rounded hover:text-blue-600 hover:border-blue-600 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" data-action="add-impact" data-kind="minutes" data-value="2">Add to impact (+2 min saved per user)</button></div>
          </div>
        `;
      }
      function editContent(){
        return `
          <div class="p-4 bg-white rounded-xl shadow-inner">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <h4 class="text-[15px] font-medium mb-3">Assumptions</h4>
                <div class="space-y-3">
                  ${inputNum('set-roi', '# users', 'users', STATE.roiInputs.users)}
                  ${inputNum('set-roi', 'Tickets per user / mo', 'ticketsPerUserPerMonth', STATE.roiInputs.ticketsPerUserPerMonth)}
                  ${inputNum('set-roi', 'Avg handle (mins)', 'avgHandleMins', STATE.roiInputs.avgHandleMins)}
                </div>
              </div>
              <div>
                <h4 class="text-[15px] font-medium mb-3">Direct Impacts</h4>
                <div class="space-y-3">
                  ${inputNum('set-impact', 'Minutes saved per user / mo', 'minutes', STATE.impact.minutes)}
                  ${inputNum('set-impact', 'Packaging hours avoided / mo', 'pkgHours', STATE.impact.pkgHours)}
                  ${inputNum('set-impact', 'Patching hours avoided / mo', 'riskHrs', STATE.impact.riskHrs)}
                </div>
              </div>
            </div>
            <div class="mt-6 space-y-6">
              ${perUserContent()}
              ${onePackageContent()}
              ${zeroDayContent()}
            </div>
          </div>
        `;
      }
      function renderSolution(){
        return `
          <section id="panel-solution" class="space-y-2">
            <div class="grid grid-cols-1 gap-2 lg:grid-cols-2">
              ${renderFlow()}
              <div class="flex flex-col gap-2 relative">
                <div class="sticky top-0 z-10 bg-gray-50 py-1 shadow-md">
                  <div class="flex justify-between items-center text-[13px]">
                    <span class="font-semibold">Recast Approach</span>
                    <span class="text-gray-700">${STATE.visitedCards.length} of 3 explored</span>
                  </div>
                </div>
                <button type="button" class="md:hidden bg-transparent text-gray-900 border-2 border-gray-900 py-1.5 text-[13px] rounded-full hover:text-blue-600 hover:border-blue-600 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" data-action="expand-all">Expand All</button>
                ${NEW_CARDS.map(card => popoutCard(card)).join('')}
                <div class="sticky bottom-0 bg-gray-50 py-2 shadow-lg mt-2">
                  <button type="button" class="bg-blue-600 text-white px-3 py-1.5 text-[13px] font-semibold rounded-full hover:bg-blue-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 w-full">See Business Impact</button>
                </div>
              </div>
            </div>
          </section>
        `;
      }
      function pill(label,active,action,value){
        return `<button type="button" class="${cx('px-2.5 py-0.5 border text-[11px] transition rounded',active?'bg-blue-600 text-white border-transparent hover:bg-blue-700':'bg-transparent text-gray-900 border-gray-200 hover:border-blue-600')} focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" data-action="${action}" data-value="${String(value)}">${label}</button>`;
      }
      function renderFlow(){
        return `
          <div class="relative rounded-2xl bg-white shadow-md hover:shadow-lg hover:-translate-y-[2px] transition-shadow duration-300 transition-transform p-3">
            <!-- Animation Overlay for Recast Approach tab -->
            <div id="recast-approach-animation-layer">
                <div id="chaos" class="lottie"></div>
                <div id="breakdown" class="lottie"></div>
                <div id="collapse" class="lottie"></div>
                <div id="unify" class="lottie"></div>
                <div id="endstate" class="lottie"></div>
            </div>
            <div class="flex items-center justify-between gap-2">
              <div class="flex items-center gap-1.5">
                <div class="h-5 w-5 rounded grid place-items-center bg-gray-900"><i data-lucide="boxes" class="h-3 w-3 text-white"></i></div>
                <div>
                  <h3 class="text-[14px] font-semibold">Application Workspace</h3>
                  <div class="text-[11px] text-gray-700">Curated & secured catalog</div>
                </div>
              </div>
              <div class="flex items-center gap-1.5 text-[11px]">
                <button type="button" data-action="start-flow" id="workspaceStartButton" class="bg-blue-600 text-white px-2 py-1 text-[11px] font-semibold rounded-full hover:bg-blue-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2">Start</button>
                <button type="button" data-action="reset-flow" class="bg-transparent text-gray-900 border-2 border-gray-900 px-2 py-1 rounded-full hover:text-blue-600 hover:border-blue-600 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2">Reset</button>
              </div>
            </div>
            <div class="mt-1 flex gap-1.5 text-[11px]">
            </div>
            <div class="mt-1 flex items-center justify-center gap-3 text-[13px] font-medium">
              <div class="flex items-center gap-1">
                <i data-lucide="building" class="w-4.5 h-4.5 text-gray-700"></i>
                <span>App Manager = SCCM / Intune</span>
              </div>
              <i data-lucide="arrow-right" class="w-4.5 h-4.5 text-gray-500"></i>
              <div class="flex items-center gap-1">
                <i data-lucide="truck" class="w-4.5 h-4.5 text-blue-600"></i>
                <span>App Delivery = Recast</span>
              </div>
              <i data-lucide="arrow-right" class="w-4.5 h-4.5 text-gray-500"></i>
              <div class="flex items-center gap-1">
                <i data-lucide="user" class="w-4.5 h-4.5 text-gray-700"></i>
                <span>User</span>
              </div>
            </div>
            <div class="mt-1 text-center">
              <span class="inline-flex items-center gap-1 bg-green-100 text-green-800 px-2.5 py-0.5 rounded-full text-[12px] font-medium">
                <i data-lucide="check-circle" class="w-3.5 h-3.5"></i>
                Configured once ‚Üí delivered everywhere
              </span>
            </div>
            <div class="mt-1 text-center bg-blue-50 p-1.5 rounded-lg text-[12px]">
            </div>
            <div id="flowCard" class="mt-2 rounded-xl border border-gray-200 bg-gradient-to-b from-white to-gray-50 shadow-inner ${STATE.showLabels ? 'show-labels' : ''}" role="region" aria-label="Animated flow">
              <div id="progressCounters" class="hidden mb-2 grid grid-cols-3 gap-1.5 text-[13px] text-center">
                <div><span class="font-semibold tabular-nums" id="appsProcessed">0</span> apps processed</div>
                <div><span class="font-semibold tabular-nums" id="timeSaved">0</span> hours saved</div>
                <div><span class="font-semibold tabular-nums" id="ticketsAvoided">0</span> tickets avoided</div>
              </div>
              <div class="space-y-1 relative">
                ${CATALOG.map(s=>`
                  <div class="grid grid-cols-[12ch_1fr] gap-0.5 items-center border-t border-gray-200 pt-0.5 transition-all duration-300 first:border-t-0 first:pt-0 show-labels:grid-cols-[12ch_1fr] show-labels:gap-3">
                    <div class="text-[11px] uppercase text-gray-700 flex items-center gap-1.5"><i data-lucide="folder" class="w-2.5 h-2.5"></i>${s.title}</div>
                    <div id="${s.id}" class="flex flex-wrap gap-1.5 show-labels:gap-3"></div>
                  </div>
                `).join('')}
                <div id="overlayTag" class="opacity-0 transition-opacity duration-300 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/90 p-3 rounded-2xl shadow-md z-10 show-labels:opacity-100 show-labels:delay-500 text-center text-[13px] text-gray-700">Every app mapped to stage, policy, region, and device.</div>
              </div>
              <div id="flowHubFlash" class="mt-1 hidden text-blue-600"><span class="inline-flex items-center gap-1 text-[11px]"><i data-lucide="bolt" class="h-3.5 w-3.5"></i><span>Update published</span></span></div>
              <div class="mt-2 grid grid-cols-3 gap-1.5 relative" aria-hidden="true" id="platformsSection">
                ${['A','B','C'].map((k,i)=>`
                  <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-1.5 relative">
                    <div class="text-[11px] text-gray-700">${['Existing Platforms','Staged Rings','Access & Policy'][i]}</div>
                    <div id="flowConn${k}" class="mt-0.5 grid grid-cols-10 gap-1"></div>
                    <div class="mt-0.5 h-[0.22rem] rounded-[2px] origin-left scale-x-0 bg-gradient-to-r from-blue-600 to-blue-700" style="--d:${3 + .5*i}s"></div>
                    <i data-lucide="check-circle" class="opacity-0 absolute top-0.5 right-0.5 w-3.5 h-3.5 text-green-500 animate-fadeInOut" style="--d:${4 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px opacity-50" style="background-image:linear-gradient(to right, transparent 50%, #e5e7eb 50%); background-size:4px 1px; background-repeat:repeat-x;"></div>
              </div>
              <div class="mt-2 grid grid-cols-3 gap-1.5 relative" aria-hidden="true" id="groupsSection">
                ${['A','B','C'].map((k,i)=>`
                  <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-1.5 relative">
                    <div class="text-[11px] text-gray-700">${['Business Unit','Subsidiary','Region'][i]}</div>
                    <div id="flowGrp${k}" class="mt-0.5 grid grid-cols-8 gap-1"></div>
                    <div class="mx-auto mt-0.5 w-[0.22rem] h-12 rounded-[2px] origin-top scale-y-0 bg-gradient-to-b from-gray-900 to-blue-600" style="--d:${5 + .5*i}s"></div>
                    <i data-lucide="shield-check" class="opacity-0 absolute top-0.5 right-0.5 w-3.5 h-3.5 text-green-500 animate-fadeInOut" style="--d:${6 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px opacity-50" style="background-image:linear-gradient(to right, transparent 50%, #e5e7eb 50%); background-size:4px 1px; background-repeat:repeat-x;"></div>
              </div>
              <div class="mt-2 grid grid-cols-3 gap-1.5 relative" aria-hidden="true" id="devicesSection">
                ${['A','B','C'].map((k,i)=>`
                  <div class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 p-1.5 text-center relative">
                    <i data-lucide="${['monitor-smartphone','laptop','smartphone'][i]}" class="h-4.5 w-4.5 text-gray-700"></i>
                    <div id="flowDev${k}" class="mt-0.5 grid grid-cols-6 gap-1"></div>
                    <div class="mt-0.5 text-[10px] text-gray-700">${['Windows & macOS','VDI / Web','Mobile'][i]}</div>
                    <i data-lucide="check-circle" class="opacity-0 absolute top-0.5 right-0.5 w-3.5 h-3.5 text-green-500 animate-fadeInOut" style="--d:${8 + .5*i}s"></i>
                  </div>
                `).join('')}
                <div class="absolute top-[-0.5rem] left-0 w-full h-px opacity-50" style="background-image:linear-gradient(to right, transparent 50%, #e5e7eb 50%); background-size:4px 1px; background-repeat:repeat-x;"></div>
              </div>
              <div class="mt-2">
                <div id="endUserCard" class="rounded-xl border border-gray-200 bg-gray-50 transition-shadow duration-300 transition-all duration-500 p-2.5">
                  <div class="flex items-center gap-2">
                    <div id="endUserAvatar" class="h-8 w-8 grid place-items-center font-semibold rounded-full bg-red-600 text-white">U</div>
                    <div class="text-[13px]">
                      <div class="font-medium">End user</div>
                      <div id="endUserMessage" class="text-gray-700">Apps on demand ‚Äî no waiting, no tickets.</div>
                    </div>
                  </div>
                  <div class="mt-2 h-[0.38rem] rounded-[2px] origin-left scale-x-0 bg-gradient-to-r from-blue-600 to-blue-700" style="--d:10s"></div>
                  <div class="relative mt-1 border border-gray-200 bg-gray-50 rounded-2xl p-3">
                    <i data-lucide="laptop" class="h-4.5 w-4.5 text-gray-700"></i>
                    <div id="endUserBadge" class="absolute right-1.5 top-1.5 w-[1rem] h-[1rem] rounded-full opacity-0 translate-y-[-6px] scale-90 grid place-items-center font-bold text-black bg-red-600" style="--d:11s">!</div>
                    <div class="mt-0.5 text-[10px] text-gray-700">Workspace launches the correct app instantly</div>
                  </div>
                  <div id="miniWorkspace" class="mt-2 hidden grid grid-cols-4 gap-1.5">
                    ${miniApps.map(app => `<div class="w-[1.8rem] h-[1.8rem] rounded-full grid place-items-center bg-white shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] transition-all duration-300 hover:shadow-[0_0_8px_rgba(37,99,235,0.3)] hover:scale-105 cursor-pointer" data-action="launch-icon">${app.svg}</div>`).join('')}
                  </div>
                </div>
                <div id="flowSuccess" class="mt-1 hidden inline-flex items-center gap-1 text-[13px] opacity-0 animate-fadeIn text-green-500"><i data-lucide="sparkles" class="h-3.5 w-3.5"></i><span>Configured once ‚Üí delivered everywhere.</span></div>
              </div>
            </div>
          </div>
        `;
      }
      const miniApps = [
        logo('Microsoft Word','W','#185ABD'),
        logo('Microsoft Teams','T','#5B53D6'),
        logo('SAP','SAP','#0A6ED1'),
        logo('Zoom','Z','#0B5CFF')
      ];
      function renderROI(){
        const r = calcROI();
        const fteContext = `‚âà ${Math.round(r.totalHoursMonth / 160)}+ FTE months or ${Math.round(r.totalHoursYear / 3000)} strategic projects/year unblocked`;
        return `
          <section id="panel-roi" class="space-y-4">
            <h1 class="text-3xl font-bold">The application layer is where friction becomes visible</h1>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 bg-gray-50 rounded-xl p-4 shadow-md">
              <div class="space-y-1">
                <h2 class="text-lg font-semibold">Total Time Returned</h2>
                <p class="text-3xl font-bold text-blue-700">${num(r.totalHoursMonth)} hrs/month</p>
                <p class="text-xl font-bold text-blue-700">${num(r.totalHoursYear)} hrs/year</p>
                <p class="text-[13px] text-gray-500">${fteContext}</p>
              </div>
              <div class="space-y-1">
                <h2 class="text-lg font-semibold">Where the Hours Come From</h2>
                <ul class="list-disc ml-5 text-[15px] text-gray-700 space-y-0.5">
                  <li>App-related support time avoided: ${num(r.reactiveHoursMonth)} hrs/mo</li>
                  <li>Faster patch cycles: ${num(r.patchHoursMonth)} hrs/mo</li>
                  <li>Packaging automation: ${num(r.packagingHoursMonth)} hrs/mo</li>
                </ul>
                <p class="text-[13px] text-gray-500">High-volume pain, solved at the root.</p>
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
              <div class="bg-white rounded-xl p-4 border shadow-sm">
                <h3 class="font-semibold text-[15px] mb-1">Technical Debt Reduced</h3>
                <ul class="list-disc ml-4 space-y-0.5 text-gray-700 text-[14px]">
                  <li>30‚Äì50% fewer active app versions</li>
                  <li>Patch time cut from ${STATE.currentHrs} ‚Üí 1.5 hrs (${r.patchReductionPct}%)</li>
                  <li>~${num(r.ticketsAvoided)} tickets avoided / month</li>
                </ul>
              </div>
              <div class="bg-white rounded-xl p-4 border shadow-sm">
                <h3 class="font-semibold text-[15px] mb-1">Project Velocity Gained</h3>
                <ul class="list-disc ml-4 space-y-0.5 text-gray-700 text-[14px]">
                  <li>Apps ready sooner = faster migrations, AI pilots, W365 rollout</li>
                  <li>Fewer blockers to modernization, hardware refreshes</li>
                  <li>Frees capacity for strategic initiatives</li>
                </ul>
              </div>
            </div>
            <div class="mt-4 text-lg italic text-gray-800">‚ÄúThis isn‚Äôt just saved time ‚Äî it‚Äôs recovered momentum.‚Äù</div>
            <div class="mt-6">
              ${bucketAccordion('edit', 'edit-3', 'Edit Assumptions & Impacts', editContent)}
            </div>
            <div class="mt-6 flex flex-wrap gap-3 justify-end">
              <button type="button" data-action="reset-calculator" class="inline-flex items-center gap-1.5 bg-transparent text-gray-600 border-2 border-gray-300 px-4 py-2 text-[15px] font-semibold focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 rounded-full hover:text-blue-600 hover:border-blue-600">Reset</button>
              <button type="button" data-action="copy-onepager" class="inline-flex items-center gap-1.5 bg-blue-600 text-white px-4 py-2 text-[15px] font-semibold focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 rounded-full hover:bg-blue-700">
                <i data-lucide="clipboard" class="w-4.5 h-4.5"></i> ${STATE.copied ? 'Copied!' : 'Copy'}
              </button>
            </div>
          </section>
        `;
      }
      function calcROI(){
        const i = STATE.roiInputs;
        const ticketsMonth = i.users * i.ticketsPerUserPerMonth;
        const reactiveHoursMonth = (STATE.impact.minutes * i.users) / 60;
        const packagingHoursMonth = STATE.impact.pkgHours;
        const patchHoursMonth = STATE.impact.riskHrs;
        const totalHoursMonth = reactiveHoursMonth + packagingHoursMonth + patchHoursMonth;
        const totalHoursYear = totalHoursMonth * 12;
        const ticketsAvoided = (STATE.impact.minutes * i.users) / i.avgHandleMins;
        const patchReductionPct = STATE.currentHrs > 0 ? Math.round(((STATE.currentHrs - 1.5) / STATE.currentHrs) * 100) : 94;
        return {
          i,
          ticketsMonth: round(ticketsMonth),
          reactiveHoursMonth: round(reactiveHoursMonth),
          packagingHoursMonth: round(packagingHoursMonth),
          patchHoursMonth: round(patchHoursMonth),
          totalHoursMonth,
          totalHoursYear,
          ticketsAvoided,
          patchReductionPct
        };
      }
      function updateROIOutputs(){
        // No need for outputs update beyond render
      }
      function setText(id, value){ const el=document.getElementById(id); if(el) el.textContent = String(value); }
      function kv(label,value){
        return `<div class="flex items-center justify-between rounded bg-gray-100 px-2 py-1"><span class="text-gray-700">${label}</span><span class="font-semibold tabular-nums">${value}</span></div>`;
      }
      function inputNum(action, label, key, value){
        return `<label class="flex flex-col gap-0.5 text-[13px]"><span class="text-[11px] text-gray-700">${label}</span><input class="rounded border border-gray-200 bg-gray-50 px-2 py-1 text-[13px] focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" inputmode="decimal" value="${value}" data-action="${action}" data-key="${key}"></label>`;
      }
      const CATALOG=[
        {title:'CORE PRODUCTIVITY',id:'cat-core',items:[
          logo('Microsoft Word','W','#185ABD'),
          logo('Microsoft Excel','X','#107C41'),
          logo('PowerPoint','P','#D24726'),
          logo('Outlook','O','#106EBE'),
          logo('Microsoft Teams','T','#5B53D6'),
          logo('Google Docs','Dc','#1A73E8'),
          logo('Google Sheets','Sh','#1E8E3E'),
          logo('Google Slides','Sl','#F9AB00')
        ]},
        {title:'MESSAGING & MEETINGS',id:'cat-collab',items:[
          multiLogo('Slack',['#36C5F0','#2EB67D','#E01E5A','#ECB22E']),
          logo('Zoom','Z','#0B5CFF'),
          logo('Gmail','G','#EA4335'),
          logo('Google Meet','GM','#0F9D58')
        ]},
        {title:'WEB BROWSERS',id:'cat-browsers',items:[
          triLogo('Google Chrome','#EA4335','#FBBC05','#34A853','#4285F4'),
          ringLogo('Microsoft Edge','#0C8EC5','#0AA0A3'),
          flameLogo('Mozilla Firefox','#FF7139','#FFCC00')
        ]},
        {title:'ENTERPRISE APPS',id:'cat-enterprise',items:[
          logo('Salesforce','SF','#00A1E0'),
          logo('Workday','WD','#1F5BFF'),
          logo('ServiceNow','SN','#81B29A'),
          logo('SAP','SAP','#0A6ED1'),
          logo('Oracle NetSuite','NS','#C74634')
        ]},
        {title:'SECURITY & ACCESS',id:'cat-security',items:[
          logo('Duo','D','#3CB371'),
          logo('Okta','O','#007DC1'),
          logo('Ping Identity','P','#C0172C'),
          logo('Cisco AnyConnect','AC','#00B5AD'),
          logo('Microsoft Defender','MD','#0067B8'),
          logo('CrowdStrike Falcon','CS','#D61F26')
        ]},
        {title:'STORAGE & CREATIVE',id:'cat-storage',items:[
          logo('Adobe Acrobat','A','#ED2224'),
          logo('Dropbox','DB','#0061FF'),
          logo('Box','BX','#0061D5'),
          logo('OneDrive','OD','#0A5BD5'),
          logo('ZoomIt / Sysinternals','ZI','#58595B')
        ]}
      ];
      const appConfigs = [
        {stage:'Prod', policy:'MFA + VPN', region:'AMER', device:'Windows'},
        {stage:'QA', policy:'Compliant only', region:'APAC', device:'Any'},
        {stage:'Dev', policy:'MFA required', region:'EMEA', device:'Mac'},
        {stage:'Prod', policy:'VPN only', region:'Global', device:'Windows'},
        {stage:'QA', policy:'MFA required', region:'AMER', device:'Any'},
        {stage:'Dev', policy:'MFA required', region:'APAC', device:'Mac'},
        {stage:'Prod', policy:'Compliant only', region:'EMEA', device:'Windows'},
        {stage:'QA', policy:'VPN only', region:'Global', device:'Any'}
      ];
      let flatIndex = 0;
      CATALOG.forEach(sec => sec.items.forEach(itm => { itm.config = appConfigs[flatIndex % appConfigs.length]; flatIndex++; }));
      function logo(name,letter,color){ return { name, svg: mark(letter,color) }; }
      function mark(letter,color){
        return `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${letter}">
            <defs><linearGradient id="g${letter.replace(/\W/g,'')}" x1="0" x2="1"><stop offset="0" stop-color="${shade(color,.9)}"/><stop offset="1" stop-color="${shade(color,1.1)}"/></linearGradient></defs>
            <rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="url(#g${letter.replace(/\W/g,'')})" stroke="rgba(0,0,0,.15)"/>
          <text x="50%" y="56%" text-anchor="middle" font-size="22" font-family="Inter,Segoe UI,Arial" font-weight="800" fill="#0A1C60">${letter}</text>
          </svg>`;
      }
      function multiLogo(name,colors){
        const slices=colors.map((c,i)=>`<rect x="${4+i*9}" y="8" width="7" height="32" rx="4" fill="${c}"></rect>`).join('');
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" role="img" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/>${slices}</svg>` };
      }
      function triLogo(name,r1,r2,r3,r4){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><circle cx="24" cy="24" r="12" fill="${r4}"/><path d="M24 12 A12 12 0 0 1 36 24 L24 24 Z" fill="${r1}"/><path d="M36 24 A12 12 0 0 1 24 36 L24 24 Z" fill="${r2}"/><path d="M24 36 A12 12 0 0 1 24 12 L24 24 Z" fill="${r3}"/></svg>` };
      }
      function ringLogo(name,c1,c2){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><circle cx="24" cy="24" r="11" fill="${c1}"/><circle cx="20" cy="20" r="8" fill="${c2}"/></svg>` };
      }
      function flameLogo(name,c1,c2){
        return { name, svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24" aria-label="${name}"><rect x="1.5" y="1.5" width="45" height="45" rx="12" fill="#F7F9FB" stroke="rgba(0,0,0,.15)"/><path d="M24 12c5 7-2 9 3 14 3 3 2 9-3 11-5-2-6-8-3-11 5-5-3-7 3-14z" fill="${c1}"/><circle cx="26" cy="28" r="4" fill="${c2}"/></svg>` };
      }
      function shade(hex,m){ const c=hex.replace('#',''); const n=[0,1,2].map(i=>parseInt(c.slice(i*2,i*2+2),16)); const s=n.map(v=>Math.max(0,Math.min(255,Math.round(v*m)))); return '#'+s.map(v=>v.toString(16).padStart(2,'0')).join(''); }
      /* ---------- Per-user cached Current State (IDs + storage) ---------- */
      const USER_ID = String(window.APP_USER_ID || "guest");
      const PAGE_SCOPE = location.origin + location.pathname + location.search;
      const STORAGE_KEY = `currentState:${USER_ID}:${PAGE_SCOPE}`;
      let DEFAULT_CURRENT_STATE = null;
      const $ = (sel, ctx = document) => ctx.querySelector(sel);
      const fields = {
        changeIntro: () => $('#changeIntro'),
        changeBullets: () => $('#changeBullets'),
        changeAnalyst: () => $('#changeAnalyst'),
        nowIntro: () => $('#nowIntro'),
        nowBullets: () => $('#nowBullets'),
        nowAnalyst: () => $('#nowAnalyst'),
        recastIntro: () => $('#recastIntro'),
        recastBullets: () => $('#recastBullets'),
        recastAnalyst: () => $('#recastAnalyst')
      };
      function captureDefaultsOnce(){
        if (DEFAULT_CURRENT_STATE) return;
        DEFAULT_CURRENT_STATE = STATE.defaultsCurrentState();
      }
      function readFields(){
        return {
          change: {
            intro: fields.changeIntro()?.value ?? "",
            bullets: fields.changeBullets()?.value ?? "",
            analyst: fields.changeAnalyst()?.value ?? ""
          },
          now: {
            intro: fields.nowIntro()?.value ?? "",
            bullets: fields.nowBullets()?.value ?? "",
            analyst: fields.nowAnalyst()?.value ?? ""
          },
          recast: {
            intro: fields.recastIntro()?.value ?? "",
            bullets: fields.recastBullets()?.value ?? "",
            analyst: fields.recastAnalyst()?.value ?? ""
          }
        };
      }
      function writeFields(data){
        if(!data) return;
        if(fields.changeIntro()) fields.changeIntro().value = data.change.intro ?? "";
        if(fields.changeBullets()) fields.changeBullets().value = data.change.bullets ?? "";
        if(fields.changeAnalyst()) fields.changeAnalyst().value = data.change.analyst ?? "";
        if(fields.nowIntro()) fields.nowIntro().value = data.now.intro ?? "";
        if(fields.nowBullets()) fields.nowBullets().value = data.now.bullets ?? "";
        if(fields.nowAnalyst()) fields.nowAnalyst().value = data.now.analyst ?? "";
        if(fields.recastIntro()) fields.recastIntro().value = data.recast.intro ?? "";
        if(fields.recastBullets()) fields.recastBullets().value = data.recast.bullets ?? "";
        if(fields.recastAnalyst()) fields.recastAnalyst().value = data.recast.analyst ?? "";
      }
      function loadDraft(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : null;
        }catch{return null;}
      }
      function saveDraft(payload){
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(payload)); }
        catch(e){ console.warn('Save failed (storage blocked or full):', e); }
      }
      function clearDraft(){
        try{ localStorage.removeItem(STORAGE_KEY); }catch{}
      }
      function initCurrentStateModal(){
        captureDefaultsOnce();
        const draft = loadDraft();
        if(draft) writeFields(draft);
        const saveBtn = $('#btnSaveCurrentState');
        const resetBtn = $('#btnResetCurrentState');
        if (saveBtn && !saveBtn.dataset.wired){
          saveBtn.dataset.wired = "1";
          saveBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            saveDraft(readFields());
          });
        }
        if (resetBtn && !resetBtn.dataset.wired){
          resetBtn.dataset.wired = "1";
          resetBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            clearDraft();
            writeFields(DEFAULT_CURRENT_STATE);
            STATE.currentState = STATE.defaultsCurrentState();
            render();
          });
        }
      }
      /* ------------------------------------------------------------------- */
      function renderModal(){
        if(!STATE.modalOpen) return '';
        const buf = STATE.editBuffers;
        const toLines = arr => arr.join('\n');
        const ensure = v => v ?? '';
        return `
          <div role="dialog" aria-modal="true" aria-labelledby="cs-editor-title" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 overflow-auto p-4 md:p-8 animate-overlayFade">
            <div class="w-[95vw] h-[95vh] bg-white rounded-2xl shadow-2xl p-6 overflow-y-auto animate-modalEnter">
              <div class="flex items-center justify-between">
                <h2 id="cs-editor-title" class="text-lg font-medium tracking-normal">Edit Current State</h2>
                <button type="button" class="bg-transparent text-gray-900 p-1.5 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 rounded" data-action="close-modal" aria-label="Close">
                  <i data-lucide="x" class="w-3.5 h-3.5"></i>
                </button>
              </div>
              <p class="mt-0.5 text-[13px] text-gray-700">Edit the introduction, bullets (one per line, max 4), and analyst trend for each section.</p>
              <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
                ${editorSection('change','Why Change', ensure(buf.change.intro) || STATE.currentState.change.intro, ensure(buf.change.bullets) || toLines(STATE.currentState.change.bullets), ensure(buf.change.analyst) || STATE.currentState.change.analyst)}
                ${editorSection('now','Why Now', ensure(buf.now.intro) || STATE.currentState.now.intro, ensure(buf.now.bullets) || toLines(STATE.currentState.now.bullets), ensure(buf.now.analyst) || STATE.currentState.now.analyst)}
                ${editorSection('recast','Why Recast', ensure(buf.recast.intro) || STATE.currentState.recast.intro, ensure(buf.recast.bullets) || toLines(STATE.currentState.recast.bullets), ensure(buf.recast.analyst) || STATE.currentState.recast.analyst)}
              </div>
              <div class="mt-4 flex flex-wrap gap-1.5">
                <button id="btnSaveCurrentState" type="button" data-action="save-currentstate" class="inline-flex items-center gap-1.5 bg-blue-600 text-white px-3 py-1.5 text-[13px] font-semibold focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 rounded hover:bg-blue-700">
                  <i data-lucide="save" class="w-3.5 h-3.5"></i> Save
                </button>
                <button id="btnResetCurrentState" type="button" data-action="reset-currentstate-defaults" class="inline-flex items-center gap-1.5 bg-transparent text-gray-900 border-2 border-gray-900 px-3 py-1.5 text-[13px] font-semibold focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 rounded hover:text-blue-600 hover:border-blue-600">
                  <i data-lucide="rotate-ccw" class="w-3.5 h-3.5"></i> Reset to default
                </button>
              </div>
            </div>
          </div>
        `;
      }
      function editorSection(key,label,introValue,bulletsValue,analystValue){
        return `
          <div class="flex flex-col gap-3">
            <span class="text-[13px] font-medium">${label}</span>
            <label class="flex flex-col gap-0.5">
              <span class="text-[11px] text-gray-700">Introduction</span>
              <textarea id="${key}Intro" data-action="edit-buffer" data-key="${key}" data-subkey="intro" class="min-h-[70px] rounded border border-gray-200 bg-white p-2.5 text-[13px] leading-relaxed focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" aria-label="${label} introduction editor" rows="2">${introValue}</textarea>
            </label>
            <label class="flex flex-col gap-0.5">
              <div class="flex items-center gap-1.5 text-[11px] text-gray-700">
                <i data-lucide="check-circle" class="w-3.5 h-3.5 text-blue-600"></i>
                Bullets (one per line, max 4)
              </div>
              <textarea id="${key}Bullets" data-action="edit-buffer" data-key="${key}" data-subkey="bullets" class="min-h-[140px] rounded border border-gray-200 bg-white p-2.5 text-[13px] leading-relaxed focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" aria-label="${label} bullets editor" rows="5">${bulletsValue}</textarea>
            </label>
            <label class="flex flex-col gap-0.5">
              <span class="text-[11px] text-gray-700">Analyst Trend</span>
              <textarea id="${key}Analyst" data-action="edit-buffer" data-key="${key}" data-subkey="analyst" class="min-h-[70px] rounded border border-gray-200 bg-white p-2.5 text-[13px] leading-relaxed focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2" aria-label="${label} analyst editor" rows="2">${analystValue}</textarea>
            </label>
          </div>
        `;
      }
      function attachEvents(){
        const root=document.getElementById('app');
        root.querySelectorAll('[data-action="switch-tab"]').forEach(b=>b.addEventListener('click',e=>{
          STATE.activeTab=e.currentTarget.getAttribute('data-tab');
          STATE.visitedCards = [];
          render();
        }));
        root.querySelectorAll('[data-action="advance"]').forEach(b=>b.addEventListener('click',e=>{
          STATE.activeTab=e.currentTarget.getAttribute('data-next');
          STATE.openWhyModal = null;
          render();
        }));
        root.querySelectorAll('[data-action="open-why-modal"]').forEach(b=>b.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-why');
          STATE.openWhyModal = id;
          render();
        }));
        root.querySelectorAll('[data-action="close-why-modal"]').forEach(b=>b.addEventListener('click',()=>{
          STATE.openWhyModal = null;
          render();
        }));
        root.querySelectorAll('[data-action="toggle-card"]').forEach(b=>b.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-card');
          const wasOpen = STATE.openCards[id];
          Object.keys(STATE.openCards).forEach(k => STATE.openCards[k] = false);
          STATE.openCards[id] = !wasOpen;
          if (STATE.openCards[id] && !STATE.visitedCards.includes(id)) {
            STATE.visitedCards.push(id);
          }
          render();
          if (STATE.openCards[id]) {
            setTimeout(() => {
              e.currentTarget.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 200);
          }
        }));
        root.querySelectorAll('[data-action="expand-all"]').forEach(b=>b.addEventListener('click',()=>{
          Object.keys(STATE.openCards).forEach(k => STATE.openCards[k] = true);
          STATE.visitedCards = ['core', 'onboarding', 'trust'];
          render();
        }));
        root.querySelectorAll('[data-action="toggle-bucket"]').forEach(b=>b.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-bucket');
          STATE.openBuckets[id] = !STATE.openBuckets[id];
          render();
        }));
        root.querySelectorAll('[data-action="set-device"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.device=e.currentTarget.getAttribute('data-value'); render(); }));
        root.querySelectorAll('[data-action="set-network"]').forEach(b=>b.addEventListener('click',e=>{ STATE.ctx.network=e.currentTarget.getAttribute('data-value'); render(); }));
        root.querySelectorAll('[data-action="toggle-compliance"]').forEach(b=>b.addEventListener('click',()=>{ STATE.ctx.compliant=!STATE.ctx.compliant; render(); }));
        const pack=root.querySelector('[data-action="set-pack-hrs"]'); if(pack) pack.addEventListener('input',e=>{ STATE.packHrs=cleanNum(e.target.value); render(); });
        const cfg=root.querySelector('[data-action="set-config-hrs"]'); if(cfg) cfg.addEventListener('input',e=>{ STATE.configHrs=cleanNum(e.target.value); render(); });
        const cur=root.querySelector('[data-action="set-current-hrs"]'); if(cur) cur.addEventListener('input',e=>{ STATE.currentHrs=cleanNum(e.target.value); render(); });
        root.querySelectorAll('[data-action="add-impact"]').forEach(b=>b.addEventListener('click',e=>{
          const kind=e.currentTarget.getAttribute('data-kind'); const val=Number(e.currentTarget.getAttribute('data-value'))||0;
          if (kind==='minutes') STATE.impact.minutes+=val;
          if (kind==='pkgHours') STATE.impact.pkgHours+=val;
          if (kind==='riskHrs') STATE.impact.riskHrs+=val;
          updateROIOutputs();
          render();
        }));
        root.querySelectorAll('[data-action="set-roi"]').forEach(inp=>inp.addEventListener('input',e=>{
          const key=e.currentTarget.getAttribute('data-key');
          const v=Number(String(e.target.value).replace(/[^0-9.\-]/g,''));
          STATE.roiInputs[key]=isFinite(v)?v:0;
          render();
        }));
        root.querySelectorAll('[data-action="set-impact"]').forEach(inp=>inp.addEventListener('input',e=>{
          const key=e.currentTarget.getAttribute('data-key');
          const v=Number(String(e.target.value).replace(/[^0-9.\-]/g,''));
          STATE.impact[key]=isFinite(v)?v:0;
          render();
        }));
        const resetCalc=root.querySelector('[data-action="reset-calculator"]');
        if(resetCalc) resetCalc.addEventListener('click', ()=>{
          STATE.roiInputs = { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18 };
          STATE.impact = { ...STATE.defaults.impact };
          STATE.copied = false;
          render();
        });
        const copyBtn=root.querySelector('[data-action="copy-onepager"]');
        if(copyBtn) copyBtn.addEventListener('click', async ()=>{
          const r = calcROI();
          const selectedPressures = Object.keys(STATE.selectedBullets).map(cat => {
            const p = pressures.find(pp => pp.id === cat);
            if (!p) return '';
            const selBullets = STATE.selectedBullets[cat].map(idx => p.bullets[idx]).filter(Boolean);
            if (selBullets.length === 0) return '';
            return `${p.title}:\n${selBullets.map(b => `- ${b}`).join('\n')}`;
          }).filter(Boolean).join('\n\n');
          const currentStateSection = selectedPressures ? `Current State Selections:\n${selectedPressures}` : 'Current State Selections:\nNone selected';
          const body =
 `Recast Application Workspace ‚Äî Executive Summary
${currentStateSection}
Assumptions
  - Users: ${r.i.users}
  - Tickets per user / month: ${r.i.ticketsPerUserPerMonth}
  - Avg handle: ${r.i.avgHandleMins} mins
Observed impact
  - Minutes saved per user (monthly): ${STATE.impact.minutes}
  - Packaging hours avoided: ${STATE.impact.pkgHours}
  - Zero-day hours avoided: ${STATE.impact.riskHrs}
Outcomes
  - Hours Returned / Month: ${round(r.totalHoursMonth)}
  - Hours Returned / Year: ${round(r.totalHoursYear)}
  - Packaging Work Reduced / Month: ${round(r.packagingHoursMonth)}
  - Zero-Day Patch Time Reduced / Month: ${round(r.patchHoursMonth)}
  - App-Related Reactive Work Reduced / Month: ${round(r.reactiveHoursMonth)}
  - Tickets Avoided (est.): ${round(r.ticketsAvoided)} / month
  - Faster Patch Window: ${STATE.currentHrs} to 1.5 hrs (${r.patchReductionPct}% reduction)
  - App Version Reduction (estimated): 30-50% fewer active versions
Notes: Illustrative; replace with your data.`;
          try { await navigator.clipboard.writeText(body); } catch {
            const ta=document.createElement('textarea'); ta.value=body; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
          }
          STATE.copied = true; render(); setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
        });
        const startBtn=root.querySelector('[data-action="start-flow"]');
        if(startBtn) startBtn.addEventListener('click', startFlow);
        const resetBtn=root.querySelector('[data-action="reset-flow"]'); if(resetBtn) resetBtn.addEventListener('click', resetFlow);
        const toggleLabels=root.querySelector('[data-action="toggle-labels"]'); if(toggleLabels) toggleLabels.addEventListener('click', ()=>{ STATE.showLabels=!STATE.showLabels; toggleOverlay(); buildFlow(); });
        root.querySelectorAll('[data-action="launch-icon"]').forEach(icon=>icon.addEventListener('click', ()=>{ icon.classList.add('animate-iconLaunch'); setTimeout(()=>icon.classList.remove('animate-iconLaunch'), 500); }));
        const openEditor=root.querySelector('[data-action="open-currentstate-editor"]');
        if(openEditor) openEditor.addEventListener('click', ()=>{
          STATE.modalOpen = true;
          STATE.editBuffers = { change: { intro: '', bullets: '', analyst: '' }, now: { intro: '', bullets: '', analyst: '' }, recast: { intro: '', bullets: '', analyst: '' } };
          render();
          setTimeout(()=>{ try { window.lucide.createIcons(); } catch{} }, 0);
          setTimeout(()=>{ initCurrentStateModal(); }, 0);
        });
        root.querySelectorAll('[data-action="toggle-bullet"]').forEach(inp=>inp.addEventListener('change',e=>{
          const category = e.target.getAttribute('data-category');
          const index = parseInt(e.target.getAttribute('data-index'));
          if (!STATE.selectedBullets[category]) STATE.selectedBullets[category] = [];
          const arr = STATE.selectedBullets[category];
          if (arr.includes(index)) {
            STATE.selectedBullets[category] = arr.filter(x => x !== index);
          } else {
            arr.push(index);
          }
          render();
        }));
        root.querySelectorAll('[data-action="reset-bullets"]').forEach(b=>b.addEventListener('click',()=>{
          STATE.selectedBullets = {};
          render();
        }));
        root.querySelectorAll('[data-action="next-tab"]').forEach(b=>b.addEventListener('click',()=>{
          STATE.activeTab = 'solution';
          render();
        }));
      }
      function toggleOverlay(){
        const overlay = document.getElementById('overlayTag');
        if(STATE.showLabels){
          overlay.classList.remove('hidden');
          setTimeout(()=>{ overlay.classList.add('hidden'); },3000);
        }
      }
      function buildFlow(){
        let base=0;
        CATALOG.forEach(section=>{
          const mount=document.getElementById(section.id); if(!mount) return;
          mount.innerHTML='';
          section.items.forEach((itm,idx)=>{
            const wrap=document.createElement('div'); wrap.className='flex items-center gap-1 relative transition-all duration-300 show-labels:flex-col show-labels:items-start show-labels:gap-[0.2rem] show-labels:w-[calc(33.333%-0.666rem)] show-labels:mb-1'; wrap.style.setProperty('--d',(base+idx*0.2).toFixed(2)+'s');
            const ring=document.createElement('div'); ring.className='w-[1.8rem] h-[1.8rem] rounded-full grid place-items-center bg-white shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] transition-all duration-300 hover:shadow-[0_0_8px_rgba(37,99,235,0.3)] hover:scale-105 show-labels:w-[1.5rem] show-labels:h-[1.5rem]'; ring.innerHTML=itm.svg; ring.title=itm.name; ring.setAttribute('role','img'); ring.setAttribute('aria-label',itm.name);
            wrap.appendChild(ring);
            if(STATE.showLabels){
              const label=document.createElement('span'); label.className='text-[0.6rem] text-gray-500 opacity-0 -translate-x-[10px] transition-all duration-300 show-labels:opacity-100 show-labels:translate-x-0 whitespace-normal text-left'; label.textContent=itm.name; wrap.appendChild(label);
              const meta=document.createElement('div'); meta.className='text-[0.5rem] text-gray-500 opacity-0 translate-y-[5px] transition-all duration-300 relative top-auto left-auto z-[5] whitespace-nowrap flex flex-col gap-[0.1rem] items-start w-full justify-start show-labels:opacity-100 show-labels:translate-y-0';
              meta.innerHTML = `<span>Stage: ${itm.config.stage}</span><span>Policy: ${itm.config.policy}</span><span>Region: ${itm.config.region}</span><span>Device: ${itm.config.device}</span>`;
              wrap.appendChild(meta);
            }
            mount.appendChild(wrap);
          });
          base+=1.2;
        });
        buildTiles(document.getElementById('flowConnA'), 14, 3);
        buildTiles(document.getElementById('flowConnB'), 14, 3.5);
        buildTiles(document.getElementById('flowConnC'), 14, 4);
        buildTiles(document.getElementById('flowGrpA'), 18, 5);
        buildTiles(document.getElementById('flowGrpB'), 18, 5.5);
        buildTiles(document.getElementById('flowGrpC'), 18, 6);
        buildTiles(document.getElementById('flowDevA'), 10, 8);
        buildTiles(document.getElementById('flowDevB'), 10, 8.5);
        buildTiles(document.getElementById('flowDevC'), 10, 9);
        const avatar=document.getElementById('endUserAvatar');
        const badge=document.getElementById('endUserBadge');
        if(avatar){ avatar.classList.add('bg-red-600'); avatar.textContent='U'; }
        if(badge){ badge.textContent='!'; badge.classList.add('bg-red-600'); }
        const message = document.getElementById('endUserMessage');
        if(message) message.textContent = 'Apps on demand ‚Äî no waiting, no tickets.';
        const mini = document.getElementById('miniWorkspace');
        if(mini) mini.classList.add('hidden');
        const counters = document.getElementById('progressCounters');
        if(counters) counters.classList.add('hidden');
        const card = document.getElementById('flowCard');
        if(card) card.classList.remove('run');
        if(STATE.showLabels) card.classList.add('show-labels');
        else card.classList.remove('show-labels');
        const endCard = document.getElementById('endUserCard');
        if(endCard) endCard.classList.remove('scale-105','bg-white','border-green-500');
        STATE.progress = { apps: 0, time: 0, tickets: 0 };
        updateProgress();
        const success=document.getElementById('flowSuccess'); if(success) success.classList.add('hidden');
      }
      function buildTiles(container,count,baseDelay){
        if(!container) return; container.innerHTML='';
        for(let i=0;i<count;i++){ const d=document.createElement('div'); d.className='w-[0.4rem] h-[0.4rem] rounded-[2px] bg-gray-200 opacity-90 run:animate-tilePulse'; d.style.setProperty('--d',(baseDelay+i*0.1).toFixed(2)+'s'); container.appendChild(d); }
      }
      function startFlow(){
        runWorkspaceAnimation();
        const card=document.getElementById('flowCard'); if(!card) return;
        card.classList.remove('run'); void card.offsetWidth; card.classList.add('run');
        const flash=document.getElementById('flowHubFlash'); const success=document.getElementById('flowSuccess');
        const avatar=document.getElementById('endUserAvatar'); const badge=document.getElementById('endUserBadge');
        const message = document.getElementById('endUserMessage'); const mini = document.getElementById('miniWorkspace');
        const counters = document.getElementById('progressCounters'); const endCard = document.getElementById('endUserCard');
        const groups = document.getElementById('groupsSection');
        if(flash){ flash.classList.remove('hidden'); setTimeout(()=>flash.classList.add('hidden'),2000); }
        if(success) success.classList.add('hidden');
        if(counters) counters.classList.remove('hidden');
        let interval = setInterval(updateProgress, 100);
        setTimeout(()=>{
          if(groups) groups.classList.add('dimmed');
          if(endCard) endCard.classList.add('highlighted');
        }, 5000);
        const platformBuckets = document.querySelectorAll('#platformsSection > div');
        const groupBuckets = document.querySelectorAll('#groupsSection > div');
        const deviceBuckets = document.querySelectorAll('#devicesSection > div');
        setTimeout(() => { if (platformBuckets[0]) platformBuckets[0].classList.add('processed'); }, 4500);
        setTimeout(() => { if (platformBuckets[1]) platformBuckets[1].classList.add('processed'); }, 5000);
        setTimeout(() => { if (platformBuckets[2]) platformBuckets[2].classList.add('processed'); }, 5500);
        setTimeout(() => { if (groupBuckets[0]) groupBuckets[0].classList.add('processed'); }, 6500);
        setTimeout(() => { if (groupBuckets[1]) groupBuckets[1].classList.add('processed'); }, 7000);
        setTimeout(() => { if (groupBuckets[2]) groupBuckets[2].classList.add('processed'); }, 7500);
        setTimeout(() => { if (deviceBuckets[0]) deviceBuckets[0].classList.add('processed'); }, 8500);
        setTimeout(() => { if (deviceBuckets[1]) deviceBuckets[1].classList.add('processed'); }, 9000);
        setTimeout(() => { if (deviceBuckets[2]) deviceBuckets[2].classList.add('processed'); }, 9500);
        setTimeout(()=>{
          if(avatar){ avatar.classList.remove('bg-red-600'); avatar.classList.add('bg-green-500'); }
          if(badge){ badge.textContent='‚úì'; badge.classList.remove('bg-red-600'); badge.classList.add('bg-green-500'); }
          if(message) message.textContent = 'Apps on demand ‚Äî no waiting, no tickets. Workspace launches the correct app instantly.';
          if(mini) mini.classList.remove('hidden');
          if(endCard) endCard.classList.add('scale-105','bg-white','border-green-500');
          if(success) success.classList.remove('hidden');
          clearInterval(interval);
        }, 11000);
        setTimeout(()=> card.classList.remove('run'), 12000);
      }
      function updateProgress(){
        if(STATE.progress.apps < 128) STATE.progress.apps += 4;
        if(STATE.progress.time < 46) STATE.progress.time += 2;
        if(STATE.progress.tickets < 73) STATE.progress.tickets += 3;
        setText('appsProcessed', STATE.progress.apps > 128 ? 128 : STATE.progress.apps);
        setText('timeSaved', STATE.progress.time > 46 ? 46 : STATE.progress.time);
        setText('ticketsAvoided', STATE.progress.tickets > 73 ? 73 : STATE.progress.tickets);
      }
      function resetFlow(){
        STATE.progress = { apps: 0, time: 0, tickets: 0 };
        STATE.showLabels = false;
        buildFlow();
        const allProcessed = document.querySelectorAll('.processed');
        allProcessed.forEach(el => el.classList.remove('processed'));
        const dimmed = document.querySelectorAll('.dimmed');
        dimmed.forEach(el => el.classList.remove('dimmed'));
        const highlighted = document.querySelectorAll('.highlighted');
        highlighted.forEach(el => el.classList.remove('highlighted'));
      }
      function attachAccordionKeyboard(){
        document.addEventListener('keydown', (e) => {
          const target = e.target;
          if (!target.classList.contains('accordion-header')) return;
          const headers = Array.from(document.querySelectorAll('.accordion-header'));
          const idx = headers.indexOf(target);
          if (e.key === 'ArrowDown') {
            const nextIdx = (idx + 1) % headers.length;
            headers[nextIdx].focus();
            e.preventDefault();
          } else if (e.key === 'ArrowUp') {
            const prevIdx = (idx - 1 + headers.length) % headers.length;
            headers[prevIdx].focus();
            e.preventDefault();
          } else if (e.key === 'Home') {
            headers[0].focus();
            e.preventDefault();
          } else if (e.key === 'End') {
            headers[headers.length - 1].focus();
            e.preventDefault();
          } else if (e.key === 'Enter' || e.key === ' ') {
            target.click();
            e.preventDefault();
          }
        });
      }
      document.addEventListener('DOMContentLoaded', render);
      document.addEventListener('click', (e)=>{
        const act = e.target.closest('[data-action]');
        if(!act) return;
        const action = act.getAttribute('data-action');
        if(action==='close-modal'){
          STATE.modalOpen=false; render();
        }
        if(action==='edit-buffer'){
          const key = act.getAttribute('data-key');
          const subkey = act.getAttribute('data-subkey');
          act.addEventListener('input', (evt)=>{ STATE.editBuffers[key][subkey] = evt.target.value; });
        }
        if(action==='save-currentstate'){
          const parseLines = (s)=> (s||'').split('\n').map(l=>l.trim()).filter(Boolean).slice(0,4);
          const fallback = STATE.defaultsCurrentState();
          const formData = readFields();
          STATE.currentState = {
            change: {
              intro: formData.change.intro.trim() || fallback.change.intro,
              bullets: parseLines(formData.change.bullets) || fallback.change.bullets,
              analyst: formData.change.analyst.trim() || fallback.change.analyst
            },
            now: {
              intro: formData.now.intro.trim() || fallback.now.intro,
              bullets: parseLines(formData.now.bullets) || fallback.now.bullets,
              analyst: formData.now.analyst.trim() || fallback.now.analyst
            },
            recast: {
              intro: formData.recast.intro.trim() || fallback.recast.intro,
              bullets: parseLines(formData.recast.bullets) || fallback.recast.bullets,
              analyst: formData.recast.analyst.trim() || fallback.recast.analyst
            }
          };
          saveDraft({
            change: {
              intro: $('#changeIntro')?.value || '',
              bullets: $('#changeBullets')?.value || '',
              analyst: $('#changeAnalyst')?.value || ''
            },
            now: {
              intro: $('#nowIntro')?.value || '',
              bullets: $('#nowBullets')?.value || '',
              analyst: $('#nowAnalyst')?.value || ''
            },
            recast: {
              intro: $('#recastIntro')?.value || '',
              bullets: $('#recastBullets')?.value || '',
              analyst: $('#recastAnalyst')?.value || ''
            }
          });
          STATE.modalOpen=false;
          STATE.activeTab='problems';
          STATE.openWhy=null;
          render();
        }
        if(action==='reset-currentstate-defaults'){
          clearDraft();
          captureDefaultsOnce();
          writeFields(DEFAULT_CURRENT_STATE);
          STATE.currentState = STATE.defaultsCurrentState();
          render();
        }
      });
      document.addEventListener('keydown',(e)=>{
        if(e.key==='Escape' && (STATE.modalOpen || STATE.openWhyModal)){
          STATE.modalOpen=false;
          STATE.openWhyModal=null;
          render();
        }
      });
      // Init animation JSON
const approachAnimations = {
  chaos: lottie.loadAnimation({
    container: document.getElementById('chaos'),
    renderer: 'svg', autoplay: false, loop: false,
    path: 'https://assets4.lottiefiles.com/packages/lf20_yr6zz3wt.json'
  }),
  breakdown: lottie.loadAnimation({
    container: document.getElementById('breakdown'),
    renderer: 'svg', autoplay: false, loop: false,
    path: 'https://assets9.lottiefiles.com/packages/lf20_rovf9s.json'
  }),
  collapse: lottie.loadAnimation({
    container: document.getElementById('collapse'),
    renderer: 'svg', autoplay: false, loop: false,
    path: 'https://assets3.lottiefiles.com/packages/lf20_k9qliiD3Bf.json'
  }),
  unify: lottie.loadAnimation({
    container: document.getElementById('unify'),
    renderer: 'svg', autoplay: false, loop: false,
    path: 'https://assets1.lottiefiles.com/packages/lf20_u4yrau.json'
  }),
  endstate: lottie.loadAnimation({
    container: document.getElementById('endstate'),
    renderer: 'svg', autoplay: false, loop: false,
    path: 'https://assets8.lottiefiles.com/packages/lf20_jmejybvu.json'
  })
};
// Sequence behavior
function playStep(name, delay) {
  setTimeout(() => {
    const layer = document.getElementById(name);
    if (layer) {
      layer.style.display = "block";
      approachAnimations[name].goToAndPlay(0, true);
    }
  }, delay);
}
function runWorkspaceAnimation() {
    playStep("chaos", 0);
    playStep("breakdown", 1000);
    playStep("collapse", 1600);
    playStep("unify", 2500);
    playStep("endstate", 3400);
    // Final stabilized UI
    setTimeout(() => {
        document.body.classList.add("workspace-final");
    }, 4300);
}
// Hook into existing Start button
document.addEventListener('DOMContentLoaded', () => {
  const startButton = document.getElementById("workspaceStartButton");
  if (startButton) {
    startButton.addEventListener("click", runWorkspaceAnimation);
  }
});
    </script>
  </body>
</html>
